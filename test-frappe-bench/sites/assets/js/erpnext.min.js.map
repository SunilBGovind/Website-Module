{"version":3,"file":"erpnext.min.js","sources":["../../../apps/erpnext/erpnext/public/js/conf.js","../../../apps/erpnext/erpnext/public/js/utils.js","../../../apps/erpnext/erpnext/public/js/queries.js","../../../apps/erpnext/erpnext/public/js/sms_manager.js","../../../apps/erpnext/erpnext/public/js/utils/party.js","../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js","../../../apps/erpnext/erpnext/public/js/payment/payments.js","../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js","../../../apps/erpnext/erpnext/public/js/controllers/transaction.js","../../../apps/erpnext/erpnext/public/js/utils/item_selector.js","../../../apps/erpnext/erpnext/public/js/help_links.js","../../../apps/erpnext/erpnext/public/js/agriculture/ternary_plot.js","../../../apps/erpnext/erpnext/public/js/utils/item_quick_entry.js","../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js","../../../apps/erpnext/erpnext/public/js/hub/hub_factory.js","../../../apps/erpnext/erpnext/public/js/call_popup/call_popup.js","../../../apps/erpnext/erpnext/public/js/utils/dimension_tree_filter.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide('erpnext');\n\n// add toolbar icon\n$(document).bind('toolbar_setup', function() {\n\tfrappe.app.name = \"ERPNext\";\n\n\tfrappe.help_feedback_link = '<p><a class=\"text-muted\" \\\n\t\thref=\"https://discuss.erpnext.com\">Feedback</a></p>'\n\n\n\t$('[data-link=\"docs\"]').attr(\"href\", \"https://erpnext.com/docs\")\n\t$('[data-link=\"issues\"]').attr(\"href\", \"https://github.com/frappe/erpnext/issues\")\n\n\n\t// default documentation goes to erpnext\n\t// $('[data-link-type=\"documentation\"]').attr('data-path', '/erpnext/manual/index');\n\n\t// additional help links for erpnext\n\tvar $help_menu = $('.dropdown-help ul .documentation-links');\n\t$('<li><a data-link-type=\"forum\" href=\"https://erpnext.com/docs/user/manual\" \\\n\t\ttarget=\"_blank\">'+__('Documentation')+'</a></li>').insertBefore($help_menu);\n\t$('<li><a data-link-type=\"forum\" href=\"https://discuss.erpnext.com\" \\\n\t\ttarget=\"_blank\">'+__('User Forum')+'</a></li>').insertBefore($help_menu);\n\t$('<li><a href=\"https://github.com/frappe/erpnext/issues\" \\\n\t\ttarget=\"_blank\">'+__('Report an Issue')+'</a></li>').insertBefore($help_menu);\n\n});\n\n\n\n// doctypes created via tree\n$.extend(frappe.create_routes, {\n\t\"Customer Group\": \"Tree/Customer Group\",\n\t\"Territory\": \"Tree/Territory\",\n\t\"Item Group\": \"Tree/Item Group\",\n\t\"Sales Person\": \"Tree/Sales Person\",\n\t\"Account\": \"Tree/Account\",\n\t\"Cost Center\": \"Tree/Cost Center\",\n\t\"Department\": \"Tree/Department\",\n});\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\t\"Territory\": \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\t\"Brand\": \"Selling\"\n});\n\n$.extend(frappe.breadcrumbs.module_map, {\n\t'ERPNext Integrations': 'Integrations',\n\t'Geo': 'Settings',\n\t'Accounts': 'Accounting',\n\t'Portal': 'Website',\n\t'Utilities': 'Settings',\n\t'Shopping Cart': 'Website',\n\t'Contacts': 'CRM'\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function(company) {\n\t\tif(!company && cur_frm)\n\t\t\tcompany = cur_frm.doc.company;\n\t\tif(company)\n\t\t\treturn frappe.get_doc(\":Company\", company).default_currency || frappe.boot.sysdefaults.currency;\n\t\telse\n\t\t\treturn frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tlet currency_list = docs.filter(d => d.doctype === \":Currency\").map(d => d.name);\n\t\tcurrency_list.unshift(\"\");\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function() {\n\t\tif(cur_frm.fields_dict.naming_series) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal?true:false);\n\t\t}\n\t},\n\n\thide_company: function() {\n\t\tif(cur_frm.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif(companies.length === 1) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", companies[0]);\n\t\t\t\tcur_frm.toggle_display(\"company\", false);\n\t\t\t} else if(erpnext.last_selected_company) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function(company) {\n\t\tif(company) {\n\t\t\treturn frappe.get_doc(\":Company\", company).enable_perpetual_inventory\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_no: function() {\n\t\tvar grid_row = cur_frm.open_grid_row();\n\t\tif(!grid_row || !grid_row.grid_form.fields_dict.serial_no ||\n\t\t\tgrid_row.grid_form.fields_dict.serial_no.get_status()!==\"Write\") return;\n\n\t\tvar $btn = $('<button class=\"btn btn-sm btn-default\">'+__(\"Add Serial No\")+'</button>')\n\t\t\t.appendTo($(\"<div>\")\n\t\t\t\t.css({\"margin-bottom\": \"10px\", \"margin-top\": \"10px\"})\n\t\t\t\t.appendTo(grid_row.grid_form.fields_dict.serial_no.$wrapper));\n\n\t\tvar me = this;\n\t\t$btn.on(\"click\", function() {\n\t\t\tme.show_serial_batch_selector(grid_row.frm, grid_row.doc);\n\t\t});\n\t},\n});\n\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function(frm) {\n\t\tif(frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar company_wise_info = frm.doc.__onload.dashboard_info;\n\t\t\tif(company_wise_info.length > 1) {\n\t\t\t\tcompany_wise_info.forEach(function(info) {\n\t\t\t\t\terpnext.utils.add_indicator_for_multicompany(frm, info);\n\t\t\t\t});\n\t\t\t} else if (company_wise_info.length === 1) {\n\t\t\t\tfrm.dashboard.add_indicator(__('Annual Billing: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].billing_this_year, company_wise_info[0].currency)]), 'blue');\n\t\t\t\tfrm.dashboard.add_indicator(__('Total Unpaid: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].total_unpaid, company_wise_info[0].currency)]),\n\t\t\t\tcompany_wise_info[0].total_unpaid ? 'orange' : 'green');\n\n\t\t\t\tif(company_wise_info[0].loyalty_points) {\n\t\t\t\t\tfrm.dashboard.add_indicator(__('Loyalty Points: {0}',\n\t\t\t\t\t\t[company_wise_info[0].loyalty_points]), 'blue');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator_for_multicompany: function(frm, info) {\n\t\tfrm.dashboard.stats_area.removeClass('hidden');\n\t\tfrm.dashboard.stats_area_row.addClass('flex');\n\t\tfrm.dashboard.stats_area_row.css('flex-wrap', 'wrap');\n\n\t\tvar color = info.total_unpaid ? 'orange' : 'green';\n\n\t\tvar indicator = $('<div class=\"flex-column col-xs-6\">'+\n\t\t\t'<div style=\"margin-top:10px\"><h6>'+info.company+'</h6></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Annual Billing: '+format_currency(info.billing_this_year, info.currency)+'</span></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\">'+\n\t\t\t'<span class=\"indicator '+color+'\">Total Unpaid: '\n\t\t\t+format_currency(info.total_unpaid, info.currency)+'</span></div>'+\n\n\n\t\t\t'</div>').appendTo(frm.dashboard.stats_area_row);\n\n\t\tif(info.loyalty_points){\n\t\t\t$('<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Loyalty Points: '+info.loyalty_points+'</span></div>').appendTo(indicator);\n\t\t}\n\n\t\treturn indicator;\n\t},\n\n\tget_party_name: function(party_type) {\n\t\tvar dict = {'Customer': 'customer_name', 'Supplier': 'supplier_name', 'Employee': 'employee_name',\n\t\t\t'Member': 'member_name'};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tif(!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function(tc_name, doc, callback) {\n\t\tif(tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions',\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcallback(r)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_bank_account: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tmake_subscription: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tmake_pricing_rule: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t* Checks if the first row of a given child table is empty\n\t* @param child_table - Child table Doctype\n\t* @return {Boolean}\n\t**/\n\tfirst_row_is_empty: function(child_table){\n\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t* Removes the first row of a child table if it is empty\n\t* @param {_Frm} frm - The current form\n\t* @param {String} child_table_name - The child table field name\n\t* @return {Boolean}\n\t**/\n\tremove_empty_first_row: function(frm, child_table_name){\n\t\tconst rows = frm['doc'][child_table_name];\n\t\tif (this.first_row_is_empty(rows)){\n\t\t\tfrm['doc'][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n\tget_tree_options: function(option) {\n\t\t// get valid options for tree based on user permission & locals dict\n\t\tlet unscrub_option = frappe.model.unscrub(option);\n\t\tlet user_permission = frappe.defaults.get_user_permissions();\n\t\tlet options;\n\n\t\tif(user_permission && user_permission[unscrub_option]) {\n\t\t\toptions = user_permission[unscrub_option].map(perm => perm.doc);\n\t\t} else {\n\t\t\toptions = $.map(locals[`:${unscrub_option}`], function(c) { return c.name; }).sort();\n\t\t}\n\n\t\t// filter unique values, as there may be multiple user permissions for any value\n\t\treturn options.filter((value, index, self) => self.indexOf(value) === index);\n\t},\n\tget_tree_default: function(option) {\n\t\t// set default for a field based on user permission\n\t\tlet options = this.get_tree_options(option);\n\t\tif(options.includes(frappe.defaults.get_default(option))) {\n\t\t\treturn frappe.defaults.get_default(option);\n\t\t} else {\n\t\t\treturn options[0];\n\t\t}\n\t},\n\tcopy_parent_value_in_all_row: function(doc, dt, dn, table_fieldname, fieldname, parent_fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tcl[i][fieldname] = doc[parent_fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tcreate_new_doc: function (doctype, update_fields) {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\t\t\tfor (let [key, value] of Object.entries(update_fields)) {\n\t\t\t\tnew_doc[key] = value;\n\t\t\t}\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t});\n\t}\n\n});\n\nerpnext.utils.select_alternate_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || 'warehouse';\n\tconst item_field = opts.item_field || 'item_code';\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\", fieldtype: \"Table\", cannot_add_rows: true,\n\t\t\t\tin_place_edit: true, data: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 1\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"alternate_item\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Alternate Item'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\titem_code: e.item_code\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"warehouse\",\n\t\t\t\t\toptions: 'Warehouse',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Warehouse'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"actual_qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Available Qty')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter(d => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach(d => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = null;\n\t\t\t\tif (row.doctype === 'Work Order Item') {\n\t\t\t\t\tqty = row.required_qty;\n\t\t\t\t} else {\n\t\t\t\t\tqty = row.qty;\n\t\t\t\t}\n\t\t\t\trow[item_field] = d.alternate_item;\n\t\t\t\tfrm.script_manager.trigger(item_field, row.doctype, row.name)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'qty', qty);\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name,\n\t\t\t\t\t\t\topts.original_item_field, d.item_code);\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"item_code\": d[item_field],\n\t\t\t\t\"warehouse\": d[warehouse_field],\n\t\t\t\t\"actual_qty\": d.actual_qty\n\t\t\t});\n\t\t}\n\t})\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n}\n\nerpnext.utils.update_child_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst cannot_add_row = (typeof opts.cannot_add_row === 'undefined') ? true : opts.cannot_add_row;\n\tconst child_docname = (typeof opts.cannot_add_row === 'undefined') ? \"items\" : opts.child_docname;\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tcannot_add_rows: cannot_add_row,\n\t\t\t\tin_place_edit: true,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 0,\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 0,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Qty')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Currency',\n\t\t\t\t\tfieldname:\"rate\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 0,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Rate')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"];\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'erpnext.controllers.accounts_controller.update_child_qty_rate',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\t'parent_doctype': frm.doc.doctype,\n\t\t\t\t\t'trans_items': trans_items,\n\t\t\t\t\t'parent_doctype_name': frm.doc.name,\n\t\t\t\t\t'child_docname': child_docname\n\t\t\t\t},\n\t\t\t\tcallback: function() {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tdialog.fields_dict.trans_items.df.data.push({\n\t\t\t\"docname\": d.name,\n\t\t\t\"item_code\": d.item_code,\n\t\t\t\"qty\": d.qty,\n\t\t\t\"rate\": d.rate,\n\t\t});\n\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t})\n\tdialog.show();\n}\n\nerpnext.utils.map_current_doc = function(opts) {\n\tif(opts.get_query_filters) {\n\t\topts.get_query = function() {\n\t\t\treturn {filters: opts.get_query_filters};\n\t\t}\n\t}\n\tvar _map = function() {\n\t\tif($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif(!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, 'items').options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function(d) {\n\t\t\t\tif(d.options===opts.source_doctype) link_fieldname = d.fieldname; });\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function(i, d) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tif(d[link_fieldname]==src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code])\n\t\t\t\t\t\t\titem_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\titem_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif(already_set) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function(r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function(i, row) {\n\t\t\t\t\t\t\tif(row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tif(already_set) {\n\t\t\t\t\t\tfrappe.msgprint(__(\"You have already selected items from {0} {1}\",\n\t\t\t\t\t\t\t[opts.source_doctype, src]));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: 'frappe.model.mapper.map_docs',\n\t\t\targs: {\n\t\t\t\t\"method\": opts.method,\n\t\t\t\t\"source_names\": opts.source_name,\n\t\t\t\t\"target_doc\": cur_frm.doc,\n\t\t\t\t'args': opts.args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tif(opts.source_doctype) {\n\t\tvar d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tget_query: opts.get_query,\n\t\t\taction: function(selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif(values.length === 0){\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]))\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\topts.source_name = values;\n\t\t\t\topts.setters = args;\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\t} else if(opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n}\n\nfrappe.form.link_formatters['Item'] = function(value, doc) {\n\tif(doc && doc.item_name && doc.item_name !== value) {\n\t\treturn value? value + ': ' + doc.item_name: doc.item_name;\n\t} else {\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Employee'] = function(value, doc) {\n\tif(doc && doc.employee_name && doc.employee_name !== value) {\n\t\treturn value? value + ': ' + doc.employee_name: doc.employee_name;\n\t} else {\n\t\treturn value;\n\t}\n}\n\n// add description on posting time\n$(document).on('app_ready', function() {\n\tif(!frappe.datetime.is_timezone_same()) {\n\t\t$.each([\"Stock Reconciliation\", \"Stock Entry\", \"Stock Ledger Entry\",\n\t\t\t\"Delivery Note\", \"Purchase Receipt\", \"Sales Invoice\"], function(i, d) {\n\t\t\tfrappe.ui.form.on(d, \"onload\", function(frm) {\n\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\",\n\t\t\t\t\tfrappe.sys_defaults.time_zone);\n\t\t\t});\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function() {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function() {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function() {\n\t\treturn { query: \"erpnext.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function() {\n\t\treturn { query: \"erpnext.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function(filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif(filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function() {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function() {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function(doc) {\n\t\tif(!doc.customer) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\t\t\tconsole.log(frappe.dynamic_link)\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tsupplier_filter: function(doc) {\n\t\tif(!doc.supplier) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function(doc) {\n\t\tif(!doc.lead) {\n\t\t\tfrappe.throw(__(\"Please specify a {0}\",\n\t\t\t\t[__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function() {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function() {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" }\n\t},\n\n\twarehouse: function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\",0]\n\n\t\t\t]\n\t\t}\n\t}\n});\n\nerpnext.queries.setup_queries = function(frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function(doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name,\n\t\t\t{\"fieldtype\": \"Link\", \"options\": options});\n\t\t$.each(link_fields, function(i, df) {\n\t\t\tif(parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(frappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, {\"fieldtype\": \"Table\"}),\n\t\tfunction(i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t});\n}\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function(frm){\n\tfrm.set_query('warehouse', 'items', function(doc, cdt, cdn) {\n\t\tvar row  = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif(row.item_code){\n\t\t\t$.extend(filters, {\"query\":\"erpnext.controllers.queries.warehouse_query\"});\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters\n\t});\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function() {\n\t\tvar default_msg = {\n\t\t\t'Lead'\t\t\t\t: '',\n\t\t\t'Opportunity'\t\t\t: 'Your enquiry has been logged into the system. Ref No: ' + doc.name,\n\t\t\t'Quotation'\t\t\t: 'Quotation ' + doc.name + ' has been sent via email. Thanks!',\n\t\t\t'Sales Order'\t\t: 'Sales Order ' + doc.name + ' has been created against '\n\t\t\t\t\t\t+ (doc.quotation_no ? ('Quote No:' + doc.quotation_no) : '')\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Delivery Note'\t\t: 'Items has been delivered against delivery note: ' + doc.name\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Sales Invoice': 'Invoice ' + doc.name + ' has been sent via email '\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Material Request'\t\t\t: 'Material Request ' + doc.name + ' has been raised in the system',\n\t\t\t'Purchase Order'\t: 'Purchase Order ' + doc.name + ' has been sent via email',\n\t\t\t'Purchase Receipt'\t: 'Items has been received against purchase receipt: ' + doc.name\n\t\t}\n\n\t\tif (in_list(['Sales Order', 'Delivery Note', 'Sales Invoice'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.customer, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype === 'Quotation')\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.party_name, '', default_msg[doc.doctype]);\n\t\telse if (in_list(['Purchase Order', 'Purchase Receipt'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Supplier', doc.supplier, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Lead')\n\t\t\tthis.show('', '', '', doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Opportunity')\n\t\t\tthis.show('', '', '', doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Material Request')\n\t\t\tthis.show('', '', '', '', default_msg[doc.doctype]);\n\n\t};\n\n\tthis.get_contact_number = function(contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) { frappe.msgprint(r.exc); return; }\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.show = function(contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact){\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name)\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t}\n\tthis.show_dialog = function() {\n\t\tif(!me.dialog)\n\t\t\tme.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\t'message': me.message,\n\t\t\t'number': me.number\n\t\t})\n\t\tme.dialog.show();\n\t}\n\tthis.make_dialog = function() {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Send SMS',\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'number', fieldtype:'Data', label:'Mobile Number', reqd:1},\n\t\t\t\t{fieldname:'message', fieldtype:'Text', label:'Message', reqd:1},\n\t\t\t\t{fieldname:'send', fieldtype:'Button', label:'Send'}\n\t\t\t]\n\t\t})\n\t\td.fields_dict.send.input.onclick = function() {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif(v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif(r.exc) {frappe.msgprint(r.exc); return; }\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.dialog = d;\n\t}\n\tthis.setup();\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nerpnext.utils.get_party_details = function(frm, method, args, callback) {\n\tif(!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\tif(!args) {\n\t\tif((frm.doctype != \"Purchase Order\" && frm.doc.customer)\n\t\t\t|| (frm.doc.party_name && in_list(['Quotation', 'Opportunity'], frm.doc.doctype))) {\n\n\t\t\tlet party_type = \"Customer\";\n\t\t\tif(frm.doc.quotation_to && frm.doc.quotation_to === \"Lead\") {\n\t\t\t\tparty_type = \"Lead\";\n\t\t\t}\n\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\tparty_type: party_type,\n\t\t\t\tprice_list: frm.doc.selling_price_list\n\t\t\t};\n\t\t} else if(frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list\n\t\t\t};\n\t\t}\n\n\t\tif (args) {\n\t\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\t}\n\t}\n\tif(!args || !args.party) return;\n\n\tif(frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Posting/Transaction Date\",\n\t\t\targs.posting_date, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) return;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(r) {\n\t\t\tif(r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif(callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.add_item = function(frm) {\n\tif(frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif(prev_route[1]==='Item' && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child('items');\n\t\t\tfrm.refresh_field('items');\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, 'item_code', prev_route[2]);\n\t\t}\n\t}\n}\n\nerpnext.utils.get_address_display = function(frm, address_field, display_field, is_your_company_address) {\n\tif(frm.updating_party_details) return;\n\n\tif(!address_field) {\n\t\tif(frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if(frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif(!display_field) display_field = \"address_display\";\n\tif(frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\"address_dict\": frm.doc[address_field] },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} else {\n\t\tfrm.set_value(display_field, '');\n\t}\n};\n\nerpnext.utils.set_taxes_from_address = function(frm, triggered_from_field, billing_address_field, shipping_address_field) {\n\tif(frm.updating_party_details) return;\n\n\tif(frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Lead/Customer/Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Posting/Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.get_address_tax_category\",\n\t\targs: {\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": frm.doc[billing_address_field],\n\t\t\t\"shipping_address\": frm.doc[shipping_address_field]\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif(!r.exc){\n\t\t\t\tif(frm.doc.tax_category != r.message) {\n\t\t\t\t\tfrm.set_value(\"tax_category\", r.message);\n\t\t\t\t} else {\n\t\t\t\t\terpnext.utils.set_taxes(frm, triggered_from_field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.set_taxes = function(frm, triggered_from_field) {\n\tif(frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Lead/Customer/Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Posting/Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = 'Lead';\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = 'Customer';\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = 'Supplier';\n\t\tparty = frm.doc.supplier;\n\t} else if (frm.doc.quotation_to){\n\t\tparty_type = frm.doc.quotation_to;\n\t\tparty = frm.doc.party_name;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\t\"party\": party,\n\t\t\t\"party_type\": party_type,\n\t\t\t\"posting_date\": frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\"company\": frm.doc.company,\n\t\t\t\"customer_group\": frm.doc.customer_group,\n\t\t\t\"supplier_group\": frm.doc.supplier_group,\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": ((frm.doc.customer || frm.doc.lead) ? (frm.doc.customer_address) : (frm.doc.supplier_address)),\n\t\t\t\"shipping_address\": frm.doc.shipping_address_name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif(r.message){\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message)\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.get_contact_details = function(frm) {\n\tif(frm.updating_party_details) return;\n\n\tif(frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: {contact: frm.doc.contact_person },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message)\n\t\t\t\t\tfrm.set_value(r.message);\n\t\t\t}\n\t\t})\n\t}\n}\n\nerpnext.utils.validate_mandatory = function(frm, label, value, trigger_on) {\n\tif(!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.msgprint(__(\"Please enter {0} first\", [label]));\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nerpnext.utils.get_shipping_address = function(frm, callback){\n\tif (frm.doc.company) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_shipping_address\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\taddress: frm.doc.shipping_address\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif(r.message){\n\t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]) //Address title or name\n\t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]) //Address to be displayed on the page\n\t\t\t\t}\n\n\t\t\t\tif(callback){\n\t\t\t\t\treturn callback();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\tfrappe.msgprint(__(\"Select company first\"));\n\t}\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = frappe.ui.form.Controller.extend({\n\tonload: function() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t},\n\n\tsetup_warehouse_query: function() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t},\n\n\tsetup_posting_date_time_check: function() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t},\n\n\tshow_stock_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: me.frm.doc.posting_date,\n\t\t\t\t\tcompany: me.frm.doc.company\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t},\n\n\tshow_general_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: me.frm.doc.posting_date,\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\"\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = erpnext.stock.StockController.extend({\n\tmake_payment: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Payment'\n\t\t});\n\t\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text()\n\t},\n\n\tselect_text: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\t$(this).select();\n\t\t})\n\t},\n\n\tset_payment_primary_action: function(){\n\t\tvar me = this;\n\t\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function() {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t},\n\n\tmake_keyboard: function(){\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc))\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event()\n\t\tthis.clear_amount()\n\t},\n\n\tmake_multimode_payment: function(){\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.change_amount > 0){\n\t\t\tme.payment_val = me.doc.outstanding_amount\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t},\n\n\tshow_payment_details: function(){\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find('.multimode-payments').empty();\n\t\tif(this.frm.doc.payments.length){\n\t\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\t\t$(frappe.render_template('payment_details', {\n\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\tamount: data.amount,\n\t\t\t\t\tidx: data.idx,\n\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\ttype: data.type\n\t\t\t\t})).appendTo(multimode_payments)\n\n\t\t\t\tif (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t})\n\t\t}else{\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments)\n\t\t}\n\t},\n\n\tset_outstanding_amount: function(){\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': this.idx}));\n\t\tthis.highlight_selected_row()\n\t\tthis.payment_val = 0.0\n\t\tif(this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0){\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision(\"outstanding_amount\"))\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount()\n\t\t}else if(flt(this.selected_mode.val()) > 0){\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select()\n\t\tthis.bind_amount_change_event();\n\t},\n\t\n\tbind_keyboard_event: function(){\n\t\tvar me = this;\n\t\tthis.payment_val = '';\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t},\n\n\tbind_form_control_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-payment-row').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t\tme.update_paid_amount(true);\n\t\t})\n\t\t\n\t\t$(this.$body).find('.write_off_amount').change(function(){\n\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t})\n\t\t\n\t\t$(this.$body).find('.change_amount').change(function(){\n\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t})\n\t},\n\n\thighlight_selected_row: function(){\n\t\tvar me = this;\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\",{'idx': this.idx}));\n\t\t$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode')\n\t\tselected_row.addClass('selected-payment-mode')\n\t\t$(this.$body).find('.amount').attr('disabled', true);\n\t\tthis.selected_mode.attr('disabled', false);\n\t},\n\t\n\tbind_numeric_keys_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-keyboard-key').click(function(){\n\t\t\tme.payment_val += $(this).text();\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.delete-btn').click(function(){\n\t\t\tme.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount();\n\t\t})\n\n\t},\n\t\n\tbind_amount_change_event: function(){\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function(){\n\t\t\tme.payment_val =  flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_payment_amount()\n\t\t})\n\t},\n\n\tclear_amount: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.clr').click(function(e){\n\t\t\te.stopPropagation();\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\tme.payment_val = 0.0;\n\t\t\tme.selected_mode.val(0.0);\n\t\t\tme.highlight_selected_row();\n\t\t\tme.update_payment_amount();\n\t\t})\n\t},\n\n\twrite_off_amount: function(write_off_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\"));\n\t\tthis.calculate_outstanding_amount(false)\n\t\tthis.show_amounts()\n\t},\n\n\tchange_amount: function(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount()\n\t\tthis.show_amounts()\n\t},\n\n\tupdate_paid_amount: function(update_write_off) {\n\t\tvar me = this;\n\t\tif(in_list(['change_amount', 'write_off_amount'], this.idx)){\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif(me.idx == 'change_amount'){\n\t\t\t\tme.change_amount(value)\n\t\t\t} else{\n\t\t\t\tif(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value)\n\t\t\t}\n\t\t}else{\n\t\t\tthis.update_payment_amount()\n\t\t}\n\t},\n\n\tupdate_payment_amount: function(){\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\tif(cint(me.idx) == cint(data.idx)){\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2)\n\t\t\t}\n\t\t})\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t},\n\n\tshow_amounts: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find(\".write_off_amount\").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency))\n\t\t$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(\":Company\", this.frm.doc.company).default_currency))\n\t\tthis.update_invoice();\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = erpnext.payments.extend({\n\tsetup: function() {},\n\tapply_pricing_rule_on_item: function(item){\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tif (item.parenttype === \"Sales Order\" && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif(item.margin_type == \"Percentage\"){\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem.rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif(item.discount_percentage){\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t}\n\n\t\tif (item.discount_amount) {\n\t\t\titem.rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t}\n\t},\n\n\tcalculate_taxes_and_totals: function(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// Advance calculation applicable to Sales /Purchase Invoice\n\t\tif(in_list([\"Sales Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2 && !this.frm.doc.is_return) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tcalculate_discount_amount: function(){\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t},\n\n\t_calculate_taxes_and_totals: function() {\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t},\n\n\tvalidate_conversion_rate: function() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tconst err_message = __('{0} is mandatory. Maybe Currency Exchange record is not created for {1} to {2}', [\n\t\t\t\t\tconversion_rate_label,\n\t\t\t\t\tthis.frm.doc.currency,\n\t\t\t\t\tcompany_currency\n\t\t\t\t]);\n\t\t\t\tfrappe.throw(err_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_item_values: function() {\n\t\tvar me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\n\t\t\t\tif ((!item.qty) && me.frm.doc.is_return) {\n\t\t\t\t\titem.amount = flt(item.rate * -1, precision(\"amount\", item));\n\t\t\t\t} else {\n\t\t\t\t\titem.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\t}\n\n\t\t\t\titem.net_amount = item.amount;\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_in_company_currency: function(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t},\n\n\tinitialize_taxes: function() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\ttax.item_wise_tax_detail = {};\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied && cur_frm) {\n\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\tme.validate_inclusive_tax(tax);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t},\n\n\tdetermine_exclusive_rate: function() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\ttax.tax_fraction_for_current_item = me.get_current_tax_fraction(tax, item_tax_map);\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t});\n\n\t\t\tif(cumulated_tax_fraction && !me.discount_amount_applied) {\n\t\t\t\titem.net_amount = flt(item.amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t},\n\n\tget_current_tax_fraction: function(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax) {\n\t\t\tcurrent_tax_fraction *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t}\n\t\treturn current_tax_fraction;\n\t},\n\n\t_get_tax_rate: function(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t},\n\n\tcalculate_net_total: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t\t});\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t},\n\n\tcalculate_taxes: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"total\", \"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_cumulative_total: function(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t},\n\n\t_load_item_tax_rate: function(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t},\n\n\tget_current_tax_amount: function(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t}\n\n\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\n\t\treturn current_tax_amount;\n\t},\n\n\tset_item_wise_tax: function(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax_detail && tax_detail[key])\n\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t},\n\n\tround_off_totals: function(tax) {\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t},\n\n\tmanipulate_grand_total_for_inclusive_tax: function() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tthis.frm.doc.rounding_adjustment = flt(flt(this.frm.doc.rounding_adjustment) + diff,\n\t\t\t\t\t\tprecision(\"rounding_adjustment\"));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_totals: function() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t},\n\n\tset_rounded_total: function() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t},\n\n\t_cleanup: function() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\n\t\tif(this.frm.doc[\"items\"] && this.frm.doc[\"items\"].length) {\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"items\"][0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_discount_amount: function() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t},\n\n\tapply_discount_amount: function() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm.doc.items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t},\n\n\tget_total_for_discount_amount: function() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t},\n\n\tcalculate_total_advance: function(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t},\n\n\tcalculate_outstanding_amount: function(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif(this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif(this.frm.doc.is_return || this.frm.doc.docstatus > 0) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(grand_total*this.frm.doc.conversion_rate, precision(\"grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(this.frm.doc.doctype == \"Sales Invoice\") {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t},\n\n\tset_default_payment: function(total_amount_to_pay, update_paid_amount){\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)){\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tdata.base_amount = flt(total_amount_to_pay, precision(\"base_amount\"));\n\t\t\t\t\tdata.amount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\"));\n\t\t\t\t\tpayment_status = false;\n\t\t\t\t}else if(me.frm.doc.paid_amount){\n\t\t\t\t\tdata.amount = 0.0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcalculate_paid_amount: function(){\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\"));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.doc.paid_amount = flt(paid_amount, precision(\"paid_amount\"));\n\t\tthis.frm.doc.base_paid_amount = flt(base_paid_amount, precision(\"base_paid_amount\"));\n\t},\n\n\tcalculate_change_amount: function(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(this.frm.doc.doctype == \"Sales Invoice\"\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total +\n\t\t\t\t\tthis.frm.doc.write_off_amount, precision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total + this.frm.doc.base_write_off_amount,\n\t\t\t\t\tprecision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_write_off_amount: function(){\n\t\tif(this.frm.doc.paid_amount > this.frm.doc.grand_total){\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.grand_total - this.frm.doc.paid_amount\n\t\t\t\t+ this.frm.doc.change_amount, precision(\"write_off_amount\"));\n\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\t\t}else{\n\t\t\tthis.frm.doc.paid_amount = 0.0;\n\t\t}\n\t\tthis.calculate_outstanding_amount(false);\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.TransactionController = erpnext.taxes_and_totals.extend({\n\tsetup: function() {\n\t\tthis._super();\n\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n\n\t\t\tif(item.price_list_rate) {\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\n\t\t\t\t\t// or set discount\n\t\t\t\t\titem.discount_percentage = 0;\n\t\t\t\t\titem.margin_type = 'Amount';\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\n\t\t\t\t\titem.rate_with_margin = item.rate;\n\t\t\t\t} else {\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\n\t\t\t\t\titem.discount_amount = flt(item.price_list_rate) - flt(item.rate);\n\t\t\t\t\titem.margin_type = '';\n\t\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\t\titem.rate_with_margin = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\titem.margin_type = '';\n\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\titem.rate_with_margin = 0;\n\t\t\t}\n\t\t\titem.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\n\n\t\t\tcur_frm.cscript.set_gross_profit(item);\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\n\t\t});\n\n\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\n\t\t\tif(!frm.doc.apply_discount_on) {\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrm.via_discount_percentage = true;\n\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n\t\t\t\t// Reset discount amount and net / grand total\n\t\t\t\tfrm.doc.discount_amount = 0;\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\n\t\t\t\tprecision(\"discount_amount\"));\n\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\n\t\t\tfrm.cscript.set_dynamic_labels();\n\n\t\t\tif (!frm.via_discount_percentage) {\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\n\t\t\t}\n\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", {\n\t\t\titems_add: function(frm, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif(!item.warehouse && frm.doc.set_warehouse) {\n\t\t\t\t\titem.warehouse = frm.doc.set_warehouse;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tvar me = this;\n\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('batch_no')) {\n\t\t\tthis.frm.set_query(\"batch_no\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t});\n\t\t}\n\n\t\tif(\n\t\t\tthis.frm.docstatus < 2\n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\n\t\t\t&& this.frm.doc.payment_terms_template\n\t\t\t&& !this.frm.doc.payment_schedule.length\n\t\t){\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"items\"]) {\n\t\t\tthis[\"items_remove\"] = this.calculate_net_weight;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\n\t\t\t\treturn{\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\n\t\t\t\tvar filters = {\n\t\t\t\t\t\"docstatus\": 1,\n\t\t\t\t\t\"is_return\": 0,\n\t\t\t\t\t\"company\": doc.company\n\t\t\t\t};\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\n\n\t\t\t\treturn {\n\t\t\t\t\tfilters: filters\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"pricing_rules\")) {\n\t\t\tthis.frm.set_indicator_formatter('pricing_rule', function(doc) {\n\t\t\t\treturn (doc.rule_applied) ? \"green\" : \"red\";\n\t\t\t});\n\t\t}\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\n\n\t\t\tlet set_value = (fieldname, value) => {\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => set_value('currency', currency),\n\t\t\t\t() => set_value('price_list_currency', currency),\n\t\t\t\t() => set_value('status', 'Draft'),\n\t\t\t\t() => set_value('is_subcontracted', 'No'),\n\t\t\t\t() => {\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t},\n\n\tis_return: function() {\n\t\tif(!this.frm.doc.is_return && this.frm.doc.return_against) {\n\t\t\tthis.frm.set_value('return_against', '');\n\t\t}\n\t},\n\n\tsetup_quality_inspection: function() {\n\t\tif(!in_list([\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\treturn;\n\t\t}\n\t\tvar me = this;\n\t\tvar inspection_type = in_list([\"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\n\t\tvar quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\n\t\t\tif(me.frm.is_new()) return;\n\t\t\treturn {\n\t\t\t\t\"inspection_type\": inspection_type,\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\"reference_name\": me.frm.doc.name,\n\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\"description\": row.doc.description,\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\n\t\t\t\t\"batch_no\": row.doc.batch_no\n\t\t\t}\n\t\t}\n\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\n\t\t\tvar d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tinspection_type: inspection_type,\n\t\t\t\t\treference_name: doc.name,\n\t\t\t\t\titem_code: d.item_code\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_payment_request: function() {\n\t\tvar me = this;\n\t\tconst payment_request_type = (in_list(['Sales Order', 'Sales Invoice'], this.frm.doc.doctype))\n\t\t\t? \"Inward\" : \"Outward\";\n\n\t\tfrappe.call({\n\t\t\tmethod:\"erpnext.accounts.doctype.payment_request.payment_request.make_payment_request\",\n\t\t\targs: {\n\t\t\t\tdt: me.frm.doc.doctype,\n\t\t\t\tdn: me.frm.doc.name,\n\t\t\t\trecipient_id: me.frm.doc.contact_email,\n\t\t\t\tpayment_request_type: payment_request_type,\n\t\t\t\tparty_type: payment_request_type == 'Outward' ? \"Supplier\" : \"Customer\",\n\t\t\t\tparty: payment_request_type == 'Outward' ? me.frm.doc.supplier : me.frm.doc.customer\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc){\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", r.message.doctype, r.message.name);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\n\tonload_post_render: function() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !(this.frm.doc.__onload ? this.frm.doc.__onload.load_after_mapping : false)) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\n\t\t\tthis.setup_item_selector();\n\t\t\tthis.frm.get_field(\"items\").grid.set_multiple_add(\"item_code\", \"qty\");\n\t\t}\n\t},\n\n\trefresh: function() {\n\t\terpnext.toggle_naming_series();\n\t\terpnext.hide_company();\n\t\tthis.set_dynamic_labels();\n\t\tthis.setup_sms();\n\t\tthis.setup_quality_inspection();\n\t\tthis.frm.fields_dict[\"scan_barcode\"] && this.frm.fields_dict[\"scan_barcode\"].set_value(\"\");\n\t\tthis.frm.fields_dict[\"scan_barcode\"] && this.frm.fields_dict[\"scan_barcode\"].set_new_description(\"\");\n\t},\n\n\tscan_barcode: function() {\n\t\tlet scan_barcode_field = this.frm.fields_dict[\"scan_barcode\"];\n\n\t\tlet show_description = function(idx, exist = null) {\n\t\t\tif (exist) {\n\t\t\t\tscan_barcode_field.set_new_description(__('Row #{0}: Qty increased by 1', [idx]));\n\t\t\t} else {\n\t\t\t\tscan_barcode_field.set_new_description(__('Row #{0}: Item added', [idx]));\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc.scan_barcode) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.search_serial_or_batch_or_barcode_number\",\n\t\t\t\targs: { search_value: this.frm.doc.scan_barcode }\n\t\t\t}).then(r => {\n\t\t\t\tconst data = r && r.message;\n\t\t\t\tif (!data || Object.keys(data).length === 0) {\n\t\t\t\t\tscan_barcode_field.set_new_description(__('Cannot find Item with this barcode'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet cur_grid = this.frm.fields_dict.items.grid;\n\n\t\t\t\tlet row_to_modify = null;\n\t\t\t\tconst existing_item_row = this.frm.doc.items.find(d => d.item_code === data.item_code);\n\t\t\t\tconst blank_item_row = this.frm.doc.items.find(d => !d.item_code);\n\n\t\t\t\tif (existing_item_row) {\n\t\t\t\t\trow_to_modify = existing_item_row;\n\t\t\t\t} else if (blank_item_row) {\n\t\t\t\t\trow_to_modify = blank_item_row;\n\t\t\t\t}\n\n\t\t\t\tif (!row_to_modify) {\n\t\t\t\t\t// add new row\n\t\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc, cur_grid.doctype, 'items');\n\t\t\t\t}\n\n\t\t\t\tshow_description(row_to_modify.idx, row_to_modify.item_code);\n\n\t\t\t\tthis.frm.from_barcode = true;\n\t\t\t\tfrappe.model.set_value(row_to_modify.doctype, row_to_modify.name, {\n\t\t\t\t\titem_code: data.item_code,\n\t\t\t\t\tqty: (row_to_modify.qty || 0) + 1\n\t\t\t\t});\n\n\t\t\t\t['serial_no', 'batch_no', 'barcode'].forEach(field => {\n\t\t\t\t\tif (data[field] && frappe.meta.has_field(row_to_modify.doctype, field)) {\n\t\t\t\t\t\tfrappe.model.set_value(row_to_modify.doctype,\n\t\t\t\t\t\t\trow_to_modify.name, field, data[field]);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tscan_barcode_field.set_value('');\n\t\t\t});\n\t\t}\n\t\treturn false;\n\t},\n\n\tapply_default_taxes: function() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges,\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.set_dynamic_labels(),\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_sms: function() {\n\t\tvar me = this;\n\t\tlet blacklist = ['Purchase Invoice', 'BOM'];\n\t\tif(this.frm.doc.docstatus===1 && !in_list([\"Lost\", \"Stopped\", \"Closed\"], this.frm.doc.status)\n\t\t\t&& !blacklist.includes(this.frm.doctype)) {\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\n\t\t}\n\t},\n\n\tsend_sms: function() {\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\n\t},\n\n\tbarcode: function(doc, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif(d.barcode==\"\" || d.barcode==null) {\n\t\t\t// barcode cleared, remove item\n\t\t\td.item_code = \"\";\n\t\t}\n\n\t\tthis.frm.from_barcode = true;\n\t\tthis.item_code(doc, cdt, cdn);\n\t},\n\n\titem_code: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tvar update_stock = 0, show_batch_dialog = 0;\n\t\tif(['Sales Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\n\t\t\tshow_batch_dialog = update_stock;\n\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt' && me.frm.doc.is_return) ||\n\t\t\tthis.frm.doc.doctype === 'Delivery Note') {\n\t\t\tshow_batch_dialog = 1;\n\t\t}\n\t\t// clear barcode if setting item (else barcode will take priority)\n\t\tif(!this.frm.from_barcode) {\n\t\t\titem.barcode = null;\n\t\t}\n\n\t\tthis.frm.from_barcode = false;\n\t\tif(item.item_code || item.barcode || item.serial_no) {\n\t\t\tif(!this.validate_company_and_party()) {\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n\t\t\t} else {\n\t\t\t\treturn this.frm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\tchild: item,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\tbarcode: item.barcode,\n\t\t\t\t\t\t\tserial_no: item.serial_no,\n\t\t\t\t\t\t\tset_warehouse: me.frm.doc.set_warehouse,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\t\t\t\tquotation_to: me.frm.doc.quotation_to,\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\t\tupdate_stock: update_stock,\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\n\t\t\t\t\t\t\ttransaction_date: me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\n\t\t\t\t\t\t\tqty: item.qty || 1,\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\n\t\t\t\t\t\t\tuom : item.uom,\n\t\t\t\t\t\t\tmanufacturer: item.manufacturer,\n\t\t\t\t\t\t\tstock_uom: item.stock_uom,\n\t\t\t\t\t\t\tpos_profile: me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n\t\t\t\t\t\t\tcost_center: item.cost_center,\n\t\t\t\t\t\t\ttax_category: me.frm.doc.tax_category,\n\t\t\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\t\t\tchild_docname: item.name,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(d.item_tax_rate);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn),\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog) {\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true),\n\t\t\t\t\t\t\t\t() => me.validate_pricing_rule(item)\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_taxes_from_item_tax_template: function(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif(item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif(typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif(!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tserial_no: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item && item.serial_no) {\n\t\t\tif (!item.item_code) {\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar valid_serial_nos = [];\n\n\t\t\t\t// Replacing all occurences of comma with carriage return\n\t\t\t\tvar serial_nos = item.serial_no.trim().replace(/,/g, '\\n');\n\n\t\t\t\tserial_nos = serial_nos.trim().split('\\n');\n\n\t\t\t\t// Trim each string and push unique string to new list\n\t\t\t\tfor (var x=0; x<=serial_nos.length - 1; x++) {\n\t\t\t\t\tif (serial_nos[x].trim() != \"\" && valid_serial_nos.indexOf(serial_nos[x].trim()) == -1) {\n\t\t\t\t\t\tvalid_serial_nos.push(serial_nos[x].trim());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Add the new list to the serial no. field in grid with each in new line\n\t\t\t\titem.serial_no = valid_serial_nos.join('\\n');\n\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\n\t\t\t\tif(!doc.is_return && cint(user_defaults.set_qty_in_transactions_based_on_serial_no_input)) {\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name,\n\t\t\t\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tvalidate: function() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t},\n\n\tcompany: function() {\n\t\tvar me = this;\n\t\tvar set_pricing = function() {\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\n\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\n\t\t\t\tif (!me.frm.doc.currency) {\n\t\t\t\t\tme.frm.set_value(\"currency\", company_currency);\n\t\t\t\t}\n\n\t\t\t\tif (me.frm.doc.currency == company_currency) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t\t}\n\t\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\n\t\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\n\t\t\t\t}\n\t\t\t\tif (company_doc.default_letter_head) {\n\t\t\t\t\tif(me.frm.fields_dict.letter_head) {\n\t\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet selling_doctypes_for_tc = [\"Sales Invoice\", \"Quotation\", \"Sales Order\", \"Delivery Note\"];\n\t\t\t\tif (company_doc.default_selling_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tselling_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_selling_terms);\n\t\t\t\t}\n\t\t\t\tlet buying_doctypes_for_tc = [\"Request for Quotation\", \"Supplier Quotation\", \"Purchase Order\",\n\t\t\t\t\t\"Material Request\", \"Purchase Receipt\"];\n\t\t\t\t// Purchase Invoice is excluded as per issue #3345\n\t\t\t\tif (company_doc.default_buying_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tbuying_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_buying_terms);\n\t\t\t\t}\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => me.frm.script_manager.trigger(\"currency\"),\n\t\t\t\t\t() => me.update_item_tax_map(),\n\t\t\t\t\t() => me.apply_default_taxes(),\n\t\t\t\t\t() => me.apply_pricing_rule()\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\tvar set_party_account = function(set_pricing) {\n\t\t\tif (in_list([\"Sales Invoice\", \"Purchase Invoice\"], me.frm.doc.doctype)) {\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n\t\t\t\t\tvar party_type = \"Customer\";\n\t\t\t\t\tvar party_account_field = 'debit_to';\n\t\t\t\t} else {\n\t\t\t\t\tvar party_type = \"Supplier\";\n\t\t\t\t\tvar party_account_field = 'credit_to';\n\t\t\t\t}\n\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n\t\t\t\tif(party && me.frm.doc.company) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\tparty_type: party_type,\n\t\t\t\t\t\t\tparty: party\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n\t\t\t\t\t\t\t\tset_pricing();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tset_pricing();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset_pricing();\n\t\t\t}\n\n\t\t}\n\n\t\tif (this.frm.doc.posting_date) var date = this.frm.doc.posting_date;\n\t\telse var date = this.frm.doc.transaction_date;\n\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\n\t\t\tin_list(['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'], this.frm.doctype)){\n\t\t\terpnext.utils.get_shipping_address(this.frm, function(){\n\t\t\t\tset_party_account(set_pricing);\n\t\t\t})\n\t\t} else {\n\t\t\tset_party_account(set_pricing);\n\t\t}\n\n\t\tif(this.frm.doc.company) {\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\n\t\t}\n\t},\n\n\ttransaction_date: function() {\n\t\tif (this.frm.doc.transaction_date) {\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\n\t\t}\n\t},\n\n\tposting_date: function() {\n\t\tvar me = this;\n\t\tif (this.frm.doc.posting_date) {\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n\t\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t\t\t\t\tme.recalculate_terms();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t}\n\t\t}\n\t},\n\n\tdue_date: function() {\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\n\t\t// be removed as due_date is automatically changed based on payment terms\n\t\tif (this.frm.doc.due_date && !this.frm.updating_party_details && !this.frm.doc.is_pos) {\n\t\t\tif (this.frm.doc.payment_terms_template ||\n\t\t\t\t(this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)) {\n\t\t\t\tvar message1 = \"\";\n\t\t\t\tvar message2 = \"\";\n\t\t\t\tvar final_message = \"Please clear the \";\n\n\t\t\t\tif (this.frm.doc.payment_terms_template) {\n\t\t\t\t\tmessage1 = \"selected Payment Terms Template\";\n\t\t\t\t\tfinal_message = final_message + message1;\n\t\t\t\t}\n\n\t\t\t\tif ((this.frm.doc.payment_schedule || []).length) {\n\t\t\t\t\tmessage2 = \"Payment Schedule Table\";\n\t\t\t\t\tif (message1.length !== 0) message2 = \" and \" + message2;\n\t\t\t\t\tfinal_message = final_message + message2;\n\t\t\t\t}\n\t\t\t\tfrappe.msgprint(final_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tbill_date: function() {\n\t\tthis.posting_date();\n\t},\n\n\trecalculate_terms: function() {\n\t\tconst doc = this.frm.doc;\n\t\tif (doc.payment_terms_template) {\n\t\t\tthis.payment_terms_template();\n\t\t} else if (doc.payment_schedule) {\n\t\t\tconst me = this;\n\t\t\tdoc.payment_schedule.forEach(\n\t\t\t\tfunction(term) {\n\t\t\t\t\tif (term.payment_term) {\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n\n\tget_company_currency: function() {\n\t\treturn erpnext.get_currency(this.frm.doc.company);\n\t},\n\n\tcontact_person: function() {\n\t\terpnext.utils.get_contact_details(this.frm);\n\t},\n\n\tcurrency: function() {\n\t\t/* manqala 19/09/2016: let the translation date be whichever of the transaction_date or posting_date is available */\n\t\tvar transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\t\t/* end manqala */\n\t\tvar me = this;\n\t\tthis.set_dynamic_labels();\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\n\t\t\t\t&& !this.frm.doc.ignore_pricing_rule) {\n\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tif(exchange_rate != me.frm.doc.conversion_rate) {\n\t\t\t\t\t\tme.set_margin_amount_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.set_actual_charges_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.conversion_rate();\n\t\t}\n\t},\n\n\tconversion_rate: function() {\n\t\tconst me = this.frm;\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t}\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\n\t\t}\n\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\n\t\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t} else if (!this.in_apply_price_list){\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t}\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\n\t},\n\n\tshipping_rule: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.shipping_rule) {\n\t\t\treturn this.frm.call({\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tmethod: \"apply_shipping_rule\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\n\t\t}\n\t\telse {\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t},\n\n\tset_margin_amount_based_on_currency: function(exchange_rate) {\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"]), this.frm.doc.doctype) {\n\t\t\tvar me = this;\n\t\t\t$.each(this.frm.doc.items || [], function(i, d) {\n\t\t\t\tif(d.margin_type == \"Amount\") {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"margin_rate_or_amount\",\n\t\t\t\t\t\tflt(d.margin_rate_or_amount) / flt(exchange_rate));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_actual_charges_based_on_currency: function(exchange_rate) {\n\t\tvar me = this;\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\tif(d.charge_type == \"Actual\") {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\n\t\t\t\t\tflt(d.tax_amount) / flt(exchange_rate));\n\t\t\t}\n\t\t});\n\t},\n\n\tget_exchange_rate: function(transaction_date, from_currency, to_currency, callback) {\n\t\tvar args;\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_selling\";\n\t\t}\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_buying\";\n\t\t}\n\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\targs: {\n\t\t\t\ttransaction_date: transaction_date,\n\t\t\t\tfrom_currency: from_currency,\n\t\t\t\tto_currency: to_currency,\n\t\t\t\targs: args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tcallback(flt(r.message));\n\t\t\t}\n\t\t});\n\t},\n\n\tprice_list_currency: function() {\n\t\tvar me=this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.price_list_currency !== company_currency  && !this.frm.doc.ignore_pricing_rule) {\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.plc_conversion_rate();\n\t\t}\n\t},\n\n\tplc_conversion_rate: function() {\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\n\t\t}\n\n\t\tif(!this.in_apply_price_list) {\n\t\t\tthis.apply_price_list(null, true);\n\t\t}\n\t},\n\n\tuom: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(item.item_code && item.uom) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\tchild: item,\n\t\t\t\targs: {\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\tuom: item.uom\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.conversion_factor(me.frm.doc, cdt, cdn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tconversion_factor: function(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\tif(doc.doctype != 'Material Request' && frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\n\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\n\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\n\t\t\tthis.toggle_conversion_factor(item);\n\t\t\tthis.calculate_net_weight();\n\t\t\tif (!dont_fetch_price_list_rate &&\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\n\t\t\t\tthis.apply_price_list(item, true);\n\t\t\t}\n\t\t}\n\t},\n\n\ttoggle_conversion_factor: function(item) {\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\n\t\t}\n\n\t},\n\n\tqty: function(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tthis.conversion_factor(doc, cdt, cdn, true);\n\t\tthis.apply_pricing_rule(item, true);\n\t},\n\n\tservice_stop_date: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_stop_date) {\n\t\t\tlet start_date = Date.parse(child.service_start_date);\n\t\t\tlet end_date = Date.parse(child.service_end_date);\n\t\t\tlet stop_date = Date.parse(child.service_stop_date);\n\n\t\t\tif(stop_date < start_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be before Service Start Date\"));\n\t\t\t} else if (stop_date > end_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be after Service End Date\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tservice_start_date: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_start_date) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"erpnext.stock.get_item_details.calculate_service_end_date\",\n\t\t\t\targs: {\"args\": child},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_end_date\", r.message.service_end_date);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tcalculate_net_weight: function(){\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n\t\tvar me = this;\n\t\tthis.frm.doc.total_net_weight= 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\n\t\t});\n\t\trefresh_field(\"total_net_weight\");\n\t\tthis.shipping_rule();\n\t},\n\n\tset_dynamic_labels: function() {\n\t\t// What TODO? should we make price list system non-mandatory?\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n\t\tvar company_currency = this.get_company_currency();\n\t\tthis.change_form_labels(company_currency);\n\t\tthis.change_grid_labels(company_currency);\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tchange_form_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\n\t\t\t\"base_rounding_adjustment\"], company_currency);\n\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\n\t\t\t\"total_cost\"], this.frm.doc.currency);\n\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\n\t\t\tthis.frm.doc.party_account_currency);\n\n\t\tcur_frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\n\t\t\t+ \" = [?] \" + company_currency);\n\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\n\t\t\tcur_frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\n\t\t}\n\n\t\t// toggle fields\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\",\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\n\t\tthis.frm.doc.currency != company_currency);\n\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\n\n\t\tvar show = cint(cur_frm.doc.discount_amount) ||\n\t\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"net_total\"))\n\t\t\tcur_frm.toggle_display(\"net_total\", show);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"base_net_total\"))\n\t\t\tcur_frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n\n\t},\n\n\tchange_grid_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_net_rate\", \"base_price_list_rate\", \"base_amount\", \"base_net_amount\"],\n\t\t\tcompany_currency, \"items\");\n\n\t\tthis.frm.set_currency_labels([\"rate\", \"net_rate\", \"price_list_rate\", \"amount\", \"net_amount\"],\n\t\t\tthis.frm.doc.currency, \"items\");\n\n\t\tif(this.frm.fields_dict[\"operations\"]) {\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"scrap_items\"]) {\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\n\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"advances\"]) {\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\n\t\t}\n\n\t\t// toggle columns\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t});\n\n\t\tvar show = (cint(cur_frm.doc.discount_amount)) ||\n\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, show);\n\t\t});\n\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n\t\t});\n\n\t\t// set labels\n\t\tvar $wrapper = $(this.frm.wrapper);\n\t},\n\n\trecalculate: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\trecalculate_values: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tcalculate_charges: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tignore_pricing_rule: function() {\n\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\tvar me = this;\n\t\t\tvar item_list = [];\n\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tif (d.item_code && !d.is_free_item) {\n\t\t\t\t\titem_list.push({\n\t\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\t\"parent\": d.parent\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t\t\t\targs: { item_list: item_list },\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tr.message.forEach(row_item => {\n\t\t\t\t\t\t\tme.validate_pricing_rule(row_item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.apply_pricing_rule();\n\t\t}\n\t},\n\n\tapply_pricing_rule: function(item, calculate_taxes_and_totals) {\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!(args.items && args.items.length)) {\n\t\t\tif(calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n\t\t\targs: {\targs: args, doc: me.frm.doc },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\tif(item) me.set_gross_profit(item);\n\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t_get_args: function(item) {\n\t\tvar me = this;\n\t\treturn {\n\t\t\t\"items\": this._get_item_list(item),\n\t\t\t\"customer\": me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\"quotation_to\": me.frm.doc.quotation_to,\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\n\t\t\t\"territory\": me.frm.doc.territory,\n\t\t\t\"supplier\": me.frm.doc.supplier,\n\t\t\t\"supplier_group\": me.frm.doc.supplier_group,\n\t\t\t\"currency\": me.frm.doc.currency,\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\n\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\"campaign\": me.frm.doc.campaign,\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\n\t\t\t\"doctype\": me.frm.doc.doctype,\n\t\t\t\"name\": me.frm.doc.name,\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\n\t\t\t\"update_stock\": in_list(['Sales Invoice', 'Purchase Invoice'], me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : ''\n\t\t};\n\t},\n\n\t_get_item_list: function(item) {\n\t\tvar item_list = [];\n\t\tvar append_item = function(d) {\n\t\t\tif (d.item_code) {\n\t\t\t\titem_list.push({\n\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\"child_docname\": d.name,\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\"item_group\": d.item_group,\n\t\t\t\t\t\"brand\": d.brand,\n\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\"stock_qty\": d.stock_qty,\n\t\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\t\"stock_uom\": d.stock_uom,\n\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\"warehouse\": d.warehouse,\n\t\t\t\t\t\"serial_no\": d.serial_no,\n\t\t\t\t\t\"price_list_rate\": d.price_list_rate,\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0\n\t\t\t\t});\n\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\"]), d.doctype){\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (item) {\n\t\t\tappend_item(item);\n\t\t} else {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tappend_item(d);\n\t\t\t});\n\t\t}\n\t\treturn item_list;\n\t},\n\n\t_set_values_for_item_list: function(children) {\n\t\tvar me = this;\n\t\tvar price_list_rate_changed = false;\n\t\tfor(var i=0, l=children.length; i<l; i++) {\n\t\t\tvar d = children[i];\n\t\t\tvar existing_pricing_rule = frappe.model.get_value(d.doctype, d.name, \"pricing_rules\");\n\t\t\tfor(var k in d) {\n\t\t\t\tvar v = d[k];\n\t\t\t\tif ([\"doctype\", \"name\"].indexOf(k)===-1) {\n\t\t\t\t\tif(k==\"price_list_rate\") {\n\t\t\t\t\t\tif(flt(v) != flt(d.price_list_rate)) price_list_rate_changed = true;\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, v);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\n\t\t\tif(!me.frm.doc.ignore_pricing_rule && existing_pricing_rule && !d.pricing_rules) {\n\t\t\t\tme.apply_price_list(frappe.get_doc(d.doctype, d.name));\n\t\t\t} else {\n\t\t\t\tme.validate_pricing_rule(frappe.get_doc(d.doctype, d.name));\n\t\t\t}\n\t\t}\n\n\t\tif(!price_list_rate_changed) me.calculate_taxes_and_totals();\n\t},\n\n\tapply_price_list: function(item, reset_plc_conversion) {\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\n\t\tif (!reset_plc_conversion) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\n\t\t}\n\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (me.in_apply_price_list == true) return;\n\n\t\tme.in_apply_price_list = true;\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\n\t\t\targs: {\targs: args },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => me.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency),\n\t\t\t\t\t\t() => me.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif(args.items.length) {\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tme.in_apply_price_list = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}).always(() => {\n\t\t\tme.in_apply_price_list = false;\n\t\t});\n\t},\n\n\tvalidate_pricing_rule: function(item) {\n\t\tlet me = this;\n\t\tconst fields = [\"discount_percentage\", \"discount_amount\", \"pricing_rules\"];\n\n\t\tif (item.pricing_rules) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.utils.validate_pricing_rule_for_different_cond\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.frm.doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tr.message.items.forEach(d => {\n\t\t\t\t\t\t\tme.frm.doc.items.forEach(row => {\n\t\t\t\t\t\t\t\tif(d.name == row.name) {\n\t\t\t\t\t\t\t\t\tfields.forEach(f => {\n\t\t\t\t\t\t\t\t\t\trow[f] = d[f];\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tme.trigger_price_list_rate();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else if(item.remove_free_item) {\n\t\t\tvar items = [];\n\n\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\tif(d.item_code != item.remove_free_item || !d.is_free_item) {\n\t\t\t\t\titems.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.frm.doc.items = items;\n\t\t\trefresh_field('items');\n\t\t} else if(item.applied_on_items && item.apply_on) {\n\t\t\tconst applied_on_items = item.applied_on_items.split(',');\n\t\t\tme.frm.doc.items.forEach(row => {\n\t\t\t\tif(applied_on_items.includes(row[item.apply_on])) {\n\t\t\t\t\tfields.forEach(f => {\n\t\t\t\t\t\trow[f] = 0;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.trigger_price_list_rate();\n\t\t}\n\t},\n\n\ttrigger_price_list_rate: function() {\n\t\tvar me  = this;\n\n\t\tthis.frm.doc.items.forEach(child_row => {\n\t\t\tme.frm.script_manager.trigger(\"price_list_rate\",\n\t\t\t\tchild_row.doctype, child_row.name);\n\t\t})\n\t},\n\n\tvalidate_company_and_party: function() {\n\t\tvar me = this;\n\t\tvar valid = true;\n\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) && me.frm.doc.doctype != \"Purchase Order\") {\n\t\t\t\tif (!me.frm.doc[fieldname]) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\n\t\t\t\t\t\tfrappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name) +\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn valid;\n\t},\n\n\tget_terms: function() {\n\t\tvar me = this;\n\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\n\t\t\tif(!r.exc) {\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\n\t\t\t}\n\t\t});\n\t},\n\n\ttaxes_and_charges: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(me.frm.doc.shipping_rule && me.frm.doc.taxes) {\n\t\t\t\t\t\t\tfor (let tax of r.message) {\n\t\t\t\t\t\t\t\tme.frm.add_child(\"taxes\", tax);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trefresh_field(\"taxes\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\ttax_category: function() {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tfrappe.run_serially([\n\t\t\t() => this.update_item_tax_map(),\n\t\t\t() => erpnext.utils.set_taxes(this.frm, \"tax_category\"),\n\t\t]);\n\t},\n\n\titem_tax_template: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(item.item_tax_template) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_map\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\tas_json: true\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\titem.item_tax_rate = r.message;\n\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titem.item_tax_rate = \"{}\";\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t},\n\n\tupdate_item_tax_map: function() {\n\t\tvar me = this;\n\t\tvar item_codes = [];\n\t\t$.each(this.frm.doc.items || [], function(i, item) {\n\t\t\tif(item.item_code) {\n\t\t\t\titem_codes.push(item.item_code);\n\t\t\t}\n\t\t});\n\n\t\tif(item_codes.length) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_info\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\ttax_category: cstr(me.frm.doc.tax_category),\n\t\t\t\t\titem_codes: item_codes\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t$.each(me.frm.doc.items || [], function(i, item) {\n\t\t\t\t\t\t\tif(item.item_code && r.message.hasOwnProperty(item.item_code)) {\n\t\t\t\t\t\t\t\titem.item_tax_template = r.message[item.item_code].item_tax_template;\n\t\t\t\t\t\t\t\titem.item_tax_rate = r.message[item.item_code].item_tax_rate;\n\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\titem.item_tax_template = \"\";\n\t\t\t\t\t\t\t\titem.item_tax_rate = \"{}\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tis_recurring: function() {\n\t\t// set default values for recurring documents\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\n\t\t\tthis.frm.set_value('is_recurring', 0);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.frm.doc.is_recurring) {\n\t\t\tif(!this.frm.doc.recurring_id) {\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\n\t\t\t}\n\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\n\t\t\t\t? frappe.user_info(\"Administrator\").email\n\t\t\t\t: this.frm.doc.owner;\n\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\n\t\t}\n\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\n\t},\n\n\tfrom_date: function() {\n\t\t// set to_date\n\t\tif(this.frm.doc.from_date) {\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\n\t\t\t\t'Yearly': 12};\n\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\n\t\t\tif(months) {\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\n\t\t\t\t\tmonths);\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n\t\t\t\trefresh_field('to_date');\n\t\t\t}\n\t\t}\n\t},\n\n\tset_gross_profit: function(item) {\n\t\tif (this.frm.doc.doctype == \"Sales Order\" && item.valuation_rate) {\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\n\t\t}\n\t},\n\n\tsetup_item_selector: function() {\n\t\t// TODO: remove item selector\n\n\t\treturn;\n\t\t// if(!this.item_selector) {\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\n\t\t// }\n\t},\n\n\tget_advances: function() {\n\t\tif(!this.frm.is_return) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"set_advances\",\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tmake_payment_entry: function() {\n\t\treturn frappe.call({\n\t\t\tmethod: cur_frm.cscript.get_method_for_payment(),\n\t\t\targs: {\n\t\t\t\t\"dt\": cur_frm.doc.doctype,\n\t\t\t\t\"dn\": cur_frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t// cur_frm.refresh_fields()\n\t\t\t}\n\t\t});\n\t},\n\n\tget_method_for_payment: function(){\n\t\tvar method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n\t\tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\n\t\t\tif(in_list(['Sales Invoice', 'Purchase Invoice'],  cur_frm.doc.doctype)){\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n\t\t\t}else {\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n\t\t\t}\n\t\t}\n\n\t\treturn method\n\t},\n\n\tset_query_for_batch: function(doc, cdt, cdn) {\n\t\t// Show item's batches in the dropdown of batch no\n\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\n\t\t\treturn {\n\t\t\t\tfilters: {'item': item.item_code}\n\t\t\t}\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\n\t\t\t}\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\n\n\t\t\treturn {\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t},\n\n\tpayment_terms_template: function() {\n\t\tvar me = this;\n\t\tconst doc = this.frm.doc;\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\n\t\t\t\targs: {\n\t\t\t\t\tterms_template: doc.payment_terms_template,\n\t\t\t\t\tposting_date: posting_date,\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\n\t\t\t\t\tbill_date: doc.bill_date\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tpayment_term: function(doc, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tif(row.payment_term) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\n\t\t\t\targs: {\n\t\t\t\t\tterm: row.payment_term,\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tblanket_order: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = locals[cdt][cdn];\n\t\tif (item.blanket_order && (item.parenttype==\"Sales Order\" || item.parenttype==\"Purchase Order\")) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_blanket_order_details\",\n\t\t\t\targs: {\n\t\t\t\t\targs:{\n\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\tcustomer: doc.customer,\n\t\t\t\t\t\tsupplier: doc.supplier,\n\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\ttransaction_date: doc.transaction_date,\n\t\t\t\t\t\tblanket_order: item.blanket_order\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\tfrappe.throw(__(\"Invalid Blanket Order for the selected Customer and Item\"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => frappe.model.set_value(cdt, cdn, \"blanket_order_rate\", r.message.blanket_order_rate),\n\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn)\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tset_warehouse: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.set_warehouse) {\n\t\t\t$.each(this.frm.doc.items || [], function(i, item) {\n\t\t\t\tfrappe.model.set_value(me.frm.doctype + \" Item\", item.name, \"warehouse\", me.frm.doc.set_warehouse);\n\t\t\t});\n\t\t}\n\t}\n});\n\nerpnext.show_serial_batch_selector = function(frm, d, callback, on_close, show_dialog) {\n\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", function() {\n\t\tnew erpnext.SerialNoBatchSelector({\n\t\t\tfrm: frm,\n\t\t\titem: d,\n\t\t\twarehouse_details: {\n\t\t\t\ttype: \"Warehouse\",\n\t\t\t\tname: d.warehouse\n\t\t\t},\n\t\t\tcallback: callback,\n\t\t\ton_close: on_close\n\t\t}, show_dialog);\n\t});\n}\n","erpnext.ItemSelector = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = 'item_code';\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t},\n\n\tsetup: function() {\n\t\tvar me = this;\n\t\tif(!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__('Add Items'), function() {\n\t\t\t\tif(!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function() { me.dialog.input.focus(); }, 1000);\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_dialog: function() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Items')\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html('<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>');\n\n\t\tthis.dialog.input = body.find('.form-control');\n\t\tthis.dialog.results = body.find('.results');\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on('click', '.image-view-item', function() {\n\t\t\tme.add_item($(this).attr('data-name'));\n\t\t});\n\n\t\tthis.dialog.input.on('keyup', function() {\n\t\t\tif(me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function() {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t},\n\n\tadd_item: function(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif(d[this.item_field]===item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', d.qty + 1);\n\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: 'green'});\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => { d = this.grid.add_new_row(); },\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', 1);\n\t\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: 'green'});\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t},\n\n\trender_items: function() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {}\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function(r) {\n\t\t\t$.each(r.values, function(i, d) {\n\t\t\t\tif(!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template('item_selector', {'data':r.values}));\n\t\t});\n\t}\n});","frappe.provide('frappe.help.help_links');\n\nconst docsUrl = 'https://erpnext.com/docs/';\n\nfrappe.help.help_links['Form/Rename Tool'] = [\n\t{ label: 'Bulk Rename', url: docsUrl + 'user/manual/en/setting-up/data/bulk-rename' },\n]\n\n//Setup\n\nfrappe.help.help_links['List/User'] = [\n\t{ label: 'New User', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/adding-users' },\n\t{ label: 'Rename User', url: docsUrl + 'user/manual/en/setting-up/articles/rename-user' },\n]\n\nfrappe.help.help_links['permission-manager'] = [\n\t{ label: 'Role Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/role-based-permissions' },\n\t{ label: 'Managing Perm Level in Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/articles/managing-perm-level' },\n\t{ label: 'User Permissions', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/user-permissions' },\n\t{ label: 'Sharing', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/sharing' },\n\t{ label: 'Password', url: docsUrl + 'user/manual/en/setting-up/articles/change-password' },\n]\n\nfrappe.help.help_links['Form/System Settings'] = [\n\t{ label: 'Naming Series', url: docsUrl + 'user/manual/en/setting-up/settings/system-settings' },\n]\n\nfrappe.help.help_links['data-import-tool'] = [\n\t{ label: 'Importing and Exporting Data', url: docsUrl + 'user/manual/en/setting-up/data/data-import-tool' },\n\t{ label: 'Overwriting Data from Data Import Tool', url: docsUrl + 'user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool' },\n]\n\nfrappe.help.help_links['module_setup'] = [\n\t{ label: 'Role Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/role-based-permissions' },\n]\n\nfrappe.help.help_links['Form/Naming Series'] = [\n\t{ label: 'Naming Series', url: docsUrl + 'user/manual/en/setting-up/settings/naming-series' },\n\t{ label: 'Setting the Current Value for Naming Series', url: docsUrl + 'user/manual/en/setting-up/articles/naming-series-current-value' },\n]\n\nfrappe.help.help_links['Form/Global Defaults'] = [\n\t{ label: 'Global Settings', url: docsUrl + 'user/manual/en/setting-up/settings/global-defaults' },\n]\n\nfrappe.help.help_links['Form/Email Digest'] = [\n\t{ label: 'Email Digest', url: docsUrl + 'user/manual/en/setting-up/email/email-digest' },\n]\n\nfrappe.help.help_links['List/Print Heading'] = [\n\t{ label: 'Print Heading', url: docsUrl + 'user/manual/en/setting-up/print/print-headings' },\n]\n\nfrappe.help.help_links['List/Letter Head'] = [\n\t{ label: 'Letter Head', url: docsUrl + 'user/manual/en/setting-up/print/letter-head' },\n]\n\nfrappe.help.help_links['List/Address Template'] = [\n\t{ label: 'Address Template', url: docsUrl + 'user/manual/en/setting-up/print/address-template' },\n]\n\nfrappe.help.help_links['List/Terms and Conditions'] = [\n\t{ label: 'Terms and Conditions', url: docsUrl + 'user/manual/en/setting-up/print/terms-and-conditions' },\n]\n\nfrappe.help.help_links['List/Cheque Print Template'] = [\n\t{ label: 'Cheque Print Template', url: docsUrl + 'user/manual/en/setting-up/print/cheque-print-template' },\n]\n\nfrappe.help.help_links['List/Email Account'] = [\n\t{ label: 'Email Account', url: docsUrl + 'user/manual/en/setting-up/email/email-account' },\n]\n\nfrappe.help.help_links['List/Notification'] = [\n\t{ label: 'Notification', url: docsUrl + 'user/manual/en/setting-up/email/notifications' },\n]\n\nfrappe.help.help_links['Form/Notification'] = [\n\t{ label: 'Notification', url: docsUrl + 'user/manual/en/setting-up/email/notifications' },\n]\n\nfrappe.help.help_links['List/Email Digest'] = [\n\t{ label: 'Email Digest', url: docsUrl + 'user/manual/en/setting-up/email/email-digest' },\n]\n\nfrappe.help.help_links['List/Auto Email Report'] = [\n\t{ label: 'Auto Email Reports', url: docsUrl + 'user/manual/en/setting-up/email/email-reports' },\n]\n\nfrappe.help.help_links['Form/Print Settings'] = [\n\t{ label: 'Print Settings', url: docsUrl + 'user/manual/en/setting-up/print/print-settings' },\n]\n\nfrappe.help.help_links['print-format-builder'] = [\n\t{ label: 'Print Format Builder', url: docsUrl + 'user/manual/en/setting-up/print/print-settings' },\n]\n\nfrappe.help.help_links['List/Print Heading'] = [\n\t{ label: 'Print Heading', url: docsUrl + 'user/manual/en/setting-up/print/print-headings' },\n]\n\n//setup-integrations\n\nfrappe.help.help_links['Form/PayPal Settings'] = [\n\t{ label: 'PayPal Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/paypal-integration' },\n]\n\nfrappe.help.help_links['Form/Razorpay Settings'] = [\n\t{ label: 'Razorpay Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/razorpay-integration' },\n]\n\nfrappe.help.help_links['Form/Dropbox Settings'] = [\n\t{ label: 'Dropbox Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/dropbox-backup' },\n]\n\nfrappe.help.help_links['Form/LDAP Settings'] = [\n\t{ label: 'LDAP Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/ldap-integration' },\n]\n\nfrappe.help.help_links['Form/Stripe Settings'] = [\n\t{ label: 'Stripe Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/stripe-integration' },\n]\n\n//Sales\n\nfrappe.help.help_links['Form/Quotation'] = [\n\t{ label: 'Quotation', url: docsUrl + 'user/manual/en/selling/quotation' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/selling/articles/sales-persons-in-the-sales-transactions' },\n\t{ label: 'Applying Margin', url: docsUrl + 'user/manual/en/selling/articles/adding-margin' },\n]\n\nfrappe.help.help_links['List/Customer'] = [\n\t{ label: 'Customer', url: docsUrl + 'user/manual/en/CRM/customer' },\n\t{ label: 'Credit Limit', url: docsUrl + 'user/manual/en/accounts/credit-limit' },\n]\n\nfrappe.help.help_links['Form/Customer'] = [\n\t{ label: 'Customer', url: docsUrl + 'user/manual/en/CRM/customer' },\n\t{ label: 'Credit Limit', url: docsUrl + 'user/manual/en/accounts/credit-limit' },\n]\n\nfrappe.help.help_links['List/Sales Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['Form/Sales Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['List/Sales Order'] = [\n\t{ label: 'Sales Order', url: docsUrl + 'user/manual/en/selling/sales-order' },\n\t{ label: 'Recurring Sales Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n]\n\nfrappe.help.help_links['Form/Sales Order'] = [\n\t{ label: 'Sales Order', url: docsUrl + 'user/manual/en/selling/sales-order' },\n\t{ label: 'Recurring Sales Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n\t{ label: 'Drop Shipping', url: docsUrl + 'user/manual/en/selling/articles/drop-shipping' },\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/selling/articles/sales-persons-in-the-sales-transactions' },\n\t{ label: 'Close Sales Order', url: docsUrl + 'user/manual/en/selling/articles/close-sales-order' },\n\t{ label: 'Applying Margin', url: docsUrl + 'user/manual/en/selling/articles/adding-margin' },\n]\n\nfrappe.help.help_links['Form/Product Bundle'] = [\n\t{ label: 'Product Bundle', url: docsUrl + 'user/manual/en/selling/setup/product-bundle' },\n]\n\nfrappe.help.help_links['Form/Selling Settings'] = [\n\t{ label: 'Selling Settings', url: docsUrl + 'user/manual/en/selling/setup/selling-settings' },\n]\n\n//Buying\n\nfrappe.help.help_links['List/Supplier'] = [\n\t{ label: 'Supplier', url: docsUrl + 'user/manual/en/buying/supplier' },\n]\n\nfrappe.help.help_links['Form/Supplier'] = [\n\t{ label: 'Supplier', url: docsUrl + 'user/manual/en/buying/supplier' },\n]\n\nfrappe.help.help_links['Form/Request for Quotation'] = [\n\t{ label: 'Request for Quotation', url: docsUrl + 'user/manual/en/buying/request-for-quotation' },\n\t{ label: 'RFQ Video', url: docsUrl + 'user/videos/learn/request-for-quotation.html' },\n]\n\nfrappe.help.help_links['Form/Supplier Quotation'] = [\n\t{ label: 'Supplier Quotation', url: docsUrl + 'user/manual/en/buying/supplier-quotation' },\n]\n\nfrappe.help.help_links['Form/Buying Settings'] = [\n\t{ label: 'Buying Settings', url: docsUrl + 'user/manual/en/buying/setup/buying-settings' },\n]\n\nfrappe.help.help_links['List/Purchase Order'] = [\n\t{ label: 'Purchase Order', url: docsUrl + 'user/manual/en/buying/purchase-order' },\n\t{ label: 'Recurring Purchase Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['Form/Purchase Order'] = [\n\t{ label: 'Purchase Order', url: docsUrl + 'user/manual/en/buying/purchase-order' },\n\t{ label: 'Item UoM', url: docsUrl + 'user/manual/en/buying/articles/purchasing-in-different-unit' },\n\t{ label: 'Supplier Item Code', url: docsUrl + 'user/manual/en/buying/articles/maintaining-suppliers-part-no-in-item' },\n\t{ label: 'Recurring Purchase Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Purchase Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['List/POS Profile'] = [\n\t{ label: 'POS Profile', url: docsUrl + 'user/manual/en/setting-up/pos-setting' },\n]\n\nfrappe.help.help_links['List/Price List'] = [\n\t{ label: 'Price List', url: docsUrl + 'user/manual/en/setting-up/price-lists' },\n]\n\nfrappe.help.help_links['List/Authorization Rule'] = [\n\t{ label: 'Authorization Rule', url: docsUrl + 'user/manual/en/setting-up/authorization-rule' },\n]\n\nfrappe.help.help_links['Form/SMS Settings'] = [\n\t{ label: 'SMS Settings', url: docsUrl + 'user/manual/en/setting-up/sms-setting' },\n]\n\nfrappe.help.help_links['List/Stock Reconciliation'] = [\n\t{ label: 'Stock Reconciliation', url: docsUrl + 'user/manual/en/setting-up/stock-reconciliation-for-non-serialized-item' },\n]\n\nfrappe.help.help_links['Tree/Territory'] = [\n\t{ label: 'Territory', url: docsUrl + 'user/manual/en/setting-up/territory' },\n]\n\nfrappe.help.help_links['Form/Dropbox Backup'] = [\n\t{ label: 'Dropbox Backup', url: docsUrl + 'user/manual/en/setting-up/third-party-backups' },\n\t{ label: 'Setting Up Dropbox Backup', url: docsUrl + 'user/manual/en/setting-up/articles/setting-up-dropbox-backups' },\n]\n\nfrappe.help.help_links['List/Workflow'] = [\n\t{ label: 'Workflow', url: docsUrl + 'user/manual/en/setting-up/workflows' },\n]\n\nfrappe.help.help_links['List/Company'] = [\n\t{ label: 'Company', url: docsUrl + 'user/manual/en/setting-up/company-setup' },\n\t{ label: 'Managing Multiple Companies', url: docsUrl + 'user/manual/en/setting-up/articles/managing-multiple-companies' },\n\t{ label: 'Delete All Related Transactions for a Company', url: docsUrl + 'user/manual/en/setting-up/articles/delete-a-company-and-all-related-transactions' },\n]\n\n//Accounts\n\nfrappe.help.help_links['modules/Accounts'] = [\n\t{ label: 'Introduction to Accounts', url: docsUrl + 'user/manual/en/accounts/' },\n\t{ label: 'Chart of Accounts', url: docsUrl + 'user/manual/en/accounts/chart-of-accounts.html' },\n\t{ label: 'Multi Currency Accounting', url: docsUrl + 'user/manual/en/accounts/multi-currency-accounting' },\n]\n\nfrappe.help.help_links['Tree/Account'] = [\n\t{ label: 'Chart of Accounts', url: docsUrl + 'user/manual/en/accounts/chart-of-accounts' },\n\t{ label: 'Managing Tree Mastes', url: docsUrl + 'user/manual/en/setting-up/articles/managing-tree-structure-masters' },\n]\n\nfrappe.help.help_links['Form/Sales Invoice'] = [\n\t{ label: 'Sales Invoice', url: docsUrl + 'user/manual/en/accounts/sales-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Recurring Sales Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['List/Sales Invoice'] = [\n\t{ label: 'Sales Invoice', url: docsUrl + 'user/manual/en/accounts/sales-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Recurring Sales Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['pos'] = [\n\t{ label: 'Point of Sale Invoice', url: docsUrl + 'user/manual/en/accounts/point-of-sale-pos-invoice' },\n]\n\nfrappe.help.help_links['List/POS Profile'] = [\n\t{ label: 'Point of Sale Profile', url: docsUrl + 'user/manual/en/setting-up/pos-setting' },\n]\n\nfrappe.help.help_links['List/Purchase Invoice'] = [\n\t{ label: 'Purchase Invoice', url: docsUrl + 'user/manual/en/accounts/purchase-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Recurring Purchase Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['List/Journal Entry'] = [\n\t{ label: 'Journal Entry', url: docsUrl + 'user/manual/en/accounts/journal-entry' },\n\t{ label: 'Advance Payment Entry', url: docsUrl + 'user/manual/en/accounts/advance-payment-entry' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n]\n\nfrappe.help.help_links['List/Payment Entry'] = [\n\t{ label: 'Payment Entry', url: docsUrl + 'user/manual/en/accounts/payment-entry' },\n]\n\nfrappe.help.help_links['List/Payment Request'] = [\n\t{ label: 'Payment Request', url: docsUrl + 'user/manual/en/accounts/payment-request' },\n]\n\nfrappe.help.help_links['List/Asset'] = [\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n]\n\nfrappe.help.help_links['List/Asset Category'] = [\n\t{ label: 'Asset Category', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n]\n\nfrappe.help.help_links['Tree/Cost Center'] = [\n\t{ label: 'Budgeting', url: docsUrl + 'user/manual/en/accounts/budgeting' },\n]\n\nfrappe.help.help_links['List/Item'] = [\n\t{ label: 'Item', url: docsUrl + 'user/manual/en/stock/item' },\n\t{ label: 'Item Price', url: docsUrl + 'user/manual/en/stock/item/item-price' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Item Wise Taxation', url: docsUrl + 'user/manual/en/accounts/item-wise-taxation' },\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n\t{ label: 'Item Codification', url: docsUrl + 'user/manual/en/stock/item/item-codification' },\n\t{ label: 'Item Variants', url: docsUrl + 'user/manual/en/stock/item/item-variants' },\n\t{ label: 'Item Valuation', url: docsUrl + 'user/manual/en/stock/item/item-valuation-fifo-and-moving-average' },\n]\n\nfrappe.help.help_links['Form/Item'] = [\n\t{ label: 'Item', url: docsUrl + 'user/manual/en/stock/item' },\n\t{ label: 'Item Price', url: docsUrl + 'user/manual/en/stock/item/item-price' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Item Wise Taxation', url: docsUrl + 'user/manual/en/accounts/item-wise-taxation' },\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n\t{ label: 'Item Codification', url: docsUrl + 'user/manual/en/stock/item/item-codification' },\n\t{ label: 'Item Variants', url: docsUrl + 'user/manual/en/stock/item/item-variants' },\n\t{ label: 'Item Valuation', url: docsUrl + 'user/manual/en/stock/item/item-valuation-fifo-and-moving-average' },\n]\n\nfrappe.help.help_links['List/Purchase Receipt'] = [\n\t{ label: 'Purchase Receipt', url: docsUrl + 'user/manual/en/stock/purchase-receipt' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n]\n\nfrappe.help.help_links['List/Delivery Note'] = [\n\t{ label: 'Delivery Note', url: docsUrl + 'user/manual/en/stock/delivery-note' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n]\n\nfrappe.help.help_links['Form/Delivery Note'] = [\n\t{ label: 'Delivery Note', url: docsUrl + 'user/manual/en/stock/delivery-note' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Installation Note'] = [\n\t{ label: 'Installation Note', url: docsUrl + 'user/manual/en/stock/installation-note' },\n]\n\n\nfrappe.help.help_links['Tree'] = [\n\t{ label: 'Managing Tree Structure Masters', url: docsUrl + 'user/manual/en/setting-up/articles/managing-tree-structure-masters' },\n]\n\nfrappe.help.help_links['List/Budget'] = [\n\t{ label: 'Budgeting', url: docsUrl + 'user/manual/en/accounts/budgeting' },\n]\n\n//Stock\n\nfrappe.help.help_links['List/Material Request'] = [\n\t{ label: 'Material Request', url: docsUrl + 'user/manual/en/stock/material-request' },\n\t{ label: 'Auto-creation of Material Request', url: docsUrl + 'user/manual/en/stock/articles/auto-creation-of-material-request' },\n]\n\nfrappe.help.help_links['Form/Material Request'] = [\n\t{ label: 'Material Request', url: docsUrl + 'user/manual/en/stock/material-request' },\n\t{ label: 'Auto-creation of Material Request', url: docsUrl + 'user/manual/en/stock/articles/auto-creation-of-material-request' },\n]\n\nfrappe.help.help_links['Form/Stock Entry'] = [\n\t{ label: 'Stock Entry', url: docsUrl + 'user/manual/en/stock/stock-entry' },\n\t{ label: 'Stock Entry Types', url: docsUrl + 'user/manual/en/stock/articles/stock-entry-purpose' },\n\t{ label: 'Repack Entry', url: docsUrl + 'user/manual/en/stock/articles/repack-entry' },\n\t{ label: 'Opening Stock', url: docsUrl + 'user/manual/en/stock/opening-stock' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Stock Entry'] = [\n\t{ label: 'Stock Entry', url: docsUrl + 'user/manual/en/stock/stock-entry' },\n]\n\nfrappe.help.help_links['Tree/Warehouse'] = [\n\t{ label: 'Warehouse', url: docsUrl + 'user/manual/en/stock/warehouse' },\n]\n\nfrappe.help.help_links['List/Serial No'] = [\n\t{ label: 'Serial No', url: docsUrl + 'user/manual/en/stock/serial-no' },\n]\n\nfrappe.help.help_links['Form/Serial No'] = [\n\t{ label: 'Serial No', url: docsUrl + 'user/manual/en/stock/serial-no' },\n]\n\nfrappe.help.help_links['Form/Batch'] = [\n\t{ label: 'Batch', url: docsUrl + 'user/manual/en/stock/batch' },\n]\n\nfrappe.help.help_links['Form/Packing Slip'] = [\n\t{ label: 'Packing Slip', url: docsUrl + 'user/manual/en/stock/tools/packing-slip' },\n]\n\nfrappe.help.help_links['Form/Quality Inspection'] = [\n\t{ label: 'Quality Inspection', url: docsUrl + 'user/manual/en/stock/tools/quality-inspection' },\n]\n\nfrappe.help.help_links['Form/Landed Cost Voucher'] = [\n\t{ label: 'Landed Cost Voucher', url: docsUrl + 'user/manual/en/stock/tools/landed-cost-voucher' },\n]\n\nfrappe.help.help_links['Tree/Item Group'] = [\n\t{ label: 'Item Group', url: docsUrl + 'user/manual/en/stock/setup/item-group' },\n]\n\nfrappe.help.help_links['Form/Item Attribute'] = [\n\t{ label: 'Item Attribute', url: docsUrl + 'user/manual/en/stock/setup/item-attribute' },\n]\n\nfrappe.help.help_links['Form/UOM'] = [\n\t{ label: 'Fractions in UOM', url: docsUrl + 'user/manual/en/stock/articles/managing-fractions-in-uom' },\n]\n\nfrappe.help.help_links['Form/Stock Reconciliation'] = [\n\t{ label: 'Opening Stock Entry', url: docsUrl + 'user/manual/en/stock/opening-stock' },\n]\n\n//CRM\n\nfrappe.help.help_links['Form/Lead'] = [\n\t{ label: 'Lead', url: docsUrl + 'user/manual/en/CRM/lead' },\n]\n\nfrappe.help.help_links['Form/Opportunity'] = [\n\t{ label: 'Opportunity', url: docsUrl + 'user/manual/en/CRM/opportunity' },\n]\n\nfrappe.help.help_links['Form/Address'] = [\n\t{ label: 'Address', url: docsUrl + 'user/manual/en/CRM/contact' },\n]\n\nfrappe.help.help_links['Form/Contact'] = [\n\t{ label: 'Contact', url: docsUrl + 'user/manual/en/CRM/contact' },\n]\n\nfrappe.help.help_links['Form/Newsletter'] = [\n\t{ label: 'Newsletter', url: docsUrl + 'user/manual/en/CRM/newsletter' },\n]\n\nfrappe.help.help_links['Form/Campaign'] = [\n\t{ label: 'Campaign', url: docsUrl + 'user/manual/en/CRM/setup/campaign' },\n]\n\nfrappe.help.help_links['Tree/Sales Person'] = [\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/CRM/setup/sales-person' },\n]\n\nfrappe.help.help_links['Form/Sales Person'] = [\n\t{ label: 'Sales Person Target', url: docsUrl + 'user/manual/en/selling/setup/sales-person-target-allocation' },\n]\n\n//Support\n\nfrappe.help.help_links['List/Feedback Trigger'] = [\n\t{ label: 'Feedback Trigger', url: docsUrl + 'user/manual/en/setting-up/feedback/setting-up-feedback' },\n]\n\nfrappe.help.help_links['List/Feedback Request'] = [\n\t{ label: 'Feedback Request', url: docsUrl + 'user/manual/en/setting-up/feedback/submit-feedback' },\n]\n\nfrappe.help.help_links['List/Feedback Request'] = [\n\t{ label: 'Feedback Request', url: docsUrl + 'user/manual/en/setting-up/feedback/submit-feedback' },\n]\n\n//Manufacturing\n\nfrappe.help.help_links['Form/BOM'] = [\n\t{ label: 'Bill of Material', url: docsUrl + 'user/manual/en/manufacturing/bill-of-materials' },\n\t{ label: 'Nested BOM Structure', url: docsUrl + 'user/manual/en/manufacturing/articles/nested-bom-structure' },\n]\n\nfrappe.help.help_links['Form/Work Order'] = [\n\t{ label: 'Work Order', url: docsUrl + 'user/manual/en/manufacturing/work-order' },\n]\n\nfrappe.help.help_links['Form/Workstation'] = [\n\t{ label: 'Workstation', url: docsUrl + 'user/manual/en/manufacturing/workstation' },\n]\n\nfrappe.help.help_links['Form/Operation'] = [\n\t{ label: 'Operation', url: docsUrl + 'user/manual/en/manufacturing/operation' },\n]\n\nfrappe.help.help_links['Form/BOM Update Tool'] = [\n\t{ label: 'BOM Update Tool', url: docsUrl + 'user/manual/en/manufacturing/tools/bom-update-tool' },\n]\n\n//Customize\n\nfrappe.help.help_links['Form/Customize Form'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n\t{ label: 'Customize Field', url: docsUrl + 'user/manual/en/customize-erpnext/customize-form' },\n]\n\nfrappe.help.help_links['Form/Custom Field'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n]\n\nfrappe.help.help_links['Form/Custom Field'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n]\n","frappe.provide('agriculture');\n\nagriculture.TernaryPlot = class TernaryPlot {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\n\t\tfrappe.require('assets/frappe/js/lib/snap.svg-min.js', () => {\n\t\t\tthis.make_svg();\n\t\t\tthis.init_snap();\n\t\t\tthis.init_config();\n\t\t\tthis.make_plot();\n\t\t\tthis.make_plot_marking();\n\t\t\tthis.make_legend();\n\t\t\tthis.mark_blip();\n\t\t});\n\t}\n\n\tmake_svg() {\n\t\tthis.$svg = $('<svg height=\"350\" width=\"400\">');\n\t\t$(this.parent).append(this.$svg);\n\t}\n\n\tinit_snap() {\n\t\tthis.paper = new Snap(this.$svg.get(0));\n\t}\n\n\tinit_config() {\n\t\tthis.config = {\n\t\t\ttriangle_side: 300,\n\t\t\tspacing: 50,\n\t\t\tstrokeWidth: 1,\n\t\t\tstroke: frappe.ui.color.get('black')\n\t\t};\n\t\tthis.config.scaling_factor = this.config.triangle_side / 100;\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tthis.coords = {\n\t\t\tsand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('peach')\n\t\t\t},\n\t\t\tloamy_sand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + 10 * p * Snap.cos(60), s + (100 - 10) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 85) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 70) * p, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink')\n\t\t\t},\n\t\t\tsandy_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 75) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'light')\n\t\t\t},\n\t\t\tloam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60) - 22.5 * p, s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('brown')\n\t\t\t},\n\t\t\tsilt_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'dark')\n\t\t\t},\n\t\t\tsilt: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green')\n\t\t\t},\n\t\t\tsilty_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan', 'dark')\n\t\t\t},\n\t\t\tsilty_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan')\n\t\t\t},\n\t\t\tclay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'light')\n\t\t\t},\n\t\t\tsandy_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'dark')\n\t\t\t},\n\t\t\tsandy_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('red')\n\t\t\t},\n\t\t\tclay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('yellow')\n\t\t\t},\n\t\t};\n\t}\n\n\tget_coords(soil_type) {\n\t\treturn this.coords[soil_type].points;\n\t}\n\n\tget_color(soil_type) {\n\t\treturn this.coords[soil_type].color;\n\t}\n\n\tmake_plot() {\n\t\tfor (let soil_type in this.coords) {\n\t\t\tthis.paper.polygon(this.get_coords(soil_type)).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: this.config.stroke,\n\t\t\t\tstrokeWidth: this.config.strokeWidth\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_plot_marking() {\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tlet clay = this.paper.text(t * Snap.cos(60) / 2, s + t * Snap.cos(30) / 2, __(\"Clay\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tclay.transform(\"r300\");\n\n\t\tlet silt = this.paper.text(t, s + t * Snap.cos(30) / 2, __(\"Silt\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsilt.transform(\"r60\");\n\n\t\tlet sand = this.paper.text(35 + t * Snap.cos(60), 90 + t * Snap.cos(30), __(\"Sand\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsand.transform(\"r0\");\n\t}\n\n\tmake_legend() {\n\t\t// let side = len(this.coords)/2;\n\t\tlet index = 1;\n\t\tlet offset = 0;\n\t\tlet exec_once = true;\n\t\tfor (let soil_type in this.coords) {\n\t\t\tif (index > 6 && exec_once){\n\t\t\t\toffset = 300;\n\t\t\t\tindex = 1;\n\t\t\t\texec_once = false;\n\t\t\t}\n\t\t\tlet rect = this.paper.rect(0+offset, 0+index*20, 100, 19, 5, 5).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: frappe.ui.color.get('black')\n\t\t\t});\n\t\t\tlet text = this.paper.text(5+offset, 16+index*20, soil_type).attr({\n\t\t\t\tfill: frappe.ui.color.get('black'),\n\t\t\t\t'font-size': 12\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\t}\n\n\tmark_blip({clay, sand, silt} = this) {\n\t\tif (clay + sand + silt != 0){\n\t\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\t\tlet x_blip = s + clay * p * Snap.cos(60) + silt * p;\n\t\t\tlet y_blip = s + silt * p * Snap.cos(30) + sand * p * Snap.sin(60);\n\t\t\tthis.blip = this.paper.circle(x_blip, y_blip, 4).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstroke: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstrokeWidth: 2\n\t\t\t});\n\t\t}\n\t}\n\n\tremove_blip() {\n\t\tif (typeof this.blip !== 'undefined')\n\t\t\tthis.blip.remove();\n\t}\n};\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.ItemQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.get_variant_fields().concat(this.mandatory);\n\t\tthis.mandatory = this.mandatory.concat(this.get_attributes_fields());\n\t\tthis._super();\n\t\tthis.init_post_render_dialog_operations();\n\t\tthis.preset_fields_for_template();\n\t\tthis.dialog.$wrapper.find('.edit-full').text(__('Edit in full page for more options like assets, serial nos, batches etc.'))\n\t},\n\n\tinit_post_render_dialog_operations: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.append(frappe.render_template(\"item_quick_entry\"));\n\t\tthis.init_for_create_variant_trigger();\n\t\tthis.init_for_item_template_trigger();\n\t\t// explicitly hide manufacturing fields as hidden not working.\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.get_field(\"item_template\").df.hidden = 1;\n\t\tthis.dialog.get_field(\"item_template\").refresh();\n\t},\n\n\tregister_primary_action: function() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif (me.dialog.working) return;\n\n\t\t\tvar data = me.dialog.get_values();\n\t\t\tvar variant_values = {};\n\n\t\t\tif (me.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\t\tvariant_values = me.get_variant_doc();\n\t\t\t\tif (!Object.keys(variant_values).length) {\n\t\t\t\t\tdata = null;\n\t\t\t\t}\n\t\t\t\tvariant_values.stock_uom = me.template_doc.stock_uom;\n\t\t\t\tvariant_values.item_group = me.template_doc.item_group;\n\t\t\t}\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tvar values = me.update_doc();\n\t\t\t\t//patch for manufacturer type variants as extend is overwriting it.\n\t\t\t\tif (variant_values['variant_based_on'] == \"Manufacturer\") {\n\t\t\t\t\tvalues['variant_based_on'] = \"Manufacturer\";\n\t\t\t\t}\n\t\t\t\t$.extend(variant_values, values);\n\t\t\t\tme.insert(variant_values);\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function(variant_values) {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: variant_values\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_doc: function() {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (this.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\tvar template = this.dialog.fields_dict.item_template.input.value;\n\t\t\tif (template)\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, template);\n\t\t} else {\n\t\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t\t}\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldname: \"create_variant\",\n\t\t\tfieldtype: \"Check\",\n\t\t\tlabel: __(\"Create Variant\")\n\t\t},\n\t\t{\n\t\t\tfieldname: 'item_template',\n\t\t\tlabel: __('Item Template'),\n\t\t\treqd: 0,\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: \"Item\",\n\t\t\tget_query: function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"has_variants\": 1\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n\n\tget_manufacturing_fields: function() {\n\t\tthis.manufacturer_fields = [{\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Manufacturer',\n\t\t\tlabel: 'Manufacturer',\n\t\t\tfieldname: \"manufacturer\",\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}, {\n\t\t\tfieldtype: 'Data',\n\t\t\tlabel: 'Manufacturer Part Number',\n\t\t\tfieldname: 'manufacturer_part_no',\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}];\n\t\treturn this.manufacturer_fields;\n\t},\n\n\tget_attributes_fields: function() {\n\t\tvar attribute_fields = [{\n\t\t\tfieldname: 'attribute_html',\n\t\t\tfieldtype: 'HTML'\n\t\t}]\n\n\t\tattribute_fields = attribute_fields.concat(this.get_manufacturing_fields());\n\t\treturn attribute_fields;\n\t},\n\n\tinit_for_create_variant_trigger: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog.fields_dict.create_variant.$input.on(\"click\", function() {\n\t\t\tme.preset_fields_for_template();\n\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t});\n\t},\n\n\tpreset_fields_for_template: function() {\n\t\tvar for_variant = this.dialog.get_value('create_variant');\n\n\t\t// setup template field, seen and mandatory if variant\n\t\tlet template_field = this.dialog.get_field(\"item_template\");\n\t\ttemplate_field.df.reqd = for_variant;\n\t\ttemplate_field.set_value('');\n\t\ttemplate_field.df.hidden = !for_variant;\n\t\ttemplate_field.refresh();\n\n\t\t// hide properties for variant\n\t\t['item_code', 'item_name', 'item_group', 'stock_uom'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.hidden = for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t\tthis.dialog.get_field('attribute_html').toggle(false);\n\n\t\t// non mandatory for variants\n\t\t['item_code', 'stock_uom', 'item_group'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.reqd = !for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t},\n\n\tinit_for_item_template_trigger: function() {\n\t\tvar me = this;\n\n\t\tme.dialog.fields_dict[\"item_template\"].df.onchange = () => {\n\t\t\tvar template = me.dialog.fields_dict.item_template.input.value;\n\t\t\tme.template_doc = null;\n\t\t\tif (template) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: template\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tme.template_doc = r.message;\n\t\t\t\t\t\tme.is_manufacturer = false;\n\n\t\t\t\t\t\tif (me.template_doc.variant_based_on === \"Manufacturer\") {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(true, [], true);\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(false, me.template_doc.attributes, false);\n\t\t\t\t\t\t\tme.render_attributes(me.template_doc.attributes);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.dialog.get_field('attribute_html').toggle(false);\n\t\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t\t}\n\t\t}\n\t},\n\n\tinit_post_template_trigger_operations: function(is_manufacturer, attributes, attributes_flag) {\n\t\tthis.attributes = attributes;\n\t\tthis.attribute_values = {};\n\t\tthis.attributes_count = attributes.length;\n\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.is_manufacturer = is_manufacturer;\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").toggleClass(\"hide-control\", attributes_flag);\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes-header\").toggleClass(\"hide-control\", attributes_flag);\n\t},\n\n\ttoggle_manufacturer_fields: function() {\n\t\tvar me = this;\n\t\t$.each(this.manufacturer_fields, function(i, dialog_field) {\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.hidden = !me.is_manufacturer;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.reqd = dialog_field.fieldname == 'manufacturer' ? me.is_manufacturer : false;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).refresh();\n\t\t});\n\t},\n\n\tinitiate_render_attributes: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.render_attributes(this.attributes);\n\t},\n\n\trender_attributes: function(attributes) {\n\t\tvar me = this;\n\n\t\tthis.dialog.get_field('attribute_html').toggle(true);\n\n\t\t$.each(attributes, function(index, row) {\n\t\t\tvar desc = \"\";\n\t\t\tvar fieldtype = \"Data\";\n\t\t\tif (row.numeric_values) {\n\t\t\t\tfieldtype = \"Float\";\n\t\t\t\tdesc = \"Min Value: \" + row.from_range + \" , Max Value: \" + row.to_range + \", in Increments of: \" + row.increment;\n\t\t\t}\n\n\t\t\tme.init_make_control(fieldtype, row);\n\t\t\tme[row.attribute].set_value(me.attribute_values[row.attribute] || \"\");\n\t\t\tme[row.attribute].$wrapper.toggleClass(\"has-error\", me.attribute_values[row.attribute] ? false : true);\n\n\t\t\t// Set Label explicitly as make_control is not displaying label\n\t\t\t$(me[row.attribute].label_area).text(__(row.attribute));\n\n\t\t\tif (desc) {\n\t\t\t\t$(repl(`<p class=\"help-box small text-muted hidden-xs\">%(desc)s</p>`, {\n\t\t\t\t\t\"desc\": desc\n\t\t\t\t})).insertAfter(me[row.attribute].input_area);\n\t\t\t}\n\n\t\t\tif (!row.numeric_values) {\n\t\t\t\tme.init_awesomplete_for_attribute(row);\n\t\t\t} else {\n\t\t\t\tme[row.attribute].$input.on(\"change\", function() {\n\t\t\t\t\tme.attribute_values[row.attribute] = $(this).val();\n\t\t\t\t\t$(this).closest(\".frappe-control\").toggleClass(\"has-error\", $(this).val() ? false : true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_make_control: function(fieldtype, row) {\n\t\tthis[row.attribute] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\t\"fieldtype\": fieldtype,\n\t\t\t\t\"label\": row.attribute,\n\t\t\t\t\"fieldname\": row.attribute,\n\t\t\t\t\"options\": row.options || \"\"\n\t\t\t},\n\t\t\tparent: $(this.dialog.fields_dict.attribute_html.wrapper).find(\".attributes\"),\n\t\t\tonly_input: false\n\t\t});\n\t\tthis[row.attribute].make_input();\n\t},\n\n\tinit_awesomplete_for_attribute: function(row) {\n\t\tvar me = this;\n\n\t\tthis[row.attribute].input.awesomplete = new Awesomplete(this[row.attribute].input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: [],\n\t\t});\n\n\t\tthis[row.attribute].$input.on('input', function(e) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Item Attribute Value\",\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t[\"parent\", \"=\", $(e.target).attr(\"data-fieldname\")],\n\t\t\t\t\t\t[\"attribute_value\", \"like\", e.target.value + \"%\"]\n\t\t\t\t\t],\n\t\t\t\t\tfields: [\"attribute_value\"],\n\t\t\t\t\tparent: \"Item Attribute\"\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\te.target.awesomplete.list = r.message.map(function(d) {\n\t\t\t\t\t\t\treturn d.attribute_value;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}).on('focus', function(e) {\n\t\t\t$(e.target).val('').trigger('input');\n\t\t}).on(\"awesomplete-close\", function (e) {\n\t\t\tme.attribute_values[$(e.target).attr(\"data-fieldname\")] = e.target.value;\n\t\t\t$(e.target).closest(\".frappe-control\").toggleClass(\"has-error\", e.target.value ? false : true);\n\t\t});\n\t},\n\n\tget_variant_doc: function() {\n\t\tvar me = this;\n\t\tvar variant_doc = {};\n\t\tvar attribute = this.validate_mandatory_attributes();\n\n\t\tif (Object.keys(attribute).length) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.item_variant.create_variant_doc_for_quick_entry\",\n\t\t\t\targs: {\n\t\t\t\t\t\"template\": me.dialog.fields_dict.item_template.$input.val(),\n\t\t\t\t\targs: attribute\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (Object.prototype.toString.call(r.message) == \"[object Object]\") {\n\t\t\t\t\t\tvariant_doc = r.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(__(\"Item Variant {0} already exists with same attributes\", [repl('<a class=\"strong variant-click\" data-item-code=\"%(item)s\" \\\n\t\t\t\t\t\t\t\t>%(item)s</a>', {\n\t\t\t\t\t\t\t\titem: r.message\n\t\t\t\t\t\t\t})]));\n\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function() {\n\t\t\t\t\t\t\tmsgprint_dialog.hide();\n\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\t\tfrappe._from_link.set_value($(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.set_route('Form', \"Item\", $(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn variant_doc;\n\t},\n\n\tvalidate_mandatory_attributes: function() {\n\t\tvar me = this;\n\t\tvar attribute = {};\n\t\tvar mandatory = [];\n\n\t\t$.each(this.attributes, function(index, attr) {\n\t\t\tvar value = me.attribute_values[attr.attribute] || \"\";\n\t\t\tif (value) {\n\t\t\t\tattribute[attr.attribute] = attr.numeric_values ? flt(value) : value;\n\t\t\t} else {\n\t\t\t\tmandatory.push(attr.attribute);\n\t\t\t}\n\t\t})\n\n\t\tif (this.is_manufacturer) {\n\t\t\t$.each(this.manufacturer_fields, function(index, field) {\n\t\t\t\tattribute[field.fieldname] = me.dialog.fields_dict[field.fieldname].input.value;\n\t\t\t});\n\t\t}\n\t\treturn attribute;\n\t}\n});","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tthis._super();\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Email Id\"),\n\t\t\tfieldname: \"email_id\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\tfieldname: \"mobile_no\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\tfieldname: \"address_line1\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\tfieldname: \"address_line2\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\tfieldname: \"pincode\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"City\"),\n\t\t\tfieldname: \"city\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"State\"),\n\t\t\tfieldname: \"state\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Country\"),\n\t\t\tfieldname: \"country\",\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Country\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\tfieldname: \"customer_pos_id\",\n\t\t\tfieldtype: \"Data\",\n\t\t\thidden: 1\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n})","frappe.provide('erpnext.hub');\n\nfrappe.views.MarketplaceFactory = class MarketplaceFactory extends frappe.views.Factory {\n\tshow() {\n\t\tis_marketplace_disabled()\n\t\t\t.then(disabled => {\n\t\t\t\tif (disabled) {\n\t\t\t\t\tfrappe.show_not_found('Marketplace');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (frappe.pages.marketplace) {\n\t\t\t\t\tfrappe.container.change_to('marketplace');\n\t\t\t\t\terpnext.hub.marketplace.refresh();\n\t\t\t\t} else {\n\t\t\t\t\tthis.make('marketplace');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tmake(page_name) {\n\t\tconst assets = [\n\t\t\t'/assets/js/marketplace.min.js'\n\t\t];\n\n\t\tfrappe.require(assets, () => {\n\t\t\terpnext.hub.marketplace = new erpnext.hub.Marketplace({\n\t\t\t\tparent: this.make_page(true, page_name)\n\t\t\t});\n\t\t});\n\t}\n};\n\nfunction is_marketplace_disabled() {\n\treturn frappe.call({\n\t\tmethod: \"erpnext.hub_node.doctype.marketplace_settings.marketplace_settings.is_marketplace_enabled\"\n\t}).then(r => r.message)\n}\n","class CallPopup {\n\tconstructor(call_log) {\n\t\tthis.caller_number = call_log.from;\n\t\tthis.call_log = call_log;\n\t\tthis.setup_listener();\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\t'static': true,\n\t\t\t'minimizable': true,\n\t\t\t'fields': [{\n\t\t\t\t'fieldname': 'caller_info',\n\t\t\t\t'fieldtype': 'HTML'\n\t\t\t}, {\n\t\t\t\t'fielname': 'last_interaction',\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'label': __('Activity'),\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Last Communication'),\n\t\t\t\t'fieldname': 'last_communication',\n\t\t\t\t'read_only': true,\n\t\t\t\t'default': `<i class=\"text-muted\">${__('No communication found.')}<i>`\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Last Issue'),\n\t\t\t\t'fieldname': 'last_issue',\n\t\t\t\t'read_only': true,\n\t\t\t\t'default': `<i class=\"text-muted\">${__('No issue raised by the customer.')}<i>`\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Column Break',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Call Summary'),\n\t\t\t\t'fieldname': 'call_summary',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Save'),\n\t\t\t\t'click': () => {\n\t\t\t\t\tconst call_summary = this.dialog.get_value('call_summary');\n\t\t\t\t\tif (!call_summary) return;\n\t\t\t\t\tfrappe.xcall('erpnext.crm.doctype.utils.add_call_summary', {\n\t\t\t\t\t\t'docname': this.call_log.id,\n\t\t\t\t\t\t'summary': call_summary,\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.close_modal();\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: `${__('Call Summary Saved')}<br><a class=\"text-small text-muted\" href=\"#Form/Call Log/${this.call_log.name}\">${__('View call log')}</a>`,\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}],\n\t\t});\n\t\tthis.set_call_status();\n\t\tthis.make_caller_info_section();\n\t\tthis.dialog.get_close_btn().show();\n\t\tthis.dialog.$body.addClass('call-popup');\n\t\tthis.dialog.set_secondary_action(this.close_modal.bind(this));\n\t\tfrappe.utils.play_sound('incoming-call');\n\t\tthis.dialog.show();\n\t}\n\n\tmake_caller_info_section() {\n\t\tconst wrapper = this.dialog.get_field('caller_info').$wrapper;\n\t\twrapper.append(`<div class=\"text-muted\"> ${__(\"Loading...\")} </div>`);\n\t\tfrappe.xcall('erpnext.crm.doctype.utils.get_document_with_phone_number', {\n\t\t\t'number': this.caller_number\n\t\t}).then(contact_doc => {\n\t\t\twrapper.empty();\n\t\t\tconst contact = this.contact = contact_doc;\n\t\t\tif (!contact) {\n\t\t\t\tthis.setup_unknown_caller(wrapper);\n\t\t\t} else {\n\t\t\t\tthis.setup_known_caller(wrapper);\n\t\t\t\tthis.set_call_status();\n\t\t\t\tthis.make_last_interaction_section();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_unknown_caller(wrapper) {\n\t\twrapper.append(`\n\t\t\t<div class=\"caller-info\">\n\t\t\t\t<b>${__('Unknown Number')}:</b> ${this.caller_number}\n\t\t\t\t<button\n\t\t\t\t\tclass=\"margin-left btn btn-new btn-default btn-xs\"\n\t\t\t\t\tdata-doctype=\"Contact\"\n\t\t\t\t\ttitle=${__(\"Make New Contact\")}>\n\t\t\t\t\t<i class=\"octicon octicon-plus text-medium\"></i>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`).find('button').click(\n\t\t\t() => frappe.set_route(`Form/Contact/New Contact?phone=${this.caller_number}`)\n\t\t);\n\t}\n\n\tsetup_known_caller(wrapper) {\n\t\tconst contact = this.contact;\n\t\tconst contact_name = frappe.utils.get_form_link(contact.doctype, contact.name, true, this.get_caller_name());\n\t\tconst links = contact.links ? contact.links : [];\n\n\t\tlet contact_links = '';\n\n\t\tlinks.forEach(link => {\n\t\t\tcontact_links += `<div>${link.link_doctype}: ${frappe.utils.get_form_link(link.link_doctype, link.link_name, true)}</div>`;\n\t\t});\n\t\twrapper.append(`\n\t\t\t<div class=\"caller-info flex\">\n\t\t\t\t${frappe.avatar(null, 'avatar-xl', contact.name, contact.image || '')}\n\t\t\t\t<div>\n\t\t\t\t\t<h5>${contact_name}</h5>\n\t\t\t\t\t<div>${contact.mobile_no || ''}</div>\n\t\t\t\t\t<div>${contact.phone_no || ''}</div>\n\t\t\t\t\t${contact_links}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tset_indicator(color, blink=false) {\n\t\tlet classes = `indicator ${color} ${blink ? 'blink': ''}`;\n\t\tthis.dialog.header.find('.indicator').attr('class', classes);\n\t}\n\n\tset_call_status(call_status) {\n\t\tlet title = '';\n\t\tcall_status = call_status || this.call_log.status;\n\t\tif (['Ringing'].includes(call_status) || !call_status) {\n\t\t\ttitle = __('Incoming call from {0}', [this.get_caller_name()]);\n\t\t\tthis.set_indicator('blue', true);\n\t\t} else if (call_status === 'In Progress') {\n\t\t\ttitle = __('Call Connected');\n\t\t\tthis.set_indicator('yellow');\n\t\t} else if (call_status === 'Missed') {\n\t\t\tthis.set_indicator('red');\n\t\t\ttitle = __('Call Missed');\n\t\t} else if (['Completed', 'Disconnected'].includes(call_status)) {\n\t\t\tthis.set_indicator('red');\n\t\t\ttitle = __('Call Disconnected');\n\t\t} else {\n\t\t\tthis.set_indicator('blue');\n\t\t\ttitle = call_status;\n\t\t}\n\t\tthis.dialog.set_title(title);\n\t}\n\n\tupdate_call_log(call_log) {\n\t\tthis.call_log = call_log;\n\t\tthis.set_call_status();\n\t}\n\n\tclose_modal() {\n\t\tthis.dialog.hide();\n\t\tdelete erpnext.call_popup;\n\t}\n\n\tcall_disconnected(call_log) {\n\t\tfrappe.utils.play_sound('call-disconnect');\n\t\tthis.update_call_log(call_log);\n\t\tsetTimeout(() => {\n\t\t\tif (!this.dialog.get_value('call_summary')) {\n\t\t\t\tthis.close_modal();\n\t\t\t}\n\t\t}, 10000);\n\t}\n\n\tmake_last_interaction_section() {\n\t\tfrappe.xcall('erpnext.crm.doctype.utils.get_last_interaction', {\n\t\t\t'number': this.caller_number,\n\t\t\t'reference_doc': this.contact\n\t\t}).then(data => {\n\t\t\tconst comm_field = this.dialog.get_field('last_communication');\n\t\t\tif (data.last_communication) {\n\t\t\t\tconst comm = data.last_communication;\n\t\t\t\tcomm_field.set_value(comm.content);\n\t\t\t}\n\n\t\t\tif (data.last_issue) {\n\t\t\t\tconst issue = data.last_issue;\n\t\t\t\tconst issue_field = this.dialog.get_field(\"last_issue\");\n\t\t\t\tissue_field.set_value(issue.subject);\n\t\t\t\tissue_field.$wrapper.append(`<a class=\"text-medium\" href=\"#List/Issue?customer=${issue.customer}\">\n\t\t\t\t\t${__('View all issues from {0}', [issue.customer])}\n\t\t\t\t</a>`);\n\t\t\t}\n\t\t});\n\t}\n\tget_caller_name() {\n\t\treturn this.contact ? this.contact.lead_name || this.contact.name || '' : this.caller_number;\n\t}\n\tsetup_listener() {\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_disconnected`, call_log => {\n\t\t\tthis.call_disconnected(call_log);\n\t\t\t// Remove call disconnect listener after the call is disconnected\n\t\t\tfrappe.realtime.off(`call_${this.call_log.id}_disconnected`);\n\t\t});\n\t}\n}\n\n$(document).on('app_ready', function () {\n\tfrappe.realtime.on('show_call_popup', call_log => {\n\t\tif (!erpnext.call_popup) {\n\t\t\terpnext.call_popup = new CallPopup(call_log);\n\t\t} else {\n\t\t\terpnext.call_popup.update_call_log(call_log);\n\t\t\terpnext.call_popup.dialog.show();\n\t\t}\n\t});\n});\n","frappe.provide('frappe.ui.form');\n\nerpnext.doctypes_with_dimensions = [\"GL Entry\", \"Sales Invoice\", \"Purchase Invoice\", \"Payment Entry\", \"Asset\",\n\t\"Expense Claim\", \"Stock Entry\", \"Budget\", \"Payroll Entry\", \"Delivery Note\", \"Sales Invoice Item\", \"Purchase Invoice Item\",\n\t\"Purchase Order Item\", \"Journal Entry Account\", \"Material Request Item\", \"Delivery Note Item\", \"Purchase Receipt Item\",\n\t\"Stock Entry Detail\", \"Payment Entry Deduction\", \"Sales Taxes and Charges\", \"Purchase Taxes and Charges\", \"Shipping Rule\",\n\t\"Landed Cost Item\", \"Asset Value Adjustment\", \"Loyalty Program\", \"Fee Schedule\", \"Fee Structure\", \"Stock Reconciliation\",\n\t\"Travel Request\", \"Fees\", \"POS Profile\", \"Opening Invoice Creation Tool\", \"Opening Invoice Creation Tool Item\", \"Subscription\",\n\t\"Subscription Plan\"];\n\nfrappe.call({\n\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimension_filters\",\n\tcallback: function(r){\n\t\terpnext.dimension_filters = r.message[0];\n\t\terpnext.default_dimensions = r.message[1];\n\t}\n});\n\nerpnext.doctypes_with_dimensions.forEach((doctype) => {\n\tfrappe.ui.form.on(doctype, {\n\t\tonload: function(frm) {\n\t\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\t\tfrappe.model.with_doctype(dimension['document_type'], () => {\n\t\t\t\t\tif (frappe.meta.has_field(dimension['document_type'], 'is_group')) {\n\t\t\t\t\t\tfrm.set_query(dimension['fieldname'], {\n\t\t\t\t\t\t\t\"is_group\": 0\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (frm.is_new() && frappe.meta.has_field(doctype, 'company') && frm.doc.company) {\n\t\t\t\t\t\tfrm.set_value(dimension['fieldname'], erpnext.default_dimensions[frm.doc.company][dimension['document_type']]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tcompany: function(frm) {\n\t\t\tif(frm.doc.company) {\n\t\t\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\t\t\tfrm.set_value(dimension['fieldname'], erpnext.default_dimensions[frm.doc.company][dimension['document_type']]);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\titems_add: function(frm, cdt, cdn) {\n\t\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\t\tvar row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(\"items\", row, [dimension['fieldname']]);\n\t\t\t});\n\t\t},\n\n\t\taccounts_add: function(frm, cdt, cdn) {\n\t\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\t\tvar row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(\"accounts\", row, [dimension['fieldname']]);\n\t\t\t});\n\t\t}\n\t});\n});"],"names":["frappe","provide","$","document","bind","app","name","help_feedback_link","attr","$help_menu","__","insertBefore","extend","create_routes","Customer Group","Territory","Item Group","Sales Person","Account","Cost Center","Department","breadcrumbs","preferred","Supplier Group","Sales Partner","Brand","module_map","ERPNext Integrations","Geo","Accounts","Portal","Utilities","Shopping Cart","Contacts","erpnext","get_currency","company","cur_frm","doc","get_doc","default_currency","boot","sysdefaults","currency","get_presentation_currency_list","const","currency_list","docs","filter","d","doctype","map","unshift","toggle_naming_series","fields_dict","naming_series","toggle_display","__islocal","hide_company","companies","Object","keys","locals","length","set_value","last_selected_company","is_perpetual_inventory_enabled","enable_perpetual_inventory","stale_rate_allowed","cint","allow_stale","setup_serial_no","grid_row","open_grid_row","grid_form","serial_no","get_status","$btn","appendTo","css","margin-bottom","margin-top","$wrapper","me","this","on","show_serial_batch_selector","frm","utils","set_party_dashboard_indicators","__onload","dashboard_info","company_wise_info","forEach","info","add_indicator_for_multicompany","dashboard","add_indicator","format_currency","billing_this_year","total_unpaid","loyalty_points","stats_area","removeClass","stats_area_row","addClass","color","indicator","get_party_name","party_type","Customer","Supplier","Employee","Member","copy_value_in_all_rows","dt","dn","table_fieldname","fieldname","cl","i","refresh_field","get_terms","tc_name","callback","call","method","args","template_name","r","make_bank_account","docname","freeze","doclist","model","sync","message","set_route","make_subscription","make_pricing_rule","first_row_is_empty","child_table","isArray","item_code","remove_empty_first_row","child_table_name","rows","splice","get_tree_options","option","let","unscrub_option","unscrub","user_permission","defaults","get_user_permissions","perm","c","sort","value","index","self","indexOf","get_tree_default","options","includes","get_default","copy_parent_value_in_all_row","parent_fieldname","create_new_doc","update_fields","with_doctype","new_doc","get_new_doc","entries","ref","key","ui","form","make_quick_entry","select_alternate_items","opts","warehouse_field","item_field","data","dialog","Dialog","title","fields","fieldtype","label","cannot_add_rows","in_place_edit","get_data","hidden","in_list_view","read_only","default","onchange","get_value","warehouse","on_grid_fields_dict","actual_qty","get_query","e","query","filters","primary_action","get_values","alternate_item","row","child_doctype","qty","required_qty","script_manager","trigger","then","original_item_field","child_docname","hide","primary_action_label","condition","alternative_items","df","push","grid","refresh","show","update_child_items","cannot_add_row","trans_items","parent_doctype","parent_doctype_name","reload_doc","rate","map_current_doc","get_query_filters","_map","items","items_doctype","meta","get_docfield","link_fieldname","get_meta","source_doctype","already_set","item_qty_map","each","source_name","src","flt","with_doc","source_doc","msgprint","type","source_names","target_doc","exc","dirty","MultiSelectDialog","target","date_field","undefined","setters","action","selections","values","link_formatters","item_name","employee_name","datetime","is_timezone_same","set_df_property","sys_defaults","time_zone","queries","user","lead","customer","supplier","item","bom","task","customer_filter","throw","get_label","contact_query","dynamic_link","link_doctype","link_name","address_query","console","log","company_address_query","is_your_company_address","supplier_filter","lead_filter","not_a_group_filter","is_group","employee","cstr","setup_queries","query_fn","set_query","parentfield","link_fields","get_docfields","setup_warehouse_query","cdt","cdn","SMSManager","setup","default_msg","Lead","Opportunity","Quotation","Sales Order","quotation_no","po_no","Delivery Note","Sales Invoice","Material Request","Purchase Order","Purchase Receipt","in_list","contact_person","party_name","mobile_no","contact_no","get_contact_number","contact","ref_doctype","ref_name","contact_name","number","show_dialog","mobile_nos","make_dialog","set_values","width","reqd","send","input","onclick","btn","v","set_working","receiver_list","msg","done_working","get_party_details","quotation_to","party","price_list","selling_price_list","bill_date","buying_price_list","posting_date","transaction_date","validate_mandatory","supplier_tds","updating_party_details","run_serially","add_item","is_new","prev_route","get_prev_route","add_child","get_address_display","address_field","display_field","address_dict","set_taxes_from_address","triggered_from_field","billing_address_field","shipping_address_field","tax_category","billing_address","shipping_address","set_taxes","customer_group","supplier_group","shipping_address_name","get_contact_details","trigger_on","get_shipping_address","address","stock","StockController","Controller","onload","setup_posting_date_time_check","docstatus","set_posting_time","nowdate","posting_time","now_time","show_stock_ledger","add_custom_button","route_options","voucher_no","from_date","to_date","show_general_ledger","group_by","payments","make_payment","$body","body","set_payment_primary_action","make_keyboard","select_text","find","click","select","set_primary_action","amount","submit_invoice","empty","html","render_template","show_payment_details","bind_keyboard_event","clear_amount","make_multimode_payment","change_amount","payment_val","outstanding_amount","mode_of_payment","multimode_payments","idx","paid_amount","selected_mode","repl","highlight_selected_row","bind_amount_change_event","set_outstanding_amount","val","conversion_rate","precision","update_payment_amount","bind_form_control_event","bind_numeric_keys_event","update_paid_amount","change","write_off_amount","selected_row","text","slice","stopPropagation","base_write_off_amount","calculate_outstanding_amount","show_amounts","calculate_write_off_amount","update_write_off","update_invoice","taxes_and_totals","apply_pricing_rule_on_item","effective_item_rate","price_list_rate","parenttype","blanket_order_rate","margin_type","rate_with_margin","margin_rate_or_amount","base_rate_with_margin","discount_percentage","discount_amount","calculate_taxes_and_totals","discount_amount_applied","_calculate_taxes_and_totals","calculate_discount_amount","is_return","calculate_total_advance","calculate_commission","calculate_contribution","refresh_fields","set_discount_amount","apply_discount_amount","validate_conversion_rate","calculate_item_values","initialize_taxes","determine_exclusive_rate","calculate_net_total","calculate_taxes","manipulate_grand_total_for_inclusive_tax","calculate_totals","_cleanup","conversion_rate_label","company_currency","get_company_currency","err_message","round_floats_in","net_rate","net_amount","item_tax_amount","total_weight","weight_per_unit","stock_qty","set_in_company_currency","f","tax","item_wise_tax_detail","tax_fields","charge_type","apply_discount_on","cscript","validate_taxes_and_charges","validate_inclusive_tax","has_inclusive_tax","included_in_print_rate","n","item_tax_map","_load_item_tax_rate","item_tax_rate","cumulated_tax_fraction","tax_fraction_for_current_item","get_current_tax_fraction","grand_total_fraction_for_current_item","current_tax_fraction","tax_rate","_get_tax_rate","row_id","add_deduct_tax","account_head","total_qty","total","base_total","net_total","base_net_total","base_amount","base_net_amount","rounding_adjustment","actual_tax_dict","tax_amount","current_tax_amount","get_current_tax_amount","tax_amount_for_current_item","tax_amount_after_discount_amount","category","grand_total_for_current_item","round_off_totals","set_cumulative_total","grand_total","row_idx","JSON","parse","actual","set_item_wise_tax","tax_detail","item_wise_tax_amount","any_inclusive_tax","taxes","last_tax","non_inclusive_tax_amount","sum","diff","Math","abs","pow","tax_count","base_grand_total","taxes_and_charges_added","taxes_and_charges_deducted","total_taxes_and_charges","set_rounded_total","disable_rounded_total","rounded_total","base_rounded_total","round_based_on_smallest_currency_fraction","base_in_words","in_words","temporary_fields","stringify","additional_discount_percentage","scrub","distributed_amount","base_discount_amount","total_for_discount_amount","get_total_for_discount_amount","discount_amount_loss","total_actual_tax","actual_taxes_dict","actual_tax_amount","total_allocated_amount","adv","allocated_amount","total_advance","calculate_paid_amount","party_account_currency","total_amount_to_pay","total_amount_for_payment","redeem_loyalty_points","loyalty_amount","set_default_payment","calculate_change_amount","base_paid_amount","payment_status","is_pos","base_change_amount","payment_types","TransactionController","_super","flags","hide_serial_batch_dialog","has_margin_field","has_field","set_gross_profit","tax_table","set_dynamic_labels","via_discount_percentage","items_add","set_warehouse","get_field","set_query_for_batch","payment_terms_template","payment_schedule","calculate_net_weight","set_indicator_formatter","get_user_default","amended_from","return_against","setup_quality_inspection","inspection_type","get_route_options_for_new_doc","reference_type","reference_name","description","item_serial_no","split","batch_no","make_payment_request","payment_request_type","recipient_id","contact_email","onload_post_render","load_after_mapping","after_ajax","apply_default_taxes","setup_item_selector","set_multiple_add","setup_sms","set_new_description","scan_barcode","scan_barcode_field","search_value","exist","cur_grid","row_to_modify","existing_item_row","blank_item_row","from_barcode","field","taxes_and_charges_field","taxes_and_charges","master_doctype","tax_template","status","page","add_menu_item","send_sms","barcode","update_stock","show_batch_dialog","validate_company_and_party","child","price_list_currency","plc_conversion_rate","order_type","is_subcontracted","ignore_pricing_rule","project","conversion_factor","weight_uom","uom","manufacturer","stock_uom","pos_profile","cost_center","item_tax_template","add_taxes_from_item_tax_template","toggle_conversion_factor","k","validate_pricing_rule","grid_rows","remove","valid_serial_nos","serial_nos","trim","replace","x","join","user_defaults","set_qty_in_transactions_based_on_serial_no_input","validate","set_pricing","company_doc","default_letter_head","letter_head","default_selling_terms","default_buying_terms","update_item_tax_map","apply_pricing_rule","set_party_account","party_account_field","rt","due_date","recalculate_terms","message1","message2","final_message","term","payment_term","get_exchange_rate","exchange_rate","set_margin_amount_based_on_currency","set_actual_charges_based_on_currency","in_apply_price_list","apply_price_list","shipping_rule","fail","from_currency","to_currency","dont_fetch_price_list_rate","fields_map","toggle_enable","service_stop_date","start_date","Date","service_start_date","end_date","service_end_date","stop_date","total_net_weight","toggle_reqd","price_list_name","change_form_labels","change_grid_labels","set_currency_labels","item_grid","fname","set_column_disp","wrapper","recalculate","recalculate_values","calculate_charges","item_list","is_free_item","pricing_rules","parent","row_item","_set_values_for_item_list","_get_args","_get_item_list","territory","campaign","sales_partner","append_item","item_group","brand","children","price_list_rate_changed","l","existing_pricing_rule","reset_plc_conversion","always","trigger_price_list_rate","remove_free_item","applied_on_items","apply_on","child_row","valid","master_name","as_json","item_codes","hasOwnProperty","is_recurring","recurring_id","owner_email","owner","user_info","email","notification_email_address","repeat_on_day_of_month","str_to_obj","getDate","refresh_many","months","Monthly","Quarterly","Half-yearly","Yearly","recurring_type","add_months","add_days","valuation_rate","gross_profit","get_advances","make_payment_entry","get_method_for_payment","make_payment_via_journal_entry","terms_template","blanket_order","on_close","require","SerialNoBatchSelector","warehouse_details","ItemSelector","Class","init","item_query","add_items_button","render_items","setTimeout","focus","results","timeout_id","clearTimeout","added","show_alert","add_new_row","timeout","txt","as_dict","get_filters","link_search","image","abbr","get_abbr","get_palette","docsUrl","help","help_links","url","agriculture","TernaryPlot","[object Object]","assign","make_svg","init_snap","init_config","make_plot","make_plot_marking","make_legend","mark_blip","$svg","append","paper","Snap","get","config","triangle_side","spacing","strokeWidth","stroke","scaling_factor","coords","sand","points","s","t","cos","loamy_sand","p","sandy_loam","loam","silt_loam","silt","silty_clay_loam","silty_clay","clay_loam","sandy_clay_loam","sandy_clay","clay","soil_type","polygon","get_coords","fill","get_color","transform","offset","exec_once","rect","font-size","x_blip","y_blip","sin","blip","circle","ItemQuickEntryForm","QuickEntryForm","after_insert","render_dialog","mandatory","get_variant_fields","concat","get_attributes_fields","init_post_render_dialog_operations","preset_fields_for_template","attribute_html","init_for_create_variant_trigger","init_for_item_template_trigger","toggle_manufacturer_fields","register_primary_action","working","variant_values","create_variant","$input","prop","get_variant_doc","template_doc","update_doc","insert","Promise","resolve","clear_doc","_from_link","update_calling_link","open_form_if_not_list","error","open_doc","template","item_template","has_variants","get_manufacturing_fields","manufacturer_fields","attribute_fields","init_post_template_trigger_operations","for_variant","template_field","toggle","is_manufacturer","variant_based_on","attributes","render_attributes","attributes_flag","attribute_values","attributes_count","toggleClass","dialog_field","initiate_render_attributes","desc","numeric_values","from_range","to_range","increment","init_make_control","attribute","label_area","insertAfter","input_area","closest","init_awesomplete_for_attribute","make_control","only_input","make_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","attribute_value","variant_doc","validate_mandatory_attributes","async","prototype","toString","msgprint_dialog","CustomerQuickEntryForm","collapsible","views","MarketplaceFactory","Factory","disabled","show_not_found","pages","marketplace","container","change_to","hub","make","page_name","Marketplace","make_page","CallPopup","call_log","caller_number","from","setup_listener","static","minimizable","fielname","call_summary","xcall","id","summary","close_modal","set_call_status","make_caller_info_section","get_close_btn","set_secondary_action","play_sound","contact_doc","setup_known_caller","make_last_interaction_section","setup_unknown_caller","get_form_link","get_caller_name","links","contact_links","link","avatar","phone_no","blink","classes","header","call_status","set_indicator","set_title","call_popup","update_call_log","reference_doc","comm_field","last_communication","comm","content","last_issue","issue","issue_field","subject","lead_name","realtime","call_disconnected","off","doctypes_with_dimensions","dimension_filters","default_dimensions","dimension","copy_from_first_row","accounts_add"],"mappings":"yBAGAA,OAAOC,QAAQ,WAGfC,EAAEC,UAAUC,KAAK,gBAAiB,WACjCJ,OAAOK,IAAIC,KAAO,UAElBN,OAAOO,mBAAqB,mFAI5BL,EAAE,sBAAsBM,KAAK,OAAQ,4BACrCN,EAAE,wBAAwBM,KAAK,OAAQ,4CAOvC,IAAIC,EAAaP,EAAE,0CACnBA,EAAE,iGACiBQ,GAAG,iBAAiB,aAAaC,aAAaF,GACjEP,EAAE,wFACiBQ,GAAG,cAAc,aAAaC,aAAaF,GAC9DP,EAAE,8EACiBQ,GAAG,mBAAmB,aAAaC,aAAaF,KAOpEP,EAAEU,OAAOZ,OAAOa,cAAe,CAC9BC,iBAAkB,sBAClBC,UAAa,iBACbC,aAAc,kBACdC,eAAgB,oBAChBC,QAAW,eACXC,cAAe,mBACfC,WAAc,oBAIflB,EAAEU,OAAOZ,OAAOqB,YAAYC,UAAW,CACtCN,aAAc,QACdF,iBAAkB,UAClBS,iBAAkB,SAClBR,UAAa,UACbE,eAAgB,UAChBO,gBAAiB,UACjBC,MAAS,YAGVvB,EAAEU,OAAOZ,OAAOqB,YAAYK,WAAY,CACvCC,uBAAwB,eACxBC,IAAO,WACPC,SAAY,aACZC,OAAU,UACVC,UAAa,WACbC,gBAAiB,UACjBC,SAAY,QC5DbjC,OAAOC,QAAQ,WACfD,OAAOC,QAAQ,iBAEfC,EAAEU,OAAOsB,QAAS,CACjBC,aAAc,SAASC,GAGtB,OAFIA,GAAWC,UACdD,EAAUC,QAAQC,IAAIF,SACpBA,GACKpC,OAAOuC,QAAQ,WAAYH,GAASI,kBAEpCxC,OAAOyC,KAAKC,YAAYC,UAGjCC,0CACCC,IACIC,EADS9C,OAAOyC,KAAKM,KACAC,gBAAOC,SAAmB,cAAdA,EAAEC,UAAyBC,aAAIF,UAAKA,EAAE3C,OAE3E,OADAwC,EAAcM,QAAQ,IACfN,GAGRO,qBAAsB,WAClBhB,QAAQiB,YAAYC,eACtBlB,QAAQmB,eAAe,kBAAiBnB,QAAQC,IAAImB,YAItDC,aAAc,WACb,GAAGrB,QAAQiB,YAAYlB,QAAS,CAC/B,IAAIuB,EAAYC,OAAOC,KAAKC,OAAO,aAAe,IAC1B,IAArBH,EAAUI,QACR1B,QAAQC,IAAIF,SAASC,QAAQ2B,UAAU,UAAWL,EAAU,IAChEtB,QAAQmB,eAAe,WAAW,IACzBtB,QAAQ+B,wBACb5B,QAAQC,IAAIF,SAASC,QAAQ2B,UAAU,UAAW9B,QAAQ+B,0BAKjEC,+BAAgC,SAAS9B,GACxC,GAAGA,EACF,OAAOpC,OAAOuC,QAAQ,WAAYH,GAAS+B,4BAI7CC,8BACC,OAAOC,KAAKrE,OAAOyC,KAAKC,YAAY4B,cAGrCC,gBAAiB,WAChB,IAAIC,EAAWnC,QAAQoC,gBACvB,GAAID,GAAaA,EAASE,UAAUpB,YAAYqB,WACS,UAAxDH,EAASE,UAAUpB,YAAYqB,UAAUC,aAD1C,CAGA,IAAIC,EAAO3E,EAAE,0CAA0CQ,GAAG,iBAAiB,aACzEoE,SAAS5E,EAAE,SACV6E,IAAI,CAACC,gBAAiB,OAAQC,aAAc,SAC5CH,SAASN,EAASE,UAAUpB,YAAYqB,UAAUO,WAEjDC,EAAKC,KACTP,EAAKQ,GAAG,QAAS,WAChBF,EAAGG,2BAA2Bd,EAASe,IAAKf,EAASlC,WAMxDpC,EAAEU,OAAOsB,QAAQsD,MAAO,CACvBC,+BAAgC,SAASF,GACxC,GAAGA,EAAIjD,IAAIoD,UAAYH,EAAIjD,IAAIoD,SAASC,eAAgB,CACvD,IAAIC,EAAoBL,EAAIjD,IAAIoD,SAASC,eACtCC,EAAkB7B,OAAS,EAC7B6B,EAAkBC,QAAQ,SAASC,GAClC5D,QAAQsD,MAAMO,+BAA+BR,EAAKO,KAEZ,IAA7BF,EAAkB7B,SAC5BwB,EAAIS,UAAUC,cAAcvF,GAAG,sBAC9B,CAACwF,gBAAgBN,EAAkB,GAAGO,kBAAmBP,EAAkB,GAAGjD,YAAa,QAC5F4C,EAAIS,UAAUC,cAAcvF,GAAG,oBAC9B,CAACwF,gBAAgBN,EAAkB,GAAGQ,aAAcR,EAAkB,GAAGjD,YAC1EiD,EAAkB,GAAGQ,aAAe,SAAW,SAE5CR,EAAkB,GAAGS,gBACvBd,EAAIS,UAAUC,cAAcvF,GAAG,sBAC9B,CAACkF,EAAkB,GAAGS,iBAAkB,WAM7CN,+BAAgC,SAASR,EAAKO,GAC7CP,EAAIS,UAAUM,WAAWC,YAAY,UACrChB,EAAIS,UAAUQ,eAAeC,SAAS,QACtClB,EAAIS,UAAUQ,eAAezB,IAAI,YAAa,QAE9C,IAAI2B,EAAQZ,EAAKM,aAAe,SAAW,QAEvCO,EAAYzG,EAAE,sEACmB4F,EAAK1D,QAAQ,oHAG9B8D,gBAAgBJ,EAAKK,kBAAmBL,EAAKnD,UAAU,gGAGhD+D,EAAM,mBAC/BR,gBAAgBJ,EAAKM,aAAcN,EAAKnD,UAAU,uBAGzCmC,SAASS,EAAIS,UAAUQ,gBAOlC,OALGV,EAAKO,gBACPnG,EAAE,yGACiB4F,EAAKO,eAAe,iBAAiBvB,SAAS6B,GAG3DA,GAGRC,eAAgB,SAASC,GAGxB,MAFW,CAACC,SAAY,gBAAiBC,SAAY,gBAAiBC,SAAY,gBACjFC,OAAU,eACCJ,IAGbK,uBAAwB,SAAS5E,EAAK6E,EAAIC,EAAIC,EAAiBC,GAC9D,IAAIrE,EAAIa,OAAOqD,GAAIC,GACnB,GAAGnE,EAAEqE,GAEJ,IADA,IAAIC,EAAKjF,EAAI+E,IAAoB,GACzBG,EAAI,EAAGA,EAAID,EAAGxD,OAAQyD,IACzBD,EAAGC,GAAGF,KAAYC,EAAGC,GAAGF,GAAarE,EAAEqE,IAG7CG,cAAcJ,IAGfK,UAAW,SAASC,EAASrF,EAAKsF,GACjC,GAAGD,EACF,OAAO3H,OAAO6H,KAAK,CAClBC,OAAQ,2FACRC,KAAM,CACLC,cAAeL,EACfrF,IAAKA,GAENsF,SAAU,SAASK,GAClBL,EAASK,OAMbC,kBAAmB,SAAShF,EAASiF,GACpCnI,OAAO6H,KAAK,CACXC,OAAQ,uEACRC,KAAM,CACL7E,QAASA,EACTiF,QAASA,GAEVC,QAAQ,EACRR,SAAU,SAASK,GAClB,IAAII,EAAUrI,OAAOsI,MAAMC,KAAKN,EAAEO,SAClCxI,OAAOyI,UAAU,OAAQJ,EAAQ,GAAGnF,QAASmF,EAAQ,GAAG/H,UAK3DoI,kBAAmB,SAASxF,EAASiF,GACpCnI,OAAO6H,KAAK,CACXC,OAAQ,qEACRC,KAAM,CACL7E,QAASA,EACTiF,QAASA,GAEVP,SAAU,SAASK,GAClB,IAAII,EAAUrI,OAAOsI,MAAMC,KAAKN,EAAEO,SAClCxI,OAAOyI,UAAU,OAAQJ,EAAQ,GAAGnF,QAASmF,EAAQ,GAAG/H,UAK3DqI,kBAAmB,SAASzF,EAASiF,GACpCnI,OAAO6H,KAAK,CACXC,OAAQ,uEACRC,KAAM,CACL7E,QAASA,EACTiF,QAASA,GAEVP,SAAU,SAASK,GAClB,IAAII,EAAUrI,OAAOsI,MAAMC,KAAKN,EAAEO,SAClCxI,OAAOyI,UAAU,OAAQJ,EAAQ,GAAGnF,QAASmF,EAAQ,GAAG/H,UAU3DsI,mBAAoB,SAASC,GAC5B,SAAG3I,EAAE4I,QAAQD,IAAgBA,EAAY9E,OAAS,KACzC8E,EAAY,GAAGE,WAWzBC,uBAAwB,SAASzD,EAAK0D,GACrCpG,IAAMqG,EAAO3D,EAAS,IAAE0D,GAIxB,OAHI7D,KAAKwD,mBAAmBM,KAC3B3D,EAAS,IAAE0D,GAAoBC,EAAKC,OAAO,IAErCD,GAERE,iBAAkB,SAASC,GAE1BC,IAAIC,EAAiBvJ,OAAOsI,MAAMkB,QAAQH,GACtCI,EAAkBzJ,OAAO0J,SAASC,uBAUtC,OAPGF,GAAmBA,EAAgBF,GAC3BE,EAAgBF,GAAgBpG,aAAIyG,UAAQA,EAAKtH,MAEjDpC,EAAEiD,IAAIW,WAAWyF,GAAmB,SAASM,GAAK,OAAOA,EAAEvJ,OAASwJ,QAIhE9G,gBAAQ+G,EAAOC,EAAOC,UAASA,EAAKC,QAAQH,KAAWC,KAEvEG,iBAAkB,SAASd,GAE1BC,IAAIc,EAAUhF,KAAKgE,iBAAiBC,GACpC,OAAGe,EAAQC,SAASrK,OAAO0J,SAASY,YAAYjB,IACxCrJ,OAAO0J,SAASY,YAAYjB,GAE5Be,EAAQ,IAGjBG,6BAA8B,SAASjI,EAAK6E,EAAIC,EAAIC,EAAiBC,EAAWkD,GAE/E,GADQ1G,OAAOqD,GAAIC,GACdE,GAEJ,IADA,IAAIC,EAAKjF,EAAI+E,IAAoB,GACzBG,EAAI,EAAGA,EAAID,EAAGxD,OAAQyD,IAC7BD,EAAGC,GAAGF,GAAahF,EAAIkI,GAGzB/C,cAAcJ,IAGfoD,eAAgB,SAAUvH,EAASwH,GAClC1K,OAAOsI,MAAMqC,aAAazH,EAAS,WAElC,IADA,IAAI0H,EAAU5K,OAAOsI,MAAMuC,YAAY3H,SACdU,OAAOkH,QAAQJ,mBAAgB,CAAnDpB,IAAIyB,qBACRH,EAAQI,GAAOjB,EAEhB/J,OAAOiL,GAAGC,KAAKC,iBAAiBjI,EAAS,KAAM,KAAM0H,QAMxD1I,QAAQsD,MAAM4F,uBAAyB,SAASC,cACzC9F,EAAM8F,EAAK9F,IACX+F,EAAkBD,EAAKC,iBAAmB,YAC1CC,EAAaF,EAAKE,YAAc,YAEtCnG,KAAKoG,KAAO,GACZ3I,IAAM4I,EAAS,IAAIzL,OAAOiL,GAAGS,OAAO,CACnCC,MAAOjL,GAAG,yBACVkL,OAAQ,CACP,CAACC,UAAU,gBAAiBC,MAAOpL,GAAG,UACtC,CACC4G,UAAW,oBAAqBuE,UAAW,QAASE,iBAAiB,EACrEC,eAAe,EAAMR,KAAMpG,KAAKoG,KAChCS,oBACC,OAAO7G,EAAKoG,MAEbI,OAAQ,CAAC,CACRC,UAAU,OACVvE,UAAU,UACV4E,OAAQ,GACN,CACFL,UAAU,OACVvE,UAAU,YACV8C,QAAS,OACT+B,aAAc,EACdC,UAAW,EACXN,MAAOpL,GAAG,cACR,CACFmL,UAAU,OACVvE,UAAU,iBACV8C,QAAS,OACTiC,QAAS,GACTF,aAAc,EACdL,MAAOpL,GAAG,kBACV4L,SAAU,sBACHvD,EAAY3D,KAAKmH,YACjBC,EAAYpH,KAAKZ,SAASiI,oBAAoBD,UAAUD,YAC1DxD,GAAayD,GAChBxM,OAAO6H,KAAK,CACXC,OAAQ,2CACRC,KAAM,CACLgB,UAAWA,EACXyD,UAAWA,GAEZ5E,kBAAWK,GACV7C,EAAKZ,SAASiI,oBACZC,WAAW1I,UAAUiE,EAAEO,SAAW,OAKxCmE,mBAAYC,GACX,MAAO,CACNC,MAAO,gFACPC,QAAS,CACR/D,UAAW6D,EAAE7D,cAId,CACF8C,UAAU,OACVvE,UAAU,YACV8C,QAAS,YACTiC,QAAS,GACTF,aAAc,EACdL,MAAOpL,GAAG,aACV4L,SAAU,sBACHE,EAAYpH,KAAKmH,YACjBxD,EAAY3D,KAAKZ,SAASiI,oBAAoB1D,UAAUwD,YAC1DxD,GAAayD,GAChBxM,OAAO6H,KAAK,CACXC,OAAQ,2CACRC,KAAM,CACLgB,UAAWA,EACXyD,UAAWA,GAEZ5E,kBAAWK,GACV7C,EAAKZ,SAASiI,oBACZC,WAAW1I,UAAUiE,EAAEO,SAAW,QAKtC,CACFqD,UAAU,QACVvE,UAAU,aACV+E,QAAS,EACTD,UAAW,EACXD,aAAc,EACdL,MAAOpL,GAAG,qBAIbqM,eAAgB,WACF3H,KAAK4H,aAAgC,kBACnBhK,gBAAOC,GACrC,GAAIA,EAAEgK,gBAAkBhK,EAAE8F,WAAa9F,EAAEgK,eACxC,OAAO,IAISpH,iBAAQ5C,GACzBqG,IAAI4D,EAAMlN,OAAOuC,QAAQ8I,EAAK8B,cAAelK,EAAEkF,SAC3CiF,EAAM,KAETA,EADmB,oBAAhBF,EAAIhK,QACDgK,EAAIG,aAEJH,EAAIE,IAEXF,EAAI3B,GAActI,EAAEgK,eACpB1H,EAAI+H,eAAeC,QAAQhC,EAAY2B,EAAIhK,QAASgK,EAAI5M,MACtDkN,gBACAxN,OAAOsI,MAAMtE,UAAUkJ,EAAIhK,QAASgK,EAAI5M,KAAM,MAAO8M,GACrDpN,OAAOsI,MAAMtE,UAAUkJ,EAAIhK,QAASgK,EAAI5M,KACvC+K,EAAKoC,oBAAqBxK,EAAE8F,eAIhCtB,cAAc4D,EAAKqC,eACnBtI,KAAKuI,QAENC,qBAAsBlN,GAAG,YAG1B6E,EAAIjD,IAAI+I,EAAKqC,eAAe7H,iBAAQ5C,GAC9BoI,EAAKwC,YAAaxC,EAAKwC,UAAU5K,IACrCwI,EAAOnI,YAAYwK,kBAAkBC,GAAGvC,KAAKwC,KAAK,CACjD7F,QAAWlF,EAAE3C,KACbyI,UAAa9F,EAAEsI,GACfiB,UAAavJ,EAAEqI,GACfoB,WAAczJ,EAAEyJ,eAKnBtH,KAAKoG,KAAOC,EAAOnI,YAAYwK,kBAAkBC,GAAGvC,KACpDC,EAAOnI,YAAYwK,kBAAkBG,KAAKC,UAC1CzC,EAAO0C,QAGRjM,QAAQsD,MAAM4I,mBAAqB,SAAS/C,cACrC9F,EAAM8F,EAAK9F,IACX8I,OAAiD,IAAxBhD,EAAKgD,gBAAyChD,EAAKgD,eAC5EX,OAAgD,IAAxBrC,EAAKgD,eAAkC,QAAUhD,EAAKqC,cACpFtI,KAAKoG,KAAO,GACZ3I,IAAM4I,EAAS,IAAIzL,OAAOiL,GAAGS,OAAO,CACnCC,MAAOjL,GAAG,gBACVkL,OAAQ,CACP,CAACC,UAAU,gBAAiBC,MAAOpL,GAAG,UACtC,CACC4G,UAAW,cACXuE,UAAW,QACXE,gBAAiBsC,EACjBrC,eAAe,EACfR,KAAMpG,KAAKoG,KACXS,oBACC,OAAO7G,EAAKoG,MAEbI,OAAQ,CAAC,CACRC,UAAU,OACVvE,UAAU,UACV4E,OAAQ,GACN,CACFL,UAAU,OACVvE,UAAU,YACV8C,QAAS,OACT+B,aAAc,EACdC,UAAW,EACXN,MAAOpL,GAAG,cACR,CACFmL,UAAU,QACVvE,UAAU,MACV+E,QAAS,EACTD,UAAW,EACXD,aAAc,EACdL,MAAOpL,GAAG,QACR,CACFmL,UAAU,WACVvE,UAAU,OACV+E,QAAS,EACTD,UAAW,EACXD,aAAc,EACdL,MAAOpL,GAAG,YAIbqM,eAAgB,WACflK,IAAMyL,EAAclJ,KAAK4H,aAA0B,YACnDhN,OAAO6H,KAAK,CACXC,OAAQ,gEACRM,QAAQ,EACRL,KAAM,CACLwG,eAAkBhJ,EAAIjD,IAAIY,QAC1BoL,YAAeA,EACfE,oBAAuBjJ,EAAIjD,IAAIhC,KAC/BoN,cAAiBA,GAElB9F,SAAU,WACTrC,EAAIkJ,gBAGNrJ,KAAKuI,OACLlG,cAAc,UAEfmG,qBAAsBlN,GAAG,YAG1B6E,EAAIjD,IAAI+I,EAAKqC,eAAe7H,iBAAQ5C,GACnCwI,EAAOnI,YAAYgL,YAAYP,GAAGvC,KAAKwC,KAAK,CAC3C7F,QAAWlF,EAAE3C,KACbyI,UAAa9F,EAAE8F,UACfqE,IAAOnK,EAAEmK,IACTsB,KAAQzL,EAAEyL,OAEXtJ,EAAKoG,KAAOC,EAAOnI,YAAYgL,YAAYP,GAAGvC,KAC9CC,EAAOnI,YAAYgL,YAAYL,KAAKC,YAErCzC,EAAO0C,QAGRjM,QAAQsD,MAAMmJ,gBAAkB,SAAStD,GACrCA,EAAKuD,oBACPvD,EAAKsB,UAAY,WAChB,MAAO,CAACG,QAASzB,EAAKuD,qBAGxB,IAAIC,EAAO,WACV,GAAG3O,EAAE4I,QAAQzG,QAAQC,IAAIwM,QAAUzM,QAAQC,IAAIwM,MAAM/K,OAAS,EAAG,CAE5D1B,QAAQC,IAAIwM,MAAM,GAAG/F,YACxB1G,QAAQC,IAAIwM,MAAQzM,QAAQC,IAAIwM,MAAM3F,OAAO,IAI9C,IAAI4F,EAAgB/O,OAAOgP,KAAKC,aAAa5M,QAAQa,QAAS,SAASkH,QAInE8E,EAAiB,KACrBlP,OAAOmP,SAASJ,GAAenD,OAAO/F,QAAQ,SAAS5C,GACnDA,EAAEmH,UAAUiB,EAAK+D,iBAAgBF,EAAiBjM,EAAEqE,aAGxD,IAAI+H,GAAc,EACdC,EAAe,GAEnBpP,EAAEqP,KAAKlN,QAAQC,IAAIwM,MAAO,SAAStH,EAAGvE,GACrCoI,EAAKmE,YAAY3J,QAAQ,SAAS4J,GAC9BxM,EAAEiM,IAAiBO,IACrBJ,GAAc,EACVC,EAAarM,EAAE8F,WAClBuG,EAAarM,EAAE8F,YAAc2G,IAAIzM,EAAEmK,KAEnCkC,EAAarM,EAAE8F,WAAa2G,IAAIzM,EAAEmK,UAKnCiC,GACFhE,EAAKmE,YAAY3J,QAAQ,SAAS4J,GACjCzP,OAAOsI,MAAMqH,SAAStE,EAAK+D,eAAgBK,EAAK,SAASxH,GACxD,IAAI2H,EAAa5P,OAAOsI,MAAM/F,QAAQ8I,EAAK+D,eAAgBK,GAC3DvP,EAAEqP,KAAKK,EAAWd,OAAS,GAAI,SAAStH,EAAG0F,GAC1C,GAAGA,EAAIE,IAAMsC,IAAIJ,EAAapC,EAAInE,YAEjC,OADAsG,GAAc,GACP,MAKPA,GACFrP,OAAO6P,SAASnP,GAAG,+CAClB,CAAC2K,EAAK+D,eAAgBK,OAQ3B,OAAOzP,OAAO6H,KAAK,CAGlBiI,KAAM,OACNhI,OAAQ,+BACRC,KAAM,CACLD,OAAUuD,EAAKvD,OACfiI,aAAgB1E,EAAKmE,YACrBQ,WAAc3N,QAAQC,IACtByF,KAAQsD,EAAKtD,MAEdH,SAAU,SAASK,GAClB,IAAIA,EAAEgI,IAAK,CACAjQ,OAAOsI,MAAMC,KAAKN,EAAEO,SAC9BnG,QAAQ6N,QACR7N,QAAQ6L,eAKZ,GAAG7C,EAAK+D,eACP,IAAInM,EAAI,IAAIjD,OAAOiL,GAAGC,KAAKiF,kBAAkB,CAC5CjN,QAASmI,EAAK+D,eACdgB,OAAQ/E,EAAK+E,OACbC,WAAYhF,EAAKgF,iBAAcC,EAC/BC,QAASlF,EAAKkF,QACd5D,UAAWtB,EAAKsB,UAChB6D,OAAQ,SAASC,EAAY1I,GAC5BuB,IAAIoH,EAASD,EACQ,IAAlBC,EAAO3M,QAIVsH,EAAKmE,YAAckB,EACnBrF,EAAKkF,QAAUxI,EACf9E,EAAEwI,OAAOkC,OACTkB,KANC7O,OAAO6P,SAASnP,GAAG,oBAAqB,CAAC2K,EAAK+D,0BASxC/D,EAAKmE,cACdnE,EAAKmE,YAAc,CAACnE,EAAKmE,aACzBX,MAIF7O,OAAOkL,KAAKyF,gBAAsB,KAAI,SAAS5G,EAAOzH,GACrD,OAAGA,GAAOA,EAAIsO,WAAatO,EAAIsO,YAAc7G,EACrCA,EAAOA,EAAQ,KAAOzH,EAAIsO,UAAWtO,EAAIsO,UAEzC7G,GAIT/J,OAAOkL,KAAKyF,gBAA0B,SAAI,SAAS5G,EAAOzH,GACzD,OAAGA,GAAOA,EAAIuO,eAAiBvO,EAAIuO,gBAAkB9G,EAC7CA,EAAOA,EAAQ,KAAOzH,EAAIuO,cAAevO,EAAIuO,cAE7C9G,GAKT7J,EAAEC,UAAUkF,GAAG,YAAa,WACvBrF,OAAO8Q,SAASC,oBACnB7Q,EAAEqP,KAAK,CAAC,uBAAwB,cAAe,qBAC9C,gBAAiB,mBAAoB,iBAAkB,SAAS/H,EAAGvE,GACnEjD,OAAOiL,GAAGC,KAAK7F,GAAGpC,EAAG,SAAU,SAASsC,GACvClD,QAAQ2O,gBAAgB,eAAgB,cACvChR,OAAOiR,aAAaC,iBClmBzBlR,OAAOC,QAAQ,mBACfC,EAAEU,OAAOsB,QAAQiP,QAAS,CACzBC,KAAM,WACL,MAAO,CAAEvE,MAAO,6CAGjBwE,KAAM,WACL,MAAO,CAAExE,MAAO,2CAGjByE,SAAU,WACT,MAAO,CAAEzE,MAAO,+CAGjB0E,SAAU,WACT,MAAO,CAAE1E,MAAO,+CAGjB2E,KAAM,SAAS1E,GACd,IAAI/E,EAAO,CAAE8E,MAAO,0CAEpB,OADGC,IAAS/E,EAAc,QAAI+E,GACvB/E,GAGR0J,IAAK,WACJ,MAAO,CAAE5E,MAAO,oCAGjB6E,KAAM,WACL,MAAO,CAAE7E,MAAO,sCAGjB8E,gBAAiB,SAASrP,GAKzB,OAJIA,EAAIgP,UACPtR,OAAO4R,MAAMlR,GAAG,iBAAkB,CAACA,GAAGV,OAAOgP,KAAK6C,UAAUvP,EAAIY,QAAS,WAAYZ,EAAIhC,UAGnF,CAAEwM,QAAS,CAAEwE,SAAUhP,EAAIgP,YAGnCQ,cAAe,SAASxP,GACvB,GAAGtC,OAAO+R,aAMT,OALIzP,EAAItC,OAAO+R,aAAazK,YAC3BtH,OAAO4R,MAAMlR,GAAG,iBACf,CAACA,GAAGV,OAAOgP,KAAK6C,UAAUvP,EAAIY,QAASlD,OAAO+R,aAAazK,UAAWhF,EAAIhC,UAGrE,CACNuM,MAAO,wDACPC,QAAS,CACRkF,aAAchS,OAAO+R,aAAa7O,QAClC+O,UAAW3P,EAAItC,OAAO+R,aAAazK,cAMvC4K,cAAe,SAAS5P,GACvB,GAAGtC,OAAO+R,aAMT,OALIzP,EAAItC,OAAO+R,aAAazK,YAC3BtH,OAAO4R,MAAMlR,GAAG,iBACf,CAACA,GAAGV,OAAOgP,KAAK6C,UAAUvP,EAAIY,QAASlD,OAAO+R,aAAazK,UAAWhF,EAAIhC,UAE5E6R,QAAQC,IAAIpS,OAAO+R,cACZ,CACNlF,MAAO,wDACPC,QAAS,CACRkF,aAAchS,OAAO+R,aAAa7O,QAClC+O,UAAW3P,EAAItC,OAAO+R,aAAazK,cAMvC+K,sBAAuB,SAAS/P,GAC/B,MAAO,CACNuK,MAAO,wDACPC,QAAS,CAAEwF,wBAAyB,EAAGN,aAAc,UAAWC,UAAW3P,EAAIF,SAAW,MAI5FmQ,gBAAiB,SAASjQ,GAKzB,OAJIA,EAAIiP,UACPvR,OAAO4R,MAAMlR,GAAG,iBAAkB,CAACA,GAAGV,OAAOgP,KAAK6C,UAAUvP,EAAIY,QAAS,WAAYZ,EAAIhC,UAGnF,CAAEwM,QAAS,CAAEyE,SAAUjP,EAAIiP,YAGnCiB,YAAa,SAASlQ,GAMrB,OALIA,EAAI+O,MACPrR,OAAO4R,MAAMlR,GAAG,uBACf,CAACA,GAAGV,OAAOgP,KAAK6C,UAAUvP,EAAIY,QAAS,OAAQZ,EAAIhC,UAG9C,CAAEwM,QAAS,CAAEuE,KAAM/O,EAAI+O,QAG/BoB,mBAAoB,WACnB,MAAO,CAAE3F,QAAS,CAAE4F,SAAU,KAG/BC,SAAU,WACT,MAAO,CAAE9F,MAAO,+CAGjBL,UAAW,SAASlK,GACnB,MAAO,CACNwK,QAAS,CACR,CAAC,YAAa,UAAW,KAAM,CAAC,GAAI8F,KAAKtQ,EAAIF,WAC7C,CAAC,YAAa,WAAY,IAAI,QAOlCF,QAAQiP,QAAQ0B,cAAgB,SAAStN,EAAK6E,EAAS0I,GAEtD,IAAIC,EAAY,SAAS7P,EAAS8P,GACjC,IAAIC,EAAcjT,OAAOgP,KAAKkE,cAAchQ,EAASqC,EAAIjD,IAAIhC,KAC5D,CAACuL,UAAa,OAAQzB,QAAWA,IAClClK,EAAEqP,KAAK0D,EAAa,SAASzL,EAAGuG,GAC5BiF,EACFzN,EAAIwN,UAAUhF,EAAGzG,UAAW0L,EAAaF,GAEzCvN,EAAIwN,UAAUhF,EAAGzG,UAAWwL,MAK/BC,EAAUxN,EAAIjD,IAAIY,SAGlBhD,EAAEqP,KAAKvP,OAAOgP,KAAKkE,cAAc3N,EAAIjD,IAAIY,QAASqC,EAAIjD,IAAIhC,KAAM,CAACuL,UAAa,UAC7E,SAASrE,EAAGuG,GACXgF,EAAUhF,EAAG3D,QAAS2D,EAAGzG,cAQ5BpF,QAAQiP,QAAQgC,sBAAwB,SAAS5N,GAChDA,EAAIwN,UAAU,YAAa,QAAS,SAASzQ,EAAK8Q,EAAKC,GACtD,IAAInG,EAAOpJ,OAAOsP,GAAKC,GACnBvG,EAAU5K,QAAQiP,QAAQ3E,UAAUjH,EAAIjD,KAK5C,OAJG4K,EAAInE,YACN7I,EAAEU,OAAOkM,EAAS,CAACD,MAAQ,gDAC3BC,EAAiB,QAAEkB,KAAK,CAAC,MAAO,YAAa,IAAKd,EAAInE,aAEhD+D,KCzJT5K,QAAQoR,WAAa,SAAoBhR,GACxC,IAAI6C,EAAKC,KACTA,KAAKmO,MAAQ,WACZ,IAAIC,EAAc,CACjBC,KAAY,GACZC,YAAkB,yDAA2DpR,EAAIhC,KACjFqT,UAAgB,aAAerR,EAAIhC,KAAO,oCAC1CsT,cAAiB,eAAiBtR,EAAIhC,KAAO,8BACvCgC,EAAIuR,aAAgB,YAAcvR,EAAIuR,aAAgB,KACtDvR,EAAIwR,MAAS,iBAAmBxR,EAAIwR,MAAS,IACnDC,gBAAmB,mDAAqDzR,EAAIhC,MACtEgC,EAAIwR,MAAS,iBAAmBxR,EAAIwR,MAAS,IACnDE,gBAAiB,WAAa1R,EAAIhC,KAAO,6BACnCgC,EAAIwR,MAAS,iBAAmBxR,EAAIwR,MAAS,IACnDG,mBAAuB,oBAAsB3R,EAAIhC,KAAO,iCACxD4T,iBAAmB,kBAAoB5R,EAAIhC,KAAO,2BAClD6T,mBAAqB,qDAAuD7R,EAAIhC,MAG7E8T,QAAQ,CAAC,cAAe,gBAAiB,iBAAkB9R,EAAIY,SAClEkC,KAAK+I,KAAK7L,EAAI+R,eAAgB,WAAY/R,EAAIgP,SAAU,GAAIkC,EAAYlR,EAAIY,UACpD,cAAhBZ,EAAIY,QACZkC,KAAK+I,KAAK7L,EAAI+R,eAAgB,WAAY/R,EAAIgS,WAAY,GAAId,EAAYlR,EAAIY,UACtEkR,QAAQ,CAAC,iBAAkB,oBAAqB9R,EAAIY,SAC5DkC,KAAK+I,KAAK7L,EAAI+R,eAAgB,WAAY/R,EAAIiP,SAAU,GAAIiC,EAAYlR,EAAIY,UACrD,QAAfZ,EAAIY,QACZkC,KAAK+I,KAAK,GAAI,GAAI,GAAI7L,EAAIiS,UAAWf,EAAYlR,EAAIY,UAC9B,eAAfZ,EAAIY,QACZkC,KAAK+I,KAAK,GAAI,GAAI,GAAI7L,EAAIkS,WAAYhB,EAAYlR,EAAIY,UAC/B,oBAAfZ,EAAIY,SACZkC,KAAK+I,KAAK,GAAI,GAAI,GAAI,GAAIqF,EAAYlR,EAAIY,WAI5CkC,KAAKqP,mBAAqB,SAASC,EAASC,EAAaC,GACxD5U,OAAO6H,KAAK,CACXC,OAAQ,mEACRC,KAAM,CACL8M,aAAcH,EACdC,YAAaA,EACbC,SAAUA,GAEXhN,SAAU,SAASK,GACfA,EAAEgI,IAAOjQ,OAAO6P,SAAS5H,EAAEgI,MAC9B9K,EAAG2P,OAAS7M,EAAEO,QACdrD,EAAG4P,mBAKN3P,KAAK+I,KAAO,SAASuG,EAASC,EAAaC,EAAUI,EAAYxM,GAChEpD,KAAKoD,QAAUA,EACXwM,GACH7P,EAAG2P,OAASE,EACZ7P,EAAG4P,eACOL,EACVtP,KAAKqP,mBAAmBC,EAASC,EAAaC,GAE9CzP,EAAG4P,eAGL3P,KAAK2P,YAAc,WACd5P,EAAGsG,QACNtG,EAAG8P,cACJ9P,EAAGsG,OAAOyJ,WAAW,CACpB1M,QAAWrD,EAAGqD,QACdsM,OAAU3P,EAAG2P,SAEd3P,EAAGsG,OAAO0C,QAEX/I,KAAK6P,YAAc,WAClB,IAAIhS,EAAI,IAAIjD,OAAOiL,GAAGS,OAAO,CAC5BC,MAAO,WACPwJ,MAAO,IACPvJ,OAAQ,CACP,CAACtE,UAAU,SAAUuE,UAAU,OAAQC,MAAM,gBAAiBsJ,KAAK,GACnE,CAAC9N,UAAU,UAAWuE,UAAU,OAAQC,MAAM,UAAWsJ,KAAK,GAC9D,CAAC9N,UAAU,OAAQuE,UAAU,SAAUC,MAAM,WAG/C7I,EAAEK,YAAY+R,KAAKC,MAAMC,QAAU,WAClC,IAAIC,EAAMvS,EAAEK,YAAY+R,KAAKC,MACzBG,EAAItQ,EAAGsG,OAAOuB,aACfyI,IACFvV,EAAEsV,GAAKE,cACP1V,OAAO6H,KAAK,CACXC,OAAQ,yDACRC,KAAM,CACL4N,cAAe,CAACF,EAAEX,QAClBc,IAAKH,EAAEjN,SAERZ,SAAU,SAASK,GAClB/H,EAAEsV,GAAKK,eACJ5N,EAAEgI,IAAMjQ,OAAO6P,SAAS5H,EAAEgI,KAC7B9K,EAAGsG,OAAOkC,YAKdvI,KAAKqG,OAASxI,GAEfmC,KAAKmO,SCrGNvT,OAAOC,QAAQ,iBAEfiC,QAAQsD,MAAMsQ,kBAAoB,SAASvQ,EAAKuC,EAAQC,EAAMH,GAI7D,GAHIE,IACHA,EAAS,6CAENC,EAAM,CACT,GAAmB,kBAAfxC,EAAIrC,SAA+BqC,EAAIjD,IAAIgP,UAC1C/L,EAAIjD,IAAIgS,YAAcF,QAAQ,CAAC,YAAa,eAAgB7O,EAAIjD,IAAIY,SAAW,CAEnFoG,IAAIzC,EAAa,WACdtB,EAAIjD,IAAIyT,cAAyC,SAAzBxQ,EAAIjD,IAAIyT,eAClClP,EAAa,QAGdkB,EAAO,CACNiO,MAAOzQ,EAAIjD,IAAIgP,UAAY/L,EAAIjD,IAAIgS,WACnCzN,WAAYA,EACZoP,WAAY1Q,EAAIjD,IAAI4T,yBAEZ3Q,EAAIjD,IAAIiP,WACjBxJ,EAAO,CACNiO,MAAOzQ,EAAIjD,IAAIiP,SACf1K,WAAY,WACZsP,UAAW5Q,EAAIjD,IAAI6T,UACnBF,WAAY1Q,EAAIjD,IAAI8T,oBAIlBrO,IACHA,EAAKsO,aAAe9Q,EAAIjD,IAAI+T,cAAgB9Q,EAAIjD,IAAIgU,kBAGlDvO,GAASA,EAAKiO,QAEfhW,OAAOgP,KAAKC,aAAa1J,EAAIjD,IAAIY,QAAS,WACxChB,QAAQsD,MAAM+Q,mBAAmBhR,EAAK,2BACzCwC,EAAKsO,aAA+B,YAAjBtO,EAAKlB,WAAyB,WAAY,cAG/DkB,EAAKpF,SAAW4C,EAAIjD,IAAIK,SACxBoF,EAAK3F,QAAUmD,EAAIjD,IAAIF,QACvB2F,EAAK7E,QAAUqC,EAAIjD,IAAIY,QACvBlD,OAAO6H,KAAK,CACXC,OAAQA,EACRC,KAAMA,EACNH,SAAU,SAASK,GACfA,EAAEO,UACJjD,EAAIiR,aAAevO,EAAEO,QAAQgO,aAC7BjR,EAAIkR,wBAAyB,EAC7BzW,OAAO0W,aAAa,mBACbnR,EAAIvB,UAAUiE,EAAEO,qBAErBjD,EAAIkR,wBAAyB,EAC1B7O,GAAUA,IACbrC,EAAI2I,UACJhM,QAAQsD,MAAMmR,SAASpR,aAQ7BrD,QAAQsD,MAAMmR,SAAW,SAASpR,GACjC,GAAGA,EAAIqR,SAAU,CAChB,IAAIC,EAAa7W,OAAO8W,iBACxB,KAAmB,SAAhBD,EAAW,IAAiBtR,EAAIjD,IAAIwM,OAASvJ,EAAIjD,IAAIwM,MAAM/K,QAAS,CAEtE,IAAIyN,EAAOjM,EAAIwR,UAAU,SACzBxR,EAAIkC,cAAc,SAGlBzH,OAAOsI,MAAMtE,UAAUwN,EAAKtO,QAASsO,EAAKlR,KAAM,YAAauW,EAAW,OAK3E3U,QAAQsD,MAAMwR,oBAAsB,SAASzR,EAAK0R,EAAeC,EAAe5E,GAC/E,IAAG/M,EAAIkR,uBAAP,CAEA,IAAIQ,EACH,GAAkB,kBAAf1R,EAAIrC,SAA+BqC,EAAIjD,IAAIgP,SAC7C2F,EAAgB,uBACV,CAAA,IAAG1R,EAAIjD,IAAIiP,SAEX,OADN0F,EAAgB,mBAIdC,IAAeA,EAAgB,mBAChC3R,EAAIjD,IAAI2U,GACVjX,OAAO6H,KAAK,CACXC,OAAQ,8DACRC,KAAM,CAACoP,aAAgB5R,EAAIjD,IAAI2U,IAC/BrP,SAAU,SAASK,GACfA,EAAEO,SACJjD,EAAIvB,UAAUkT,EAAejP,EAAEO,YAKlCjD,EAAIvB,UAAUkT,EAAe,MAI/BhV,QAAQsD,MAAM4R,uBAAyB,SAAS7R,EAAK8R,EAAsBC,EAAuBC,GAC9FhS,EAAIkR,wBAEJzW,OAAOgP,KAAKC,aAAa1J,EAAIjD,IAAIY,QAAS,UACxChB,QAAQsD,MAAM+Q,mBAAmBhR,EAAK,yBACzCA,EAAIjD,IAAIgP,UAAY/L,EAAIjD,IAAIiP,UAAYhM,EAAIjD,IAAI+O,MAAQ9L,EAAIjD,IAAIgS,WAAY+C,IAIzEnV,QAAQsD,MAAM+Q,mBAAmBhR,EAAK,2BACzCA,EAAIjD,IAAI+T,cAAgB9Q,EAAIjD,IAAIgU,iBAAkBe,IAOpDrX,OAAO6H,KAAK,CACXC,OAAQ,kDACRC,KAAM,CACLyP,aAAgBjS,EAAIjD,IAAIkV,aACxBC,gBAAmBlS,EAAIjD,IAAIgV,GAC3BI,iBAAoBnS,EAAIjD,IAAIiV,IAE7B3P,SAAU,SAASK,GACdA,EAAEgI,MACF1K,EAAIjD,IAAIkV,cAAgBvP,EAAEO,QAC5BjD,EAAIvB,UAAU,eAAgBiE,EAAEO,SAEhCtG,QAAQsD,MAAMmS,UAAUpS,EAAK8R,QAOlCnV,QAAQsD,MAAMmS,UAAY,SAASpS,EAAK8R,GAevC,IAAIxQ,EAAYmP,EAdbhW,OAAOgP,KAAKC,aAAa1J,EAAIjD,IAAIY,QAAS,WACxChB,QAAQsD,MAAM+Q,mBAAmBhR,EAAK,yBACzCA,EAAIjD,IAAIgP,UAAY/L,EAAIjD,IAAIiP,UAAYhM,EAAIjD,IAAI+O,MAAQ9L,EAAIjD,IAAIgS,WAAY+C,IAIzEnV,QAAQsD,MAAM+Q,mBAAmBhR,EAAK,2BACzCA,EAAIjD,IAAI+T,cAAgB9Q,EAAIjD,IAAIgU,iBAAkBe,KAQhD9R,EAAIjD,IAAI+O,MACXxK,EAAa,OACbmP,EAAQzQ,EAAIjD,IAAI+O,MACN9L,EAAIjD,IAAIgP,UAClBzK,EAAa,WACbmP,EAAQzQ,EAAIjD,IAAIgP,UACN/L,EAAIjD,IAAIiP,UAClB1K,EAAa,WACbmP,EAAQzQ,EAAIjD,IAAIiP,UACNhM,EAAIjD,IAAIyT,eAClBlP,EAAatB,EAAIjD,IAAIyT,aACrBC,EAAQzQ,EAAIjD,IAAIgS,YAGjBtU,OAAO6H,KAAK,CACXC,OAAQ,mCACRC,KAAM,CACLiO,MAASA,EACTnP,WAAcA,EACdwP,aAAgB9Q,EAAIjD,IAAI+T,cAAgB9Q,EAAIjD,IAAIgU,iBAChDlU,QAAWmD,EAAIjD,IAAIF,QACnBwV,eAAkBrS,EAAIjD,IAAIsV,eAC1BC,eAAkBtS,EAAIjD,IAAIuV,eAC1BL,aAAgBjS,EAAIjD,IAAIkV,aACxBC,gBAAqBlS,EAAIjD,IAAIgP,UAAY/L,EAAIjD,IAAI+O,KAAS9L,EAAIjD,IAAoB,iBAAKiD,EAAIjD,IAAoB,iBAC/GoV,iBAAoBnS,EAAIjD,IAAIwV,uBAE7BlQ,SAAU,SAASK,GACfA,EAAEO,SACJjD,EAAIvB,UAAU,oBAAqBiE,EAAEO,eAMzCtG,QAAQsD,MAAMuS,oBAAsB,SAASxS,GACzCA,EAAIkR,wBAEJlR,EAAIjD,IAAoB,gBAC1BtC,OAAO6H,KAAK,CACXC,OAAQ,8DACRC,KAAM,CAAC2M,QAASnP,EAAIjD,IAAI+R,gBACxBzM,SAAU,SAASK,GACfA,EAAEO,SACJjD,EAAIvB,UAAUiE,EAAEO,aAMrBtG,QAAQsD,MAAM+Q,mBAAqB,SAAShR,EAAKuG,EAAO/B,EAAOiO,GAC9D,QAAIjO,IACHxE,EAAIjD,IAAI0V,GAAc,GACtBvQ,cAAcuQ,GACdhY,OAAO6P,SAASnP,GAAG,yBAA0B,CAACoL,MACvC,IAKT5J,QAAQsD,MAAMyS,qBAAuB,SAAS1S,EAAKqC,GAC9CrC,EAAIjD,IAAIF,QACXpC,OAAO6H,KAAK,CACXC,OAAQ,+DACRC,KAAM,CACL3F,QAASmD,EAAIjD,IAAIF,QACjB8V,QAAS3S,EAAIjD,IAAIoV,kBAElB9P,SAAU,SAASK,GAMlB,GALGA,EAAEO,UACJjD,EAAIvB,UAAU,mBAAoBiE,EAAEO,QAAQ,IAC5CjD,EAAIvB,UAAU,2BAA4BiE,EAAEO,QAAQ,KAGlDZ,EACF,OAAOA,OAKV5H,OAAO6P,SAASnP,GAAG,s2EC7OrBV,OAAOC,QAAQ,iBAEfiC,QAAQiW,MAAMC,gBAAkBpY,OAAOiL,GAAGC,KAAKmN,WAAWzX,OAAO,CAChE0X,OAAQ,WAEHlT,KAAKG,IAAIjC,YAAYlB,SACxBgD,KAAK+N,yBAIPA,sBAAuB,WACtB,IAAIhO,EAAKC,KACTlD,QAAQiP,QAAQ0B,cAAczN,KAAKG,IAAK,YAAa,WACpD,OAAOrD,QAAQiP,QAAQ3E,UAAUrH,EAAGI,IAAIjD,QAI1CiW,8BAA+B,WAE9BvY,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIrC,QAAS,sCAAuC,SAASqC,GAC3D,GAArBA,EAAIjD,IAAIkW,WAAkBjT,EAAIjD,IAAImW,kBACpClT,EAAIyL,gBAAgB,eAAgB,YAAa,GACjDzL,EAAIyL,gBAAgB,eAAgB,YAAa,KAEjDzL,EAAIyL,gBAAgB,eAAgB,YAAa,GACjDzL,EAAIyL,gBAAgB,eAAgB,YAAa,MAInDhR,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIrC,QAAS,mBAAoB,SAASqC,GAChEA,EAAIgI,QAAQ,yCAGbvN,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIrC,QAAS,UAAW,SAASqC,GAEjC,GAAnBA,EAAIjD,IAAIkW,YACNjT,EAAIjD,IAAI+T,cACX9Q,EAAIvB,UAAU,eAAgBhE,OAAO8Q,SAAS4H,WAE3CnT,EAAIjD,IAAIqW,cACXpT,EAAIvB,UAAU,eAAgBhE,OAAO8Q,SAAS8H,YAE/CrT,EAAIgI,QAAQ,2CAKfsL,kBAAmB,WAClB,IAAI1T,EAAKC,KACmB,IAAzBA,KAAKG,IAAIjD,IAAIkW,WACfnW,QAAQyW,kBAAkBpY,GAAG,gBAAiB,WAC7CV,OAAO+Y,cAAgB,CACtBC,WAAY7T,EAAGI,IAAIjD,IAAIhC,KACvB2Y,UAAW9T,EAAGI,IAAIjD,IAAI+T,aACtB6C,QAAS/T,EAAGI,IAAIjD,IAAI+T,aACpBjU,QAAS+C,EAAGI,IAAIjD,IAAIF,SAErBpC,OAAOyI,UAAU,eAAgB,iBAC/B/H,GAAG,UAKRyY,oBAAqB,WACpB,IAAIhU,EAAKC,KACmB,IAAzBA,KAAKG,IAAIjD,IAAIkW,WACfnW,QAAQyW,kBAAkBpY,GAAG,qBAAsB,WAClDV,OAAO+Y,cAAgB,CACtBC,WAAY7T,EAAGI,IAAIjD,IAAIhC,KACvB2Y,UAAW9T,EAAGI,IAAIjD,IAAI+T,aACtB6C,QAAS/T,EAAGI,IAAIjD,IAAI+T,aACpBjU,QAAS+C,EAAGI,IAAIjD,IAAIF,QACpBgX,SAAU,mCAEXpZ,OAAOyI,UAAU,eAAgB,mBAC/B/H,GAAG,YC3ETwB,QAAQmX,SAAWnX,QAAQiW,MAAMC,gBAAgBxX,OAAO,CACvD0Y,aAAc,WAGblU,KAAKqG,OAAS,IAAIzL,OAAOiL,GAAGS,OAAO,CAClCC,MAAO,YAGRvG,KAAKqG,OAAO0C,OACZ/I,KAAKmU,MAAQnU,KAAKqG,OAAO+N,KACzBpU,KAAKqU,6BACLrU,KAAKsU,gBACLtU,KAAKuU,eAGNA,YAAa,WAEZzZ,EAAEkF,KAAKmU,OAAOK,KAAK,iBAAiBC,MAAM,WACzC3Z,EAAEkF,MAAM0U,YAIVL,2BAA4B,WAC3B,IAAItU,EAAKC,KAETA,KAAKqG,OAAOsO,mBAAmBrZ,GAAG,UAAW,WAE5CR,EAAEqP,KAAKpK,EAAGI,IAAIjD,IAAI+W,SAAU,SAAUrP,EAAOwB,GAC5C,GAAmB,GAAfA,EAAKwO,OAGR,OAFA7U,EAAGsG,OAAOkC,YACVxI,EAAG8U,sBAOPP,cAAe,WAEdxZ,EAAEkF,KAAKmU,OAAOW,QACdha,EAAEkF,KAAKmU,OAAOY,KAAKna,OAAOoa,gBAAgB,cAAehV,KAAKG,IAAIjD,MAClE8C,KAAKiV,uBACLjV,KAAKkV,sBACLlV,KAAKmV,gBAGNC,uBAAwB,WAGpBpV,KAAKG,IAAIjD,IAAImY,cAAgB,IAFvBrV,KAGLsV,YAHKtV,KAGY9C,IAAIqY,oBAGzBvV,KAAKiU,SAAWrZ,OAAOsI,MAAMyO,UAAU3R,KAAKG,IAAIjD,IAAK,qBAAsB,YAC3E8C,KAAKiU,SAASuB,gBAAkBxV,KAAKqG,OAAOnI,YAAYsX,gBAAgBrO,YACxEnH,KAAKiU,SAASW,OAAStK,IAAItK,KAAKsV,cAGjCL,qBAAsB,WACrB,IAAIlV,EAAKC,KACLyV,EAAqB3a,EAAEkF,KAAKmU,OAAOK,KAAK,uBAAuBM,QAChE9U,KAAKG,IAAIjD,IAAI+W,SAAStV,OACxB7D,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAI+W,SAAU,SAASrP,EAAOwB,GAC7CtL,EAAEF,OAAOoa,gBAAgB,kBAAmB,CAC3CQ,gBAAiBpP,EAAKoP,gBACtBZ,OAAQxO,EAAKwO,OACbc,IAAKtP,EAAKsP,IACVnY,SAAUwC,EAAGI,IAAIjD,IAAIK,SACrBmN,KAAMtE,EAAKsE,QACRhL,SAAS+V,GAEI,QAAbrP,EAAKsE,MAAkBtE,EAAKwO,QAAU7U,EAAGI,IAAIjD,IAAIyY,cACpD5V,EAAG2V,IAAMtP,EAAKsP,IACd3V,EAAG6V,cAAgB9a,EAAEiF,EAAGoU,OAAOK,KAAKqB,KAAK,uBAAuB,CAACH,IAAO3V,EAAG2V,OAC3E3V,EAAG+V,yBACH/V,EAAGgW,8BAILjb,EAAE,kDAAkD4E,SAAS+V,IAI/DO,uBAAwB,WACvBhW,KAAK4V,cAAgB9a,EAAEkF,KAAKmU,OAAOK,KAAKqB,KAAK,uBAAuB,CAACH,IAAO1V,KAAK0V,OACjF1V,KAAK8V,yBACL9V,KAAKsV,YAAc,EAChBtV,KAAKG,IAAIjD,IAAIqY,mBAAqB,GAAsC,GAAjCjL,IAAItK,KAAK4V,cAAcK,QAEhEjW,KAAKsV,YAAchL,IAAItK,KAAKG,IAAIjD,IAAIqY,mBAAqBvV,KAAKG,IAAIjD,IAAIgZ,gBAAiBC,UAAU,uBACjGnW,KAAK4V,cAAcK,IAAInV,gBAAgBd,KAAKsV,YAAatV,KAAKG,IAAIjD,IAAIK,WACtEyC,KAAKoW,yBACG9L,IAAItK,KAAK4V,cAAcK,OAAS,IAExCjW,KAAKsV,YAAchL,IAAItK,KAAK4V,cAAcK,QAE3CjW,KAAK4V,cAAclB,SACnB1U,KAAK+V,4BAGNb,oBAAqB,WAEpBlV,KAAKsV,YAAc,GACnBtV,KAAKqW,0BACLrW,KAAKsW,2BAGND,wBAAyB,WACxB,IAAItW,EAAKC,KACTlF,EAAEkF,KAAKmU,OAAOK,KAAK,oBAAoBC,MAAM,WAC5C1U,EAAG2V,IAAM5a,EAAEkF,MAAM5E,KAAK,OACtB2E,EAAGiW,2BAGJlb,EAAEkF,KAAKmU,OAAOK,KAAK,iBAAiBC,MAAM,WACzC1U,EAAG2V,IAAM5a,EAAEkF,MAAM5E,KAAK,OACtB2E,EAAGiW,yBACHjW,EAAGwW,oBAAmB,KAGvBzb,EAAEkF,KAAKmU,OAAOK,KAAK,qBAAqBgC,OAAO,WAC9CzW,EAAG0W,iBAAiBnM,IAAIxP,EAAEkF,MAAMiW,OAAQE,UAAU,uBAGnDrb,EAAEkF,KAAKmU,OAAOK,KAAK,kBAAkBgC,OAAO,WAC3CzW,EAAGsV,cAAc/K,IAAIxP,EAAEkF,MAAMiW,OAAQE,UAAU,qBAIjDL,uBAAwB,WAEvB,IAAIY,EAAe5b,EAAEkF,KAAKmU,OAAOK,KAAKqB,KAAK,kCAAkC,CAACH,IAAO1V,KAAK0V,OAC1F5a,EAAEkF,KAAKmU,OAAOK,KAAK,oBAAoBrT,YAAY,yBACnDuV,EAAarV,SAAS,yBACtBvG,EAAEkF,KAAKmU,OAAOK,KAAK,WAAWpZ,KAAK,YAAY,GAC/C4E,KAAK4V,cAAcxa,KAAK,YAAY,IAGrCkb,wBAAyB,WACxB,IAAIvW,EAAKC,KACTlF,EAAEkF,KAAKmU,OAAOK,KAAK,qBAAqBC,MAAM,WAC7C1U,EAAGuV,aAAexa,EAAEkF,MAAM2W,OAC1B5W,EAAG6V,cAAcK,IAAInV,gBAAgBf,EAAGuV,YAAavV,EAAGI,IAAIjD,IAAIK,WAChEwC,EAAG2V,IAAM3V,EAAG6V,cAAcxa,KAAK,OAC/B2E,EAAGwW,uBAGJzb,EAAEkF,KAAKmU,OAAOK,KAAK,eAAeC,MAAM,WACvC1U,EAAGuV,YAAe9H,KAAKlD,IAAIvK,EAAG6V,cAAcK,QAAQW,MAAM,GAAI,GAC9D7W,EAAG6V,cAAcK,IAAInV,gBAAgBf,EAAGuV,YAAavV,EAAGI,IAAIjD,IAAIK,WAChEwC,EAAG2V,IAAM3V,EAAG6V,cAAcxa,KAAK,OAC/B2E,EAAGwW,wBAKLR,yBAA0B,WACzB,IAAIhW,EAAKC,KACTA,KAAK4V,cAAcY,OAAO,WACzBzW,EAAGuV,YAAehL,IAAIxP,EAAEkF,MAAMiW,QAAU,EACxClW,EAAG6V,cAAcK,IAAInV,gBAAgBf,EAAGuV,YAAavV,EAAGI,IAAIjD,IAAIK,WAChEwC,EAAG2V,IAAM3V,EAAG6V,cAAcxa,KAAK,OAC/B2E,EAAGqW,2BAILjB,aAAc,WACb,IAAIpV,EAAKC,KACTlF,EAAEkF,KAAKmU,OAAOK,KAAK,QAAQC,MAAM,SAASjN,GACzCA,EAAEqP,kBACF9W,EAAG2V,IAAM5a,EAAEkF,MAAM5E,KAAK,OACtB2E,EAAG6V,cAAgB9a,EAAEiF,EAAGoU,OAAOK,KAAKqB,KAAK,uBAAuB,CAACH,IAAO3V,EAAG2V,OAC3E3V,EAAGuV,YAAc,EACjBvV,EAAG6V,cAAcK,IAAI,GACrBlW,EAAG+V,yBACH/V,EAAGqW,2BAILK,iBAAkB,SAASA,GAG1BzW,KAAKG,IAAIjD,IAAIuZ,iBAAmBnM,IAAImM,EAAkBN,UAAU,qBAChEnW,KAAKG,IAAIjD,IAAI4Z,sBAAwBxM,IAAItK,KAAKG,IAAIjD,IAAIuZ,iBAAmBzW,KAAKG,IAAIjD,IAAIgZ,gBACrFC,UAAU,0BACXnW,KAAK+W,8BAA6B,GAClC/W,KAAKgX,gBAGN3B,cAAe,SAASA,GAGvBrV,KAAKG,IAAIjD,IAAImY,cAAgB/K,IAAI+K,EAAec,UAAU,kBAC1DnW,KAAKiX,6BACLjX,KAAKgX,gBAGNT,mBAAoB,SAASW,GAC5B,IAAInX,EAAKC,KACT,GAAGgP,QAAQ,CAAC,gBAAiB,oBAAqBhP,KAAK0V,KAAK,CAC3D,IAAI/Q,EAAQ5E,EAAG6V,cAAcK,MAChB,iBAAVlW,EAAG2V,IACL3V,EAAGsV,cAAc1Q,IAEA,GAAd2F,IAAI3F,IAAeuS,GAAoBnX,EAAGI,IAAIjD,IAAIqY,mBAAqB,IACzE5Q,EAAQ2F,IAAIvK,EAAGI,IAAIjD,IAAIqY,mBAAqBxV,EAAGI,IAAIjD,IAAIgZ,gBAAiBC,UAAUpW,EAAG2V,OAEtF3V,EAAG0W,iBAAiB9R,SAGrB3E,KAAKoW,yBAIPA,sBAAuB,WACtB,IAAIrW,EAAKC,KAETlF,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAI+W,SAAU,SAASrP,EAAOwB,GAC1CnH,KAAKc,EAAG2V,MAAQzW,KAAKmH,EAAKsP,OAC5BtP,EAAKwO,OAAStK,IAAIvK,EAAG6V,cAAcK,MAAO,MAI5CjW,KAAK+W,8BAA6B,GAClC/W,KAAKgX,gBAGNA,aAAc,WAEblc,EAAEkF,KAAKmU,OAAOK,KAAK,qBAAqByB,IAAInV,gBAAgBd,KAAKG,IAAIjD,IAAIuZ,iBAAkBzW,KAAKG,IAAIjD,IAAIK,WACxGzC,EAAEkF,KAAKmU,OAAOK,KAAK,gBAAgBmC,KAAK7V,gBAAgBd,KAAKG,IAAIjD,IAAIyY,YAAa3V,KAAKG,IAAIjD,IAAIK,WAC/FzC,EAAEkF,KAAKmU,OAAOK,KAAK,kBAAkByB,IAAInV,gBAAgBd,KAAKG,IAAIjD,IAAImY,cAAerV,KAAKG,IAAIjD,IAAIK,WAClGzC,EAAEkF,KAAKmU,OAAOK,KAAK,uBAAuBmC,KAAK7V,gBAAgBd,KAAKG,IAAIjD,IAAIqY,mBAAoB3a,OAAOuC,QAAQ,WAAY6C,KAAKG,IAAIjD,IAAIF,SAASI,mBACjJ4C,KAAKmX,oBCzOPra,QAAQsa,iBAAmBta,QAAQmX,SAASzY,OAAO,CAClD2S,MAAO,aACPkJ,2BAA4B,SAASjL,GACpClI,IAAIoT,EAAsBlL,EAAKmL,gBACP,gBAApBnL,EAAKoL,YAAgCpL,EAAKqL,qBAC7CH,EAAsBlL,EAAKqL,oBAEL,cAApBrL,EAAKsL,YACPtL,EAAKuL,iBAAmBrN,IAAIgN,GACzBhN,IAAIgN,IAAyBhN,IAAI8B,EAAKwL,uBAAyB,KAElExL,EAAKuL,iBAAmBrN,IAAIgN,GAAuBhN,IAAI8B,EAAKwL,uBAE7DxL,EAAKyL,sBAAwBvN,IAAI8B,EAAKuL,kBAAoBrN,IAAItK,KAAKG,IAAIjD,IAAIgZ,iBAE3E9J,EAAK9C,KAAOgB,IAAI8B,EAAKuL,iBAAmBxB,UAAU,OAAQ/J,IAEvDA,EAAK0L,sBACP1L,EAAK2L,gBAAkBzN,IAAI8B,EAAKuL,kBAAoBrN,IAAI8B,EAAK0L,qBAAuB,KAGjF1L,EAAK2L,kBACR3L,EAAK9C,KAAOgB,IAAK8B,EAAqB,iBAAKA,EAAoB,gBAAG+J,UAAU,OAAQ/J,MAItF4L,2BAA4B,SAASzB,GACpCvW,KAAKiY,yBAA0B,EAC/BjY,KAAKkY,8BACLlY,KAAKmY,4BAGFnJ,QAAQ,CAAC,gBAAiB,oBAAqBhP,KAAKG,IAAIjD,IAAIY,UAC3DkC,KAAKG,IAAIjD,IAAIkW,UAAY,IAAMpT,KAAKG,IAAIjD,IAAIkb,WAC/CpY,KAAKqY,wBAAwB9B,GAI3BvH,QAAQ,CAAC,YAAa,cAAe,gBAAiB,iBAAkBhP,KAAKG,IAAIjD,IAAIY,WACvFkC,KAAKsY,uBACLtY,KAAKuY,0BAGNvY,KAAKG,IAAIqY,kBAGVL,0BAA2B,WACtBvd,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIjD,IAAIY,QAAS,qBAClDkC,KAAKyY,sBACLzY,KAAK0Y,0BAIPR,4BAA6B,WAC5BlY,KAAK2Y,2BACL3Y,KAAK4Y,wBACL5Y,KAAK6Y,mBACL7Y,KAAK8Y,2BACL9Y,KAAK+Y,sBACL/Y,KAAKgZ,kBACLhZ,KAAKiZ,2CACLjZ,KAAKkZ,mBACLlZ,KAAKmZ,YAGNR,yBAA0B,WACzB3Y,KAAKG,IAAIjD,IAAIgZ,gBAAkB5L,IAAItK,KAAKG,IAAIjD,IAAIgZ,gBAAiB,QAAYC,UAAU,mBAAqB,GAC5G,IAAIiD,EAAwBxe,OAAOgP,KAAK6C,UAAUzM,KAAKG,IAAIjD,IAAIY,QAAS,kBACvEkC,KAAKG,IAAIjD,IAAIhC,MACVme,EAAmBrZ,KAAKsZ,uBAE5B,IAAItZ,KAAKG,IAAIjD,IAAIgZ,gBAChB,GAAGlW,KAAKG,IAAIjD,IAAIK,UAAY8b,EAC3BrZ,KAAKG,IAAIvB,UAAU,kBAAmB,OAChC,CACNnB,IAAM8b,EAAcje,GAAG,iFAAkF,CACxG8d,EACApZ,KAAKG,IAAIjD,IAAIK,SACb8b,IAEDze,OAAO4R,MAAM+M,KAKhBX,sBAAuB,WACtB,IAAI7Y,EAAKC,KACJA,KAAKiY,yBACTnd,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAGgK,GAC/CxR,OAAOsI,MAAMsW,gBAAgBpN,GAC7BA,EAAKqN,SAAWrN,EAAK9C,MAEf8C,EAAKpE,KAAQjI,EAAGI,IAAIjD,IAAIkb,UAC7BhM,EAAKwI,OAAStK,KAAiB,EAAb8B,EAAK9C,KAAW6M,UAAU,SAAU/J,IAEtDA,EAAKwI,OAAStK,IAAI8B,EAAK9C,KAAO8C,EAAKpE,IAAKmO,UAAU,SAAU/J,IAG7DA,EAAKsN,WAAatN,EAAKwI,OACvBxI,EAAKuN,gBAAkB,EACvBvN,EAAKwN,aAAetP,IAAI8B,EAAKyN,gBAAkBzN,EAAK0N,WAEpD/Z,EAAGga,wBAAwB3N,EAAM,CAAC,kBAAmB,OAAQ,SAAU,WAAY,kBAKtF2N,wBAAyB,SAAS7c,EAAKsJ,GACtC,IAAIzG,EAAKC,KACTlF,EAAEqP,KAAK3D,EAAQ,SAASpE,EAAG4X,GAC1B9c,EAAI,QAAQ8c,GAAK1P,IAAIA,IAAIpN,EAAI8c,GAAI7D,UAAU6D,EAAG9c,IAAQ6C,EAAGI,IAAIjD,IAAIgZ,gBAAiBC,UAAU,QAAU6D,EAAG9c,OAI3G2b,iBAAkB,WACjB,IAAI9Y,EAAKC,KAETlF,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAG6X,GAC/CA,EAAIC,qBAAuB,GAC3B,IAAIC,EAAa,CAAC,QAAS,mCAC1B,8BAA+B,+BAC/B,gCAAiC,yCAEL,UAAzB3M,KAAKyM,EAAIG,cACVra,EAAGkY,yBAAyD,eAA9BlY,EAAGI,IAAIjD,IAAImd,mBAC3CF,EAAWvR,KAAK,cAGjB9N,EAAEqP,KAAKgQ,EAAY,SAAS/X,EAAGF,GAAa+X,EAAI/X,GAAa,KAExDlC,KAAKiY,yBAA2Bhb,UACpCA,QAAQqd,QAAQC,2BAA2BN,EAAInc,QAASmc,EAAI/e,MAC5D6E,EAAGya,uBAAuBP,IAE3Brf,OAAOsI,MAAMsW,gBAAgBS,MAI/BnB,yBAA0B,WACzB,IAAI/Y,EAAKC,KAELya,GAAoB,EACxB3f,EAAEqP,KAAKpK,EAAGI,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAG0F,GAC1C7I,KAAK6I,EAAI4S,0BAAyBD,GAAoB,KAEpC,GAAnBA,GAEH3f,EAAEqP,KAAKpK,EAAGI,IAAIjD,IAAW,OAAK,GAAI,SAASyd,EAAGvO,GAC7C,IAAIwO,EAAe7a,EAAG8a,oBAAoBzO,EAAK0O,eAC3CC,EAAyB,EAE7BjgB,EAAEqP,KAAKpK,EAAGI,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAG6X,GAC7CA,EAAIe,8BAAgCjb,EAAGkb,yBAAyBhB,EAAKW,GAGpEX,EAAIiB,sCADC,GAAH9Y,EAC0C,EAAI6X,EAAIe,8BAGnDjb,EAAGI,IAAIjD,IAAW,MAAEkF,EAAE,GAAG8Y,sCACzBjB,EAAIe,8BAGND,GAA0Bd,EAAIe,gCAG5BD,IAA2Bhb,EAAGkY,0BAChC7L,EAAKsN,WAAapP,IAAI8B,EAAKwI,QAAU,EAAImG,IACzC3O,EAAKqN,SAAWrN,EAAKpE,IAAMsC,IAAI8B,EAAKsN,WAAatN,EAAKpE,IAAKmO,UAAU,WAAY/J,IAAS,EAE1FrM,EAAGga,wBAAwB3N,EAAM,CAAC,WAAY,mBAKjD6O,yBAA0B,SAAShB,EAAKW,GAGvC,IAAIO,EAAuB,EAE3B,GAAGlc,KAAKgb,EAAIS,wBAAyB,CACpC,IAAIU,EAAWpb,KAAKqb,cAAcpB,EAAKW,GAEjB,gBAAnBX,EAAIG,YACNe,EAAwBC,EAAW,IAEP,0BAAnBnB,EAAIG,YACbe,EAAwBC,EAAW,IAClCpb,KAAKG,IAAIjD,IAAW,MAAE+B,KAAKgb,EAAIqB,QAAU,GAAGN,8BAEjB,yBAAnBf,EAAIG,cACbe,EAAwBC,EAAW,IAClCpb,KAAKG,IAAIjD,IAAW,MAAE+B,KAAKgb,EAAIqB,QAAU,GAAGJ,uCAO/C,OAHGjB,EAAIsB,iBACNJ,GAA+C,UAAtBlB,EAAIsB,gBAA+B,EAAM,GAE5DJ,GAGRE,cAAe,SAASpB,EAAKW,GAC5B,OAAgE,GAAxDpc,OAAOC,KAAKmc,GAAc9V,QAAQmV,EAAIuB,cAC7ClR,IAAIsQ,EAAaX,EAAIuB,cAAerF,UAAU,OAAQ8D,IAAQA,EAAI3Q,MAGpEyP,oBAAqB,WACpB,IAAIhZ,EAAKC,KACTA,KAAKG,IAAIjD,IAAIue,UAAYzb,KAAKG,IAAIjD,IAAIwe,MAAQ1b,KAAKG,IAAIjD,IAAIye,WAAa3b,KAAKG,IAAIjD,IAAI0e,UAAY5b,KAAKG,IAAIjD,IAAI2e,eAAiB,EAE/H/gB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAGgK,GAC/CrM,EAAGI,IAAIjD,IAAIwe,OAAStP,EAAKwI,OACzB7U,EAAGI,IAAIjD,IAAIue,WAAarP,EAAKpE,IAC7BjI,EAAGI,IAAIjD,IAAIye,YAAcvP,EAAK0P,YAC9B/b,EAAGI,IAAIjD,IAAI0e,WAAaxP,EAAKsN,WAC7B3Z,EAAGI,IAAIjD,IAAI2e,gBAAkBzP,EAAK2P,kBAGnCnhB,OAAOsI,MAAMsW,gBAAgBxZ,KAAKG,IAAIjD,IAAK,CAAC,QAAS,aAAc,YAAa,oBAGjF8b,gBAAiB,WAChB,IAAIjZ,EAAKC,KACTA,KAAKG,IAAIjD,IAAI8e,oBAAsB,EACnC,IAAIC,EAAkB,GAGtBnhB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAG6X,GACxB,UAAnBA,EAAIG,cACP6B,EAAgBhC,EAAIvE,KAAOpL,IAAI2P,EAAIiC,WAAY/F,UAAU,aAAc8D,OAIzEnf,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASyd,EAAGvO,GAC/C,IAAIwO,EAAe7a,EAAG8a,oBAAoBzO,EAAK0O,eAC/ChgB,EAAEqP,KAAKpK,EAAGI,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAG6X,GAE7C,IAAIkC,EAAqBpc,EAAGqc,uBAAuBhQ,EAAM6N,EAAKW,GAGvC,UAAnBX,EAAIG,cACP6B,EAAgBhC,EAAIvE,MAAQyG,EACxBxB,GAAK5a,EAAGI,IAAIjD,IAAW,MAAEyB,OAAS,IACrCwd,GAAsBF,EAAgBhC,EAAIvE,OAKrB,UAAnBuE,EAAIG,aACLra,EAAGkY,yBAAyD,eAA9BlY,EAAGI,IAAIjD,IAAImd,oBAC3CJ,EAAIiC,YAAcC,GAKnBlC,EAAIoC,4BAA8BF,EAGlClC,EAAIqC,kCAAoCH,EAGrClC,EAAIsC,WAGNJ,EAAsC,aAAhBlC,EAAIsC,SAA2B,EAAMJ,EAE3DA,GAA6C,UAAtBlC,EAAIsB,gBAA+B,EAAM,GAMhEtB,EAAIuC,6BADC,GAAHpa,EACiCkI,IAAI8B,EAAKsN,WAAayC,GAGxD7R,IAAIvK,EAAGI,IAAIjD,IAAW,MAAEkF,EAAE,GAAGoa,6BAA+BL,GAI1DxB,GAAK5a,EAAGI,IAAIjD,IAAW,MAAEyB,OAAS,IACrCoB,EAAG0c,iBAAiBxC,GAGpBla,EAAG2c,qBAAqBta,EAAG6X,GAE3Bla,EAAGga,wBAAwBE,EAC1B,CAAC,QAAS,aAAc,qCAGpB7X,GAAKrC,EAAGI,IAAIjD,IAAW,MAAEyB,OAAS,GAAMoB,EAAGkY,yBACZ,eAAhClY,EAAGI,IAAIjD,IAAImd,mBAAsCta,EAAGI,IAAIjD,IAAI6a,kBAC/DhY,EAAGI,IAAIjD,IAAI8e,oBAAsB1R,IAAIvK,EAAGI,IAAIjD,IAAIyf,YAC/CrS,IAAIvK,EAAGI,IAAIjD,IAAI6a,iBAAmBkC,EAAIyB,MAAOvF,UAAU,+BAO7DuG,qBAAsB,SAASE,EAAS3C,GACvC,IAAIiC,EAAajC,EAAIqC,iCACD,aAAhBrC,EAAIsC,WACPL,EAAa,GAGY,UAAtBjC,EAAIsB,iBAA8BW,IAAc,GAGnDjC,EAAIyB,MADO,GAATkB,EACUtS,IAAItK,KAAKG,IAAIjD,IAAI0e,UAAYM,EAAY/F,UAAU,QAAS8D,IAE5D3P,IAAItK,KAAKG,IAAIjD,IAAW,MAAE0f,EAAQ,GAAGlB,MAAQQ,EAAY/F,UAAU,QAAS8D,KAI1FY,oBAAqB,SAASC,GAC7B,OAAOA,EAAgB+B,KAAKC,MAAMhC,GAAiB,IAGpDsB,uBAAwB,SAAShQ,EAAM6N,EAAKW,GAC3C,IAAIQ,EAAWpb,KAAKqb,cAAcpB,EAAKW,GACnCuB,EAAqB,EAEzB,GAAsB,UAAnBlC,EAAIG,YAAyB,CAE/B,IAAI2C,EAASzS,IAAI2P,EAAIiC,WAAY/F,UAAU,aAAc8D,IACzDkC,EAAqBnc,KAAKG,IAAIjD,IAAI0e,UAC/BxP,EAAKsN,WAAa1Z,KAAKG,IAAIjD,IAAI0e,UAAamB,EAAU,MAE7B,gBAAnB9C,EAAIG,YACb+B,EAAsBf,EAAW,IAAShP,EAAKsN,WACnB,0BAAnBO,EAAIG,YACb+B,EAAsBf,EAAW,IAChCpb,KAAKG,IAAIjD,IAAW,MAAE+B,KAAKgb,EAAIqB,QAAU,GAAGe,4BAEjB,yBAAnBpC,EAAIG,cACb+B,EAAsBf,EAAW,IAChCpb,KAAKG,IAAIjD,IAAW,MAAE+B,KAAKgb,EAAIqB,QAAU,GAAGkB,8BAK9C,OAFAxc,KAAKgd,kBAAkB5Q,EAAM6N,EAAKmB,EAAUe,GAErCA,GAGRa,kBAAmB,SAAS5Q,EAAM6N,EAAKmB,EAAUe,GAEhDjY,IAAI+Y,EAAahD,EAAIC,qBACjBtU,EAAMwG,EAAKzI,WAAayI,EAAKZ,UAE7B0R,EAAuBf,EAAqBnc,KAAKG,IAAIjD,IAAIgZ,gBACzD+G,GAAcA,EAAWrX,KAC5BsX,GAAwBD,EAAWrX,GAAK,IAEzCqX,EAAWrX,GAAO,CAACwV,EAAU9Q,IAAI4S,EAAsB/G,UAAU,kBAAmB8D,MAGrFwC,iBAAkB,SAASxC,GAC1BA,EAAIiC,WAAa5R,IAAI2P,EAAIiC,WAAY/F,UAAU,aAAc8D,IAC7DA,EAAIqC,iCAAmChS,IAAI2P,EAAIqC,iCAAkCnG,UAAU,aAAc8D,KAG1GhB,yCAA0C,WAGzC,GAAIjZ,KAAKG,IAAIjD,IAAW,OAAK8C,KAAKG,IAAIjD,IAAW,MAAEyB,OAAQ,CAC1D,IAAIwe,GAAoB,EAIxB,GAHAriB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAIkgB,OAAS,GAAI,SAAShb,EAAGvE,GACzCoB,KAAKpB,EAAE6c,0BAAyByC,GAAoB,KAEpDA,EAAmB,CACtB,IAAIE,EARGrd,KAQWG,IAAIjD,IAAW,MAAE0Z,OAAO,GAAG,GACzC0G,EAA2B1iB,OAAOwF,MAAMmd,IAAIziB,EAAEiD,IAAIiC,KAAKG,IAAIjD,IAAIkgB,OAAS,GAC3E,SAASvf,GACR,IAAIA,EAAE6c,uBACL,OAAOpQ,IAAIzM,EAAEye,qCAIZkB,EAhBGxd,KAgBOG,IAAIjD,IAAIwe,MAAQ4B,EAC3BhT,IAAI+S,EAAS3B,MAAOvF,UAAU,gBAE5BqH,GAAQC,KAAKC,IAAIF,IAAU,EAAMC,KAAKE,IAAI,GAAIxH,UAAU,aAAckH,MAC1Erd,KAAKG,IAAIjD,IAAI8e,oBAAsB1R,IAAIA,IAAItK,KAAKG,IAAIjD,IAAI8e,qBAAuBwB,EAC9ErH,UAAU,4BAMf+C,iBAAkB,WAEjB,IAAInZ,EAAKC,KACL4d,EAAY5d,KAAKG,IAAIjD,IAAW,MAAI8C,KAAKG,IAAIjD,IAAW,MAAEyB,OAAS,EACvEqB,KAAKG,IAAIjD,IAAIyf,YAAcrS,IAAIsT,EAC5B5d,KAAKG,IAAIjD,IAAW,MAAE0gB,EAAY,GAAGlC,MAAQpR,IAAItK,KAAKG,IAAIjD,IAAI8e,qBAC9Dhc,KAAKG,IAAIjD,IAAI0e,WAEb5M,QAAQ,CAAC,YAAa,cAAe,gBAAiB,iBAAkBhP,KAAKG,IAAIjD,IAAIY,SACvFkC,KAAKG,IAAIjD,IAAI2gB,iBAAoB7d,KAAKG,IAAIjD,IAA2B,wBACpEoN,IAAItK,KAAKG,IAAIjD,IAAIyf,YAAc3c,KAAKG,IAAIjD,IAAIgZ,iBAAmBlW,KAAKG,IAAIjD,IAAI2e,gBAG7E7b,KAAKG,IAAIjD,IAAI4gB,wBAA0B9d,KAAKG,IAAIjD,IAAI6gB,2BAA6B,EAC9EH,IACF9iB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAG6X,GAC3CjL,QAAQ,CAAC,sBAAuB,SAAUiL,EAAIsC,YACxB,OAAtBtC,EAAIsB,eACNxb,EAAGI,IAAIjD,IAAI4gB,yBAA2BxT,IAAI2P,EAAIqC,kCAE9Cvc,EAAGI,IAAIjD,IAAI6gB,4BAA8BzT,IAAI2P,EAAIqC,qCAKpD1hB,OAAOsI,MAAMsW,gBAAgBxZ,KAAKG,IAAIjD,IACrC,CAAC,0BAA2B,gCAG9B8C,KAAKG,IAAIjD,IAAI2gB,iBAAmBvT,IAAKtK,KAAKG,IAAIjD,IAAI4gB,yBAA2B9d,KAAKG,IAAIjD,IAAI6gB,2BACzFzT,IAAItK,KAAKG,IAAIjD,IAAIyf,YAAc3c,KAAKG,IAAIjD,IAAIgZ,iBAAmBlW,KAAKG,IAAIjD,IAAI2e,gBAE7E7b,KAAK+Z,wBAAwB/Z,KAAKG,IAAIjD,IACrC,CAAC,0BAA2B,gCAG9B8C,KAAKG,IAAIjD,IAAI8gB,wBAA0B1T,IAAItK,KAAKG,IAAIjD,IAAIyf,YAAc3c,KAAKG,IAAIjD,IAAI0e,UAChFtR,IAAItK,KAAKG,IAAIjD,IAAI8e,qBAAsB7F,UAAU,4BAEpDnW,KAAK+Z,wBAAwB/Z,KAAKG,IAAIjD,IAAK,CAAC,0BAA2B,wBAGvEtC,OAAOsI,MAAMsW,gBAAgBxZ,KAAKG,IAAIjD,IAAK,CAAC,cAAe,qBAG3D8C,KAAKie,qBAGNA,kBAAmB,WAClB,IAAIC,EAAwB,EAO5B,GANGtjB,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIjD,IAAIY,QAAS,wBAAyBkC,KAAKG,IAAIjD,IAAIhC,MACvFgjB,EAAwBle,KAAKG,IAAIjD,IAAIghB,sBAC3BtjB,OAAOiR,aAAaqS,wBAC9BA,EAAwBtjB,OAAOiR,aAAaqS,uBAGzCjf,KAAKif,GAGR,OAFAle,KAAKG,IAAIjD,IAAIihB,cAAgB,OAC7Bne,KAAKG,IAAIjD,IAAIkhB,mBAAqB,GAIhCxjB,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIjD,IAAIY,QAAS,gBAAiBkC,KAAKG,IAAIjD,IAAIhC,QAC/E8E,KAAKG,IAAIjD,IAAIihB,cAAgBE,0CAA0Cre,KAAKG,IAAIjD,IAAIyf,YACnF3c,KAAKG,IAAIjD,IAAIK,SAAU4Y,UAAU,kBAClCnW,KAAKG,IAAIjD,IAAI8e,qBAAuB1R,IAAItK,KAAKG,IAAIjD,IAAIihB,cAAgBne,KAAKG,IAAIjD,IAAIyf,YACjFxG,UAAU,wBAEXnW,KAAK+Z,wBAAwB/Z,KAAKG,IAAIjD,IAAK,CAAC,sBAAuB,oBAIrEic,SAAU,WAWT,GAVAnZ,KAAKG,IAAIjD,IAAIohB,cAAgBte,KAAKG,IAAIjD,IAAIqhB,SAAW,GAElDve,KAAKG,IAAIjD,IAAW,OAAK8C,KAAKG,IAAIjD,IAAW,MAAEyB,SAC7C/D,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIjD,IAAW,MAAE,GAAGY,QAAS,kBAAmBkC,KAAKG,IAAIrC,UAC1FhD,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAGgK,UACxCA,EAAsB,mBAK7BpM,KAAKG,IAAIjD,IAAW,OAAK8C,KAAKG,IAAIjD,IAAW,MAAEyB,OAAQ,CACzD,IAAI6f,EAAmB,CAAC,8BAA+B,+BACtD,gCAAiC,yCAE9B5jB,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIjD,IAAW,MAAE,GAAGY,QAAS,mCAAoCkC,KAAKG,IAAIrC,UAC3G0gB,EAAiB5V,KAAK,oCAGvB9N,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAG6X,GAC/Cnf,EAAEqP,KAAKqU,EAAkB,SAASpc,EAAGF,UAC7B+X,EAAI/X,KAGZ+X,EAAIC,qBAAuB2C,KAAK4B,UAAUxE,EAAIC,0BAKjDzB,oBAAqB,WACjBzY,KAAKG,IAAIjD,IAAIwhB,iCACf1e,KAAKG,IAAIjD,IAAI6a,gBAAkBzN,IAAIA,IAAItK,KAAKG,IAAIjD,IAAItC,OAAO+jB,MAAM3e,KAAKG,IAAIjD,IAAImd,qBAC3Era,KAAKG,IAAIjD,IAAIwhB,+BAAiC,IAAKvI,UAAU,sBAIlEuC,sBAAuB,WACtB,IAAI3Y,EAAKC,KACL4e,EAAqB,EAGzB,GAFA5e,KAAKG,IAAIjD,IAAI2hB,qBAAuB,EAEhC7e,KAAKG,IAAIjD,IAAI6a,gBAAiB,CAC7B/X,KAAKG,IAAIjD,IAAImd,mBAChBzf,OAAO4R,MAAMlR,GAAG,oCAEjB0E,KAAKG,IAAIjD,IAAI2hB,qBAAuBvU,IAAItK,KAAKG,IAAIjD,IAAI6a,gBAAkB/X,KAAKG,IAAIjD,IAAIgZ,gBACnFC,UAAU,yBAEX,IAAI2I,EAA4B9e,KAAK+e,gCACjCnD,EAAY,EAEZkD,IACHhkB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAGgK,GAO/C,GANAwS,EAAqBtU,IAAIvK,EAAGI,IAAIjD,IAAI6a,iBAAmB3L,EAAKsN,WAAaoF,EACzE1S,EAAKsN,WAAapP,IAAI8B,EAAKsN,WAAakF,EACvCzI,UAAU,cAAe/J,IAC1BwP,GAAaxP,EAAKsN,cAGX3Z,EAAGI,IAAIjD,IAAIkgB,OAAS,IAAIze,QAAUmgB,GAA2B/e,EAAGI,IAAIjD,IAAI0e,WAA8C,aAAhC7b,EAAGI,IAAIjD,IAAImd,oBACnGjY,IAAMrC,EAAGI,IAAIjD,IAAIwM,OAAS,IAAI/K,OAAS,EAAG,CAC9C,IAAIqgB,EAAuB1U,IAAIvK,EAAGI,IAAIjD,IAAI0e,UAAYA,EACnD7b,EAAGI,IAAIjD,IAAI6a,gBAAiB5B,UAAU,cACzC/J,EAAKsN,WAAapP,IAAI8B,EAAKsN,WAAasF,EACvC7I,UAAU,aAAc/J,IAE1BA,EAAKqN,SAAWrN,EAAKpE,IAAMsC,IAAI8B,EAAKsN,WAAatN,EAAKpE,IAAKmO,UAAU,WAAY/J,IAAS,EAC1FrM,EAAGga,wBAAwB3N,EAAM,CAAC,WAAY,iBAG/CpM,KAAKiY,yBAA0B,EAC/BjY,KAAKkY,iCAKR6G,8BAA+B,WAC9B,GAAqC,aAAlC/e,KAAKG,IAAIjD,IAAImd,kBACf,OAAOra,KAAKG,IAAIjD,IAAI0e,UAEpB,IAAIqD,EAAmB,EACnBC,EAAoB,GAiBxB,OAfApkB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAG6X,GAC/C,GAAuB,UAAnBA,EAAIG,YAAyB,CAChC,IAAI8B,EAA8B,aAAhBjC,EAAIsC,SAA2B,EAAMtC,EAAIiC,WAC3DA,GAAqC,UAAtBjC,EAAIsB,gBAA+B,EAAM,EACxD2D,EAAkBjF,EAAIvE,KAAOwG,OACvB,GAAsC,OAAlCgD,EAAkBjF,EAAIqB,QAAkB,CAClD,IAAI6D,EAAoB7U,IAAI4U,EAAkBjF,EAAIqB,SAAWhR,IAAI2P,EAAI3Q,MAAQ,IAC7E4V,EAAkBjF,EAAIvE,KAAOyJ,KAI/BrkB,EAAEqP,KAAK+U,EAAmB,SAAStZ,EAAKjB,GACnCA,IAAOsa,GAAoBta,KAGzB2F,IAAItK,KAAKG,IAAIjD,IAAIyf,YAAcsC,EAAkB9I,UAAU,iBAIpEkC,wBAAyB,SAAS9B,GACjC,IAAI6I,EAAyBxkB,OAAOwF,MAAMmd,IAAIziB,EAAEiD,IAAIiC,KAAKG,IAAIjD,IAAc,UAAK,GAAI,SAASmiB,GAC5F,OAAO/U,IAAI+U,EAAIC,iBAAkBnJ,UAAU,mBAAoBkJ,OAEhErf,KAAKG,IAAIjD,IAAIqiB,cAAgBjV,IAAI8U,EAAwBjJ,UAAU,kBAEnEnW,KAAK+W,6BAA6BR,IAGnCQ,6BAA8B,SAASR,GAQtC,GAJ2B,iBAAxBvW,KAAKG,IAAIjD,IAAIY,SAA8BkC,KAAKG,IAAIjD,IAAIkb,WAC1DpY,KAAKwf,0BAGHxf,KAAKG,IAAIjD,IAAIkb,WAAapY,KAAKG,IAAIjD,IAAIkW,UAAY,KAEtDxY,OAAOsI,MAAMsW,gBAAgBxZ,KAAKG,IAAIjD,IAAK,CAAC,cAAe,gBAAiB,qBAEzE8R,QAAQ,CAAC,gBAAiB,oBAAqBhP,KAAKG,IAAIjD,IAAIY,UAAU,CACxE,IAAI6e,EAAc3c,KAAKG,IAAIjD,IAAIihB,eAAiBne,KAAKG,IAAIjD,IAAIyf,YAE7D,GAAG3c,KAAKG,IAAIjD,IAAIuiB,wBAA0Bzf,KAAKG,IAAIjD,IAAIK,SACtD,IAAImiB,EAAsBpV,IAAKqS,EAAc3c,KAAKG,IAAIjD,IAAIqiB,cACvDvf,KAAKG,IAAIjD,IAAIuZ,iBAAmBN,UAAU,qBAEzCuJ,EAAsBpV,IACxBA,IAAIqS,EAAY3c,KAAKG,IAAIjD,IAAIgZ,gBAAiBC,UAAU,gBACtDnW,KAAKG,IAAIjD,IAAIqiB,cAAgBvf,KAAKG,IAAIjD,IAAI4Z,sBAC7CX,UAAU,qBAYZ,GARAvb,OAAOsI,MAAMsW,gBAAgBxZ,KAAKG,IAAIjD,IAAK,CAAC,gBAC5C8C,KAAK+Z,wBAAwB/Z,KAAKG,IAAIjD,IAAK,CAAC,gBAEzC8C,KAAKG,IAAIkC,gBACXrC,KAAKG,IAAIkC,cAAc,eACvBrC,KAAKG,IAAIkC,cAAc,qBAGG,iBAAxBrC,KAAKG,IAAIjD,IAAIY,QAA4B,CAC3CoG,IAAIyb,EAA4B3f,KAAKG,IAAIjD,IAAI0iB,uBAAyB5f,KAAKG,IAAIjD,IAAI2iB,eAChFvV,IAAIoV,EAAsB1f,KAAKG,IAAIjD,IAAI2iB,eAAgB1J,UAAU,qBACjEuJ,EACH1f,KAAK8f,oBAAoBH,EAA0BpJ,GACnDvW,KAAKwf,wBAENxf,KAAK+f,0BAEL,IAAIpK,EAAe3V,KAAKG,IAAIjD,IAAIuiB,wBAA0Bzf,KAAKG,IAAIjD,IAAIK,SACtEyC,KAAKG,IAAIjD,IAAIyY,YAAc3V,KAAKG,IAAIjD,IAAI8iB,iBACzChgB,KAAKG,IAAIjD,IAAIqY,mBAAsBjL,IAAIoV,EAAsBpV,IAAIqL,GAChErL,IAAItK,KAAKG,IAAIjD,IAAImY,cAAgBrV,KAAKG,IAAIjD,IAAIgZ,iBAAkBC,UAAU,yBAI7E2J,oBAAqB,SAASJ,EAAqBnJ,GAClD,IAAIxW,EAAKC,KACLigB,GAAiB,EAClBjgB,KAAKG,IAAIjD,IAAIgjB,cAAgChV,IAArBqL,GAAkCA,IAC5Dzb,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAc,UAAK,GAAI,SAAS0H,EAAOwB,GACnDA,EAAKa,SAAWgZ,GAAkBP,EAAsB,GAC1DtZ,EAAK0V,YAAcxR,IAAIoV,EAAqBvJ,UAAU,gBACtD/P,EAAKwO,OAAStK,IAAIoV,EAAsB3f,EAAGI,IAAIjD,IAAIgZ,gBAAiBC,UAAU,WAC9E8J,GAAiB,GACTlgB,EAAGI,IAAIjD,IAAIyY,cACnBvP,EAAKwO,OAAS,MAMlB4K,sBAAuB,WACtB,IAAIzf,EAAKC,KACL2V,EAAc,EACdqK,EAAmB,EACpBhgB,KAAKG,IAAIjD,IAAIgjB,OACfplB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAc,UAAK,GAAI,SAAS0H,EAAOwB,GACtDA,EAAK0V,YAAcxR,IAAIlE,EAAKwO,OAAS7U,EAAGI,IAAIjD,IAAIgZ,gBAAiBC,UAAU,gBAC3ER,GAAevP,EAAKwO,OACpBoL,GAAoB5Z,EAAK0V,cAEhB9b,KAAKG,IAAIjD,IAAIkb,YACvBpY,KAAKG,IAAIjD,IAAI+W,SAAW,IAErBjU,KAAKG,IAAIjD,IAAI0iB,uBAAyB5f,KAAKG,IAAIjD,IAAI2iB,iBACtDG,GAAoBhgB,KAAKG,IAAIjD,IAAI2iB,eACjClK,GAAerL,IAAItK,KAAKG,IAAIjD,IAAI2iB,eAAiB9f,EAAGI,IAAIjD,IAAIgZ,gBAAiBC,UAAU,iBAGxFnW,KAAKG,IAAIjD,IAAIyY,YAAcrL,IAAIqL,EAAaQ,UAAU,gBACtDnW,KAAKG,IAAIjD,IAAI8iB,iBAAmB1V,IAAI0V,EAAkB7J,UAAU,sBAGjE4J,wBAAyB,WAGxB,GAFA/f,KAAKG,IAAIjD,IAAImY,cAAgB,EAC7BrV,KAAKG,IAAIjD,IAAIijB,mBAAqB,EACP,iBAAxBngB,KAAKG,IAAIjD,IAAIY,SACZkC,KAAKG,IAAIjD,IAAIyY,YAAc3V,KAAKG,IAAIjD,IAAIyf,cAAgB3c,KAAKG,IAAIjD,IAAIkb,UAAW,CAEnF,IAAIgI,EAAgBtlB,EAAEiD,IAAIiC,KAAKG,IAAIjD,IAAI+W,SAAU,SAASpW,GAAK,OAAOA,EAAE6M,OACxE,GAAIsE,QAAQoR,EAAe,QAAS,CACnC,IAAIzD,EAAc3c,KAAKG,IAAIjD,IAAIihB,eAAiBne,KAAKG,IAAIjD,IAAIyf,YACzDkB,EAAmB7d,KAAKG,IAAIjD,IAAIkhB,oBAAsBpe,KAAKG,IAAIjD,IAAI2gB,iBAEvE7d,KAAKG,IAAIjD,IAAImY,cAAgB/K,IAAItK,KAAKG,IAAIjD,IAAIyY,YAAcgH,EAC3D3c,KAAKG,IAAIjD,IAAIuZ,iBAAkBN,UAAU,kBAE1CnW,KAAKG,IAAIjD,IAAIijB,mBAAqB7V,IAAItK,KAAKG,IAAIjD,IAAI8iB,iBAClDnC,EAAmB7d,KAAKG,IAAIjD,IAAI4Z,sBAChCX,UAAU,0BAKdc,2BAA4B,WACxBjX,KAAKG,IAAIjD,IAAIyY,YAAc3V,KAAKG,IAAIjD,IAAIyf,aAC1C3c,KAAKG,IAAIjD,IAAIuZ,iBAAmBnM,IAAItK,KAAKG,IAAIjD,IAAIyf,YAAc3c,KAAKG,IAAIjD,IAAIyY,YACzE3V,KAAKG,IAAIjD,IAAImY,cAAec,UAAU,qBAEzCnW,KAAKG,IAAIjD,IAAI4Z,sBAAwBxM,IAAItK,KAAKG,IAAIjD,IAAIuZ,iBAAmBzW,KAAKG,IAAIjD,IAAIgZ,gBACrFC,UAAU,2BAEXnW,KAAKG,IAAIjD,IAAIyY,YAAc,EAE5B3V,KAAK+W,8BAA6B,MCnrBpCja,QAAQujB,sBAAwBvjB,QAAQsa,iBAAiB5b,OAAO,CAC/D2S,MAAO,WACNnO,KAAKsgB,SACL1lB,OAAO2lB,MAAMC,0BAA2B,EACxC5lB,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIrC,QAAU,QAAS,OAAQ,SAASqC,EAAK6N,EAAKC,GACxE,IAAI7B,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,GAC3BwS,EAAmB7lB,OAAOgP,KAAK8W,UAAU1S,EAAK,eAElDpT,OAAOsI,MAAMsW,gBAAgBpN,EAAM,CAAC,OAAQ,oBAEzCA,EAAKmL,gBACJnL,EAAK9C,KAAO8C,EAAKmL,iBAAmBkJ,GAGtCrU,EAAK0L,oBAAsB,EAC3B1L,EAAKsL,YAAc,SACnBtL,EAAKwL,sBAAwBtN,IAAI8B,EAAK9C,KAAO8C,EAAKmL,gBACjDpB,UAAU,wBAAyB/J,IACpCA,EAAKuL,iBAAmBvL,EAAK9C,OAE7B8C,EAAK0L,oBAAsBxN,IAA6C,KAAxC,EAAI8B,EAAK9C,KAAO8C,EAAKmL,iBACpDpB,UAAU,sBAAuB/J,IAClCA,EAAK2L,gBAAkBzN,IAAI8B,EAAKmL,iBAAmBjN,IAAI8B,EAAK9C,MAC5D8C,EAAKsL,YAAc,GACnBtL,EAAKwL,sBAAwB,EAC7BxL,EAAKuL,iBAAmB,IAGzBvL,EAAK0L,oBAAsB,EAC3B1L,EAAKsL,YAAc,GACnBtL,EAAKwL,sBAAwB,EAC7BxL,EAAKuL,iBAAmB,GAEzBvL,EAAKyL,sBAAwBzL,EAAKuL,iBAAmBrN,IAAInK,EAAIjD,IAAIgZ,iBAEjEjZ,QAAQqd,QAAQqG,iBAAiBvU,GACjCnP,QAAQqd,QAAQtC,+BAMjBpd,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIma,QAAQsG,UAAW,OAAQ,SAASzgB,EAAK6N,EAAKC,GACxEhR,QAAQqd,QAAQtC,+BAGjBpd,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIma,QAAQsG,UAAW,aAAc,SAASzgB,EAAK6N,EAAKC,GAC9EhR,QAAQqd,QAAQtC,+BAGjBpd,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIma,QAAQsG,UAAW,SAAU,SAASzgB,EAAK6N,EAAKC,GAC1EhR,QAAQqd,QAAQtC,+BAGjBpd,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIma,QAAQsG,UAAW,yBAA0B,SAASzgB,EAAK6N,EAAKC,GAC1FhR,QAAQqd,QAAQuG,qBAChB5jB,QAAQqd,QAAQtC,+BAGjBpd,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIrC,QAAS,oBAAqB,SAASqC,GAC9DA,EAAIjD,IAAIwhB,+BACVve,EAAIgI,QAAQ,kCAEZlL,QAAQqd,QAAQtC,+BAIlBpd,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIrC,QAAS,iCAAkC,SAASqC,GAC9E,GAAIA,EAAIjD,IAAImd,kBAAZ,CAKAla,EAAI2gB,yBAA0B,EAE3B3gB,EAAIjD,IAAIwhB,gCAAkCve,EAAIjD,IAAI6a,kBAEpD5X,EAAIjD,IAAI6a,gBAAkB,EAC1B5X,EAAIma,QAAQtC,8BAGb,IAAI0D,EAAQpR,IAAInK,EAAIjD,IAAItC,OAAOsI,MAAMyb,MAAMxe,EAAIjD,IAAImd,qBAC/CtC,EAAkBzN,IAAIoR,EAAMpR,IAAInK,EAAIjD,IAAIwhB,gCAAkC,IAC7EvI,UAAU,oBAEXhW,EAAIvB,UAAU,kBAAmBmZ,GAC/B3P,8BAAkBjI,EAAI2gB,+BAjBvBlmB,OAAO6P,SAASnP,GAAG,gDAoBrBV,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIrC,QAAS,kBAAmB,SAASqC,GAC/DA,EAAIma,QAAQuG,qBAEP1gB,EAAI2gB,0BACR3gB,EAAIjD,IAAIwhB,+BAAiC,GAG1Cve,EAAIma,QAAQtC,+BAGbpd,OAAOiL,GAAGC,KAAK7F,GAAGD,KAAKG,IAAIrC,QAAU,QAAS,CAC7CijB,UAAW,SAAS5gB,EAAK6N,EAAKC,GAC7B,IAAI7B,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,IAC3B7B,EAAKhF,WAAajH,EAAIjD,IAAI8jB,gBAC7B5U,EAAKhF,UAAYjH,EAAIjD,IAAI8jB,kBAK5B,IAAIjhB,EAAKC,KACNA,KAAKG,IAAIjC,YAAmB,MAAE2K,KAAKoY,UAAU,aAC/CjhB,KAAKG,IAAIwN,UAAU,WAAY,QAAS,SAASzQ,EAAK8Q,EAAKC,GAC1D,OAAOlO,EAAGmhB,oBAAoBhkB,EAAK8Q,EAAKC,KAKzCjO,KAAKG,IAAIiT,UAAY,GAClBpT,KAAKG,IAAIjC,YAAoC,wBAC7C8B,KAAKG,IAAIjC,YAA8B,kBACvC8B,KAAKG,IAAIjD,IAAIikB,yBACZnhB,KAAKG,IAAIjD,IAAIkkB,iBAAiBziB,QAElCqB,KAAKG,IAAIgI,QAAQ,0BAGfnI,KAAKG,IAAIjC,YAAmB,QAC9B8B,KAAmB,aAAIA,KAAKgY,4BAG1BhY,KAAKG,IAAIjC,YAAmB,QAC9B8B,KAAmB,aAAIA,KAAKqhB,sBAG1BrhB,KAAKG,IAAIjC,YAAoC,wBAC/C8B,KAAKG,IAAIwN,UAAU,yBAA0B,SAASzQ,GACrD,MAAM,CACLwK,QAAS,CACR,CAAC,eAAgB,WAAY,IAAKzK,QAAQa,aAM3CkC,KAAKG,IAAIjC,YAA4B,gBACvC8B,KAAKG,IAAIwN,UAAU,iBAAkB,SAASzQ,GAC7C,IAAIwK,EAAU,CACb0L,UAAa,EACbgF,UAAa,EACbpb,QAAWE,EAAIF,SAKhB,OAHI+C,EAAGI,IAAIjC,YAAsB,UAAKhB,EAAIgP,WAAUxE,EAAkB,SAAIxK,EAAIgP,UAC1EnM,EAAGI,IAAIjC,YAAsB,UAAKhB,EAAIiP,WAAUzE,EAAkB,SAAIxK,EAAIiP,UAEvE,CACNzE,QAASA,KAKT9M,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIjD,IAAIY,QAAS,kBACjDkC,KAAKG,IAAImhB,wBAAwB,eAAgB,SAASpkB,GACzD,OAAQA,EAAgB,aAAI,QAAU,SAIzCgW,OAAQ,sBACHnT,EAAKC,KAET,GAAGA,KAAKG,IAAIjD,IAAImB,UAAW,CAC1B,IAAId,EAAW3C,OAAO0J,SAASid,iBAAiB,YAE5C3iB,WAAasD,EAAWyC,GAC3B,GAAG5E,EAAGI,IAAIjC,YAAYgE,KAAenC,EAAGI,IAAIjD,IAAIgF,GAC/C,OAAOnC,EAAGI,IAAIvB,UAAUsD,EAAWyC,IAIrC,OAAO/J,OAAO0W,aAAa,mBACpB1S,EAAU,WAAYrB,sBACtBqB,EAAU,sBAAuBrB,sBACjCqB,EAAU,SAAU,4BACpBA,EAAU,mBAAoB,kBAEhCoB,EAAKG,IAAIjD,IAAIF,UAAYgD,EAAKG,IAAIjD,IAAIskB,cACxCxhB,EAAKG,IAAIgI,QAAQ,gBAOtBiQ,UAAW,YACNpY,KAAKG,IAAIjD,IAAIkb,WAAapY,KAAKG,IAAIjD,IAAIukB,gBAC1CzhB,KAAKG,IAAIvB,UAAU,iBAAkB,KAIvC8iB,yBAA0B,WACzB,GAAI1S,QAAQ,CAAC,gBAAiB,gBAAiB,mBAAoB,oBAAqBhP,KAAKG,IAAIjD,IAAIY,SAArG,CAGA,IAAIiC,EAAKC,KACL2hB,EAAkB3S,QAAQ,CAAC,mBAAoB,oBAAqBhP,KAAKG,IAAIjD,IAAIY,SAClF,WAAa,WAEekC,KAAKG,IAAI0J,aAAa,QAAS,sBACrC+X,8BAAgC,SAAS9Z,GACjE,IAAG/H,EAAGI,IAAIqR,SACV,MAAO,CACNmQ,gBAAmBA,EACnBE,eAAkB9hB,EAAGI,IAAIjD,IAAIY,QAC7BgkB,eAAkB/hB,EAAGI,IAAIjD,IAAIhC,KAC7ByI,UAAamE,EAAI5K,IAAIyG,UACrBoe,YAAeja,EAAI5K,IAAI6kB,YACvBC,eAAkBla,EAAI5K,IAAIqC,UAAYuI,EAAI5K,IAAIqC,UAAU0iB,MAAM,MAAM,GAAK,KACzEC,SAAYpa,EAAI5K,IAAIglB,WAItBliB,KAAKG,IAAIwN,UAAU,qBAAsB,QAAS,SAASzQ,EAAK8Q,EAAKC,GACpE,IAAIpQ,EAAIa,OAAOsP,GAAKC,GACpB,MAAO,CACNvG,QAAS,CACR0L,UAAW,EACXuO,gBAAiBA,EACjBG,eAAgB5kB,EAAIhC,KACpByI,UAAW9F,EAAE8F,gBAMjBwe,qBAAsB,WACrB,IAAIpiB,EAAKC,KACHoiB,EAAwBpT,QAAQ,CAAC,cAAe,iBAAkBhP,KAAKG,IAAIjD,IAAIY,SAClF,SAAW,UAEdlD,OAAO6H,KAAK,CACXC,OAAO,gFACPC,KAAM,CACLZ,GAAIhC,EAAGI,IAAIjD,IAAIY,QACfkE,GAAIjC,EAAGI,IAAIjD,IAAIhC,KACfmnB,aAActiB,EAAGI,IAAIjD,IAAIolB,cACzBF,qBAAsBA,EACtB3gB,WAAoC,WAAxB2gB,EAAoC,WAAa,WAC7DxR,MAA+B,WAAxBwR,EAAoCriB,EAAGI,IAAIjD,IAAIiP,SAAWpM,EAAGI,IAAIjD,IAAIgP,UAE7E1J,SAAU,SAASK,GAClB,IAAIA,EAAEgI,IAAI,CACCjQ,OAAOsI,MAAMC,KAAKN,EAAEO,SAC9BxI,OAAOyI,UAAU,OAAQR,EAAEO,QAAQtF,QAAS+E,EAAEO,QAAQlI,WAM1DqnB,mBAAoB,uBAChBviB,KAAKG,IAAIjD,IAAImB,YAAe2B,KAAKG,IAAIjD,IAAIkgB,OAAS,IAAIze,QACnDqB,KAAKG,IAAIjD,IAAIoD,UAAWN,KAAKG,IAAIjD,IAAIoD,SAASkiB,mBAE1CxiB,KAAKG,IAAIjD,IAAImB,WAAa2B,KAAKG,IAAIjD,IAAIF,SAAWgD,KAAKG,IAAIjD,IAAW,QAC3E8C,KAAKG,IAAIjD,IAAIgjB,QACjBtlB,OAAO6nB,6BAAiBziB,EAAKgY,+BAH7Bpd,OAAO6nB,6BAAiBziB,EAAK0iB,wBAK3B9nB,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIjD,IAAIY,QAAU,QAAS,eAC3DkC,KAAK2iB,sBACL3iB,KAAKG,IAAI8gB,UAAU,SAASpY,KAAK+Z,iBAAiB,YAAa,SAIjE9Z,QAAS,WACRhM,QAAQmB,uBACRnB,QAAQwB,eACR0B,KAAK6gB,qBACL7gB,KAAK6iB,YACL7iB,KAAK0hB,2BACL1hB,KAAKG,IAAIjC,YAA0B,cAAK8B,KAAKG,IAAIjC,YAA0B,aAAEU,UAAU,IACvFoB,KAAKG,IAAIjC,YAA0B,cAAK8B,KAAKG,IAAIjC,YAA0B,aAAE4kB,oBAAoB,KAGlGC,aAAc,sBACTC,EAAqBhjB,KAAKG,IAAIjC,YAA0B,aAwD5D,OA9CG8B,KAAKG,IAAIjD,IAAI6lB,cACfnoB,OAAO6H,KAAK,CACXC,OAAQ,4FACRC,KAAM,CAAEsgB,aAAcjjB,KAAKG,IAAIjD,IAAI6lB,gBACjC3a,cAAKvF,GACPpF,IAAM2I,EAAOvD,GAAKA,EAAEO,QACpB,GAAKgD,GAAqC,IAA7B5H,OAAOC,KAAK2H,GAAMzH,OAA/B,CAKAuF,IAnB8BwR,EAAKwN,EAmB/BC,EAAWnjB,EAAKG,IAAIjC,YAAYwL,MAAMb,KAEtCua,EAAgB,KACdC,EAAoBrjB,EAAKG,IAAIjD,IAAIwM,MAAM8K,cAAK3W,UAAKA,EAAE8F,YAAcyC,EAAKzC,YACtE2f,EAAiBtjB,EAAKG,IAAIjD,IAAIwM,MAAM8K,cAAK3W,UAAMA,EAAE8F,YAEnD0f,EACHD,EAAgBC,EACNC,IACVF,EAAgBE,GAGZF,IAEJA,EAAgBxoB,OAAOsI,MAAMyO,UAAU3R,EAAKG,IAAIjD,IAAKimB,EAASrlB,QAAS,UAjC1C4X,EAoCb0N,EAAc1N,cApCIwN,EAoCCE,EAAczf,eApCP,MACxCuf,EACHF,EAAmBF,oBAAoBxnB,GAAG,+BAAgC,CAACoa,KAE3EsN,EAAmBF,oBAAoBxnB,GAAG,uBAAwB,CAACoa,KAkCnE1V,EAAKG,IAAIojB,cAAe,EACxB3oB,OAAOsI,MAAMtE,UAAUwkB,EAActlB,QAASslB,EAAcloB,KAAM,CACjEyI,UAAWyC,EAAKzC,UAChBqE,KAAMob,EAAcpb,KAAO,GAAK,IAGjC,CAAC,YAAa,WAAY,WAAWvH,iBAAQ+iB,GACxCpd,EAAKod,IAAU5oB,OAAOgP,KAAK8W,UAAU0C,EAActlB,QAAS0lB,IAC/D5oB,OAAOsI,MAAMtE,UAAUwkB,EAActlB,QACpCslB,EAAcloB,KAAMsoB,EAAOpd,EAAKod,MAInCR,EAAmBpkB,UAAU,SApC5BokB,EAAmBF,oBAAoBxnB,GAAG,0CAuCtC,GAGRonB,oBAAqB,WACpB,IAAI3iB,EAAKC,KACLyjB,EAA0B7oB,OAAOgP,KAAKC,aAAa9J,EAAGI,IAAIjD,IAAIY,QAAS,oBAC1EiC,EAAGI,IAAIjD,IAAIhC,MAEZ,GAAK8E,KAAKG,IAAIjD,IAAIwmB,oBAAqB1jB,KAAKG,IAAIjD,IAAIkgB,MAIpD,OAAIqG,EACI7oB,OAAO6H,KAAK,CAClBC,OAAQ,wEACRC,KAAM,CACLghB,eAAkBF,EAAwBze,QAC1C4e,aAAgB7jB,EAAGI,IAAIjD,IAAIwmB,kBAC3B1mB,QAAW+C,EAAGI,IAAIjD,IAAIF,SAEvBwF,SAAU,SAASK,IACdA,EAAEgI,KAAOhI,EAAEO,SACdxI,OAAO0W,aAAa,YAGfzO,EAAEO,QAAQsgB,oBACZ3jB,EAAGI,IAAIjD,IAAIwmB,kBAAoB7gB,EAAEO,QAAQsgB,mBAIvC7gB,EAAEO,QAAQga,OACZrd,EAAGI,IAAIvB,UAAU,QAASiE,EAAEO,QAAQga,0BAGhCrd,EAAG8gB,wCACH9gB,EAAGiY,wCAvBd,GA+BD6K,UAAW,WACV,IAAI9iB,EAAKC,KAEmB,IAAzBA,KAAKG,IAAIjD,IAAIkW,WAAkBpE,QAAQ,CAAC,OAAQ,UAAW,UAAWhP,KAAKG,IAAIjD,IAAI2mB,SADtE,CAAC,mBAAoB,OAEtB5e,SAASjF,KAAKG,IAAIrC,UAChCkC,KAAKG,IAAI2jB,KAAKC,cAAczoB,GAAG,YAAa,WAAayE,EAAGikB,cAI9DA,SAAU,WACK,IAAIlnB,QAAQoR,WAAWlO,KAAKG,IAAIjD,MAG/C+mB,QAAS,SAAS/mB,EAAK8Q,EAAKC,GAC3B,IAAIpQ,EAAIa,OAAOsP,GAAKC,GACN,IAAXpQ,EAAEomB,SAA0B,MAAXpmB,EAAEomB,UAErBpmB,EAAE8F,UAAY,IAGf3D,KAAKG,IAAIojB,cAAe,EACxBvjB,KAAK2D,UAAUzG,EAAK8Q,EAAKC,IAG1BtK,UAAW,SAASzG,EAAK8Q,EAAKC,GAC7B,IAAIlO,EAAKC,KACLoM,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,GAC3BiW,EAAe,EAAGC,EAAoB,EAe1C,GAdG,CAAC,iBAAiBlf,SAASjF,KAAKG,IAAIjD,IAAIY,UAC1ComB,EAAejlB,KAAKc,EAAGI,IAAIjD,IAAIgnB,cAC/BC,EAAoBD,IAEe,qBAAzBlkB,KAAKG,IAAIjD,IAAIY,SAAkCiC,EAAGI,IAAIjD,IAAIkb,WAC3C,kBAAzBpY,KAAKG,IAAIjD,IAAIY,WACbqmB,EAAoB,GAGjBnkB,KAAKG,IAAIojB,eACZnX,EAAK6X,QAAU,MAGhBjkB,KAAKG,IAAIojB,cAAe,EACrBnX,EAAKzI,WAAayI,EAAK6X,SAAW7X,EAAK7M,UAAW,CACpD,GAAIS,KAAKokB,6BAGR,OAAOpkB,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,kDACR2hB,MAAOjY,EACPzJ,KAAM,CACLzF,IAAK6C,EAAGI,IAAIjD,IACZyF,KAAM,CACLgB,UAAWyI,EAAKzI,UAChBsgB,QAAS7X,EAAK6X,QACd1kB,UAAW6M,EAAK7M,UAChByhB,cAAejhB,EAAGI,IAAIjD,IAAI8jB,cAC1B5Z,UAAWgF,EAAKhF,UAChB8E,SAAUnM,EAAGI,IAAIjD,IAAIgP,UAAYnM,EAAGI,IAAIjD,IAAIgS,WAC5CyB,aAAc5Q,EAAGI,IAAIjD,IAAIyT,aACzBxE,SAAUpM,EAAGI,IAAIjD,IAAIiP,SACrB5O,SAAUwC,EAAGI,IAAIjD,IAAIK,SACrB2mB,aAAcA,EACdhO,gBAAiBnW,EAAGI,IAAIjD,IAAIgZ,gBAC5BrF,WAAY9Q,EAAGI,IAAIjD,IAAI4T,oBAAsB/Q,EAAGI,IAAIjD,IAAI8T,kBACxDsT,oBAAqBvkB,EAAGI,IAAIjD,IAAIonB,oBAChCC,oBAAqBxkB,EAAGI,IAAIjD,IAAIqnB,oBAChCvnB,QAAS+C,EAAGI,IAAIjD,IAAIF,QACpBwnB,WAAYzkB,EAAGI,IAAIjD,IAAIsnB,WACvBtE,OAAQjhB,KAAKc,EAAGI,IAAIjD,IAAIgjB,QACxBuE,iBAAkB1kB,EAAGI,IAAIjD,IAAIunB,iBAC7BvT,iBAAkBnR,EAAGI,IAAIjD,IAAIgU,kBAAoBnR,EAAGI,IAAIjD,IAAI+T,aAC5DyT,oBAAqB3kB,EAAGI,IAAIjD,IAAIwnB,oBAChC5mB,QAASiC,EAAGI,IAAIjD,IAAIY,QACpB5C,KAAM6E,EAAGI,IAAIjD,IAAIhC,KACjBypB,QAASvY,EAAKuY,SAAW5kB,EAAGI,IAAIjD,IAAIynB,QACpC3c,IAAKoE,EAAKpE,KAAO,EACjB8R,UAAW1N,EAAK0N,UAChB8K,kBAAmBxY,EAAKwY,kBACxB/K,gBAAiBzN,EAAKyN,gBACtBgL,WAAYzY,EAAKyY,WACjBC,IAAM1Y,EAAK0Y,IACXC,aAAc3Y,EAAK2Y,aACnBC,UAAW5Y,EAAK4Y,UAChBC,YAAmC,iBAAtBllB,EAAGI,IAAIjD,IAAIY,QAA6BiC,EAAGI,IAAIjD,IAAI+nB,YAAc,GAC9EC,YAAa9Y,EAAK8Y,YAClB9S,aAAcrS,EAAGI,IAAIjD,IAAIkV,aACzB+S,kBAAmB/Y,EAAK+Y,kBACxB7c,cAAe8D,EAAKlR,OAItBsH,SAAU,SAASK,GACdA,EAAEgI,KACLjQ,OAAO0W,aAAa,YAElB,IAAIzT,EAAIa,OAAOsP,GAAKC,GACpBlO,EAAGqlB,iCAAiCvnB,EAAEid,kCAEjC/a,EAAGI,IAAI+H,eAAeC,QAAQ,kBAAmB6F,EAAKC,sBACtDlO,EAAGslB,yBAAyBjZ,eAEjC,GAAG+X,IAAsBvpB,OAAO2lB,MAAMC,yBAA0B,CAC/D,IAAI3iB,EAAIa,OAAOsP,GAAKC,GACpBnT,EAAEqP,KAAKtH,EAAEO,QAAS,SAASkiB,EAAGjV,GACzBxS,EAAEynB,KAAIznB,EAAEynB,GAAKjV,KAGlBvT,QAAQoD,2BAA2BH,EAAGI,IAAKtC,WAAIuO,GAC9CrM,EAAGI,IAAI+H,eAAeC,QAAQ,MAAOiE,EAAKtO,QAASsO,EAAKlR,4BAIrD6E,EAAG6kB,kBAAkB1nB,EAAK8Q,EAAKC,GAAK,sBACpClO,EAAGwlB,sBAAsBnZ,SArEnCpM,KAAKG,IAAIjC,YAAmB,MAAE2K,KAAK2c,UAAUpZ,EAAKsJ,IAAM,GAAG+P,WA8E9DL,iCAAkC,SAASxK,GAC1C1W,IAAInE,EAAKC,KAEN4a,GAAgB3b,KAAKrE,OAAO0J,SAASY,YAAY,uCACvB,qBAC3B0V,EAAeiC,KAAKC,MAAMlC,IAG3B9f,EAAEqP,KAAKyQ,EAAc,SAASX,EAAK3Q,GAElC,KADavJ,EAAGI,IAAIjD,IAAIkgB,OAAS,IAAI5I,cAAK3W,UAAKA,EAAE2d,eAAiBvB,IACvD,CACV/V,IAAImgB,EAAQzpB,OAAOsI,MAAMyO,UAAU5R,EAAGI,IAAIjD,IAAK,SAC/CmnB,EAAMjK,YAAc,eACpBiK,EAAM7I,aAAevB,EACrBoK,EAAM/a,KAAO,OAMjB/J,UAAW,SAASrC,EAAK8Q,EAAKC,GAE7B,IAAI7B,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,GAE/B,GAAI7B,GAAQA,EAAK7M,UAChB,GAAK6M,EAAKzI,UAGL,CACJ,IAAI+hB,EAAmB,GAGnBC,EAAavZ,EAAK7M,UAAUqmB,OAAOC,QAAQ,KAAM,MAErDF,EAAaA,EAAWC,OAAO3D,MAAM,MAGrC,IAAK,IAAI6D,EAAE,EAAGA,GAAGH,EAAWhnB,OAAS,EAAGmnB,IACX,IAAxBH,EAAWG,GAAGF,SAAmE,GAAnDF,EAAiB5gB,QAAQ6gB,EAAWG,GAAGF,SACxEF,EAAiB9c,KAAK+c,EAAWG,GAAGF,QAKtCxZ,EAAK7M,UAAYmmB,EAAiBK,KAAK,MAEvC1jB,cAAc,YAAa+J,EAAKlR,KAAMkR,EAAKwB,cACvC1Q,EAAIkb,WAAanZ,KAAK+mB,cAAcC,oDACvCrrB,OAAOsI,MAAMtE,UAAUwN,EAAKtO,QAASsO,EAAKlR,KACzC,MAAOwqB,EAAiB/mB,OAASyN,EAAKwY,mBACvChqB,OAAOsI,MAAMtE,UAAUwN,EAAKtO,QAASsO,EAAKlR,KAAM,YAAawqB,EAAiB/mB,cAxB/EqB,KAAKG,IAAIgI,QAAQ,YAAa6F,EAAKC,IA8BtCiY,SAAU,WACTlmB,KAAKgY,4BAA2B,IAGjChb,QAAS,WACR,IAAI+C,EAAKC,KACLmmB,EAAc,WACjB,GAAGpmB,EAAGI,IAAIjD,IAAIF,SAAW+C,EAAGI,IAAIjC,YAAYX,SAAU,CACrD,IAAI8b,EAAmBtZ,EAAGuZ,uBACtB8M,EAAcxrB,OAAOuC,QAAQ,WAAY4C,EAAGI,IAAIjD,IAAIF,SAEnD+C,EAAGI,IAAIjD,IAAIK,UACfwC,EAAGI,IAAIvB,UAAU,WAAYya,GAG1BtZ,EAAGI,IAAIjD,IAAIK,UAAY8b,GAC1BtZ,EAAGI,IAAIvB,UAAU,kBAAmB,GAEjCmB,EAAGI,IAAIjD,IAAIonB,qBAAuBjL,GACrCtZ,EAAGI,IAAIvB,UAAU,sBAAuB,GAErCwnB,EAAYC,qBACZtmB,EAAGI,IAAIjC,YAAYooB,aACrBvmB,EAAGI,IAAIvB,UAAU,cAAewnB,EAAYC,qBAI1CD,EAAYG,uBAAyB3rB,OAAOgP,KAAK8W,UAAU3gB,EAAGI,IAAIjD,IAAIY,QAAS,aAC3B,GAF1B,CAAC,gBAAiB,YAAa,cAAe,iBAEpDgH,QAAQ/E,EAAGI,IAAIjD,IAAIY,UAC1CiC,EAAGI,IAAIvB,UAAU,UAAWwnB,EAAYG,uBAKrCH,EAAYI,sBAAwB5rB,OAAOgP,KAAK8W,UAAU3gB,EAAGI,IAAIjD,IAAIY,QAAS,aAC3B,GAJ1B,CAAC,wBAAyB,qBAAsB,iBAC5E,mBAAoB,oBAGEgH,QAAQ/E,EAAGI,IAAIjD,IAAIY,UACzCiC,EAAGI,IAAIvB,UAAU,UAAWwnB,EAAYI,sBAGzC5rB,OAAO0W,aAAa,mBACbvR,EAAGI,IAAI+H,eAAeC,QAAQ,+BAC9BpI,EAAG0mB,yCACH1mB,EAAG2iB,yCACH3iB,EAAG2mB,0BAKRC,EAAoB,SAASR,GAChC,GAAInX,QAAQ,CAAC,gBAAiB,oBAAqBjP,EAAGI,IAAIjD,IAAIY,SAAU,CACvE,GAAuB,iBAApBiC,EAAGI,IAAIjD,IAAIY,QACb,IAAI2D,EAAa,WACbmlB,EAAsB,gBAEtBnlB,EAAa,WACbmlB,EAAsB,YAG3B,IAAIhW,EAAQ7Q,EAAGI,IAAIjD,IAAItC,OAAOsI,MAAMyb,MAAMld,IAC1C,GAAGmP,GAAS7Q,EAAGI,IAAIjD,IAAIF,QACtB,OAAOpC,OAAO6H,KAAK,CAClBC,OAAQ,2CACRC,KAAM,CACL3F,QAAS+C,EAAGI,IAAIjD,IAAIF,QACpByE,WAAYA,EACZmP,MAAOA,GAERpO,SAAU,SAASK,IACdA,EAAEgI,KAAOhI,EAAEO,UACdrD,EAAGI,IAAIvB,UAAUgoB,EAAqB/jB,EAAEO,SACxC+iB,QAKHA,SAGDA,KAKF,GAAInmB,KAAKG,IAAIjD,IAAI+T,aAAyBjR,KAAKG,IAAIjD,IAAI+T,kBACvCjR,KAAKG,IAAIjD,IAAIgU,iBAEzBtW,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIrC,QAAS,qBAC9CkR,QAAQ,CAAC,iBAAkB,mBAAoB,oBAAqBhP,KAAKG,IAAIrC,SAC7EhB,QAAQsD,MAAMyS,qBAAqB7S,KAAKG,IAAK,WAC5CwmB,EAAkBR,KAGnBQ,EAAkBR,GAGhBnmB,KAAKG,IAAIjD,IAAIF,UACfF,QAAQ+B,sBAAwBmB,KAAKG,IAAIjD,IAAIF,UAI/CkU,iBAAkB,WACblR,KAAKG,IAAIjD,IAAIgU,mBAChBlR,KAAKG,IAAI+Q,iBAAmBlR,KAAKG,IAAIjD,IAAIgU,iBACzCtW,OAAOiL,GAAGC,KAAKqC,QAAQnI,KAAKG,IAAIjD,IAAIY,QAAS,cAI/CmT,aAAc,WACb,IAAIlR,EAAKC,KACT,GAAIA,KAAKG,IAAIjD,IAAI+T,aAAc,CAG9B,GAFAjR,KAAKG,IAAI8Q,aAAejR,KAAKG,IAAIjD,IAAI+T,aAER,iBAAxBjR,KAAKG,IAAIjD,IAAIY,SAA8BkC,KAAKG,IAAIjD,IAAIgP,UACnC,oBAAxBlM,KAAKG,IAAIjD,IAAIY,SAAiCkC,KAAKG,IAAIjD,IAAIiP,SAC5D,OAAOvR,OAAO6H,KAAK,CAClBC,OAAQ,sCACRC,KAAM,CACLsO,aAAgBlR,EAAGI,IAAIjD,IAAI+T,aAC3BxP,WAAoC,iBAAtB1B,EAAGI,IAAIjD,IAAIY,QAA6B,WAAa,WACnEiT,UAAahR,EAAGI,IAAIjD,IAAI6T,UACxBH,MAA+B,iBAAtB7Q,EAAGI,IAAIjD,IAAIY,QAA6BiC,EAAGI,IAAIjD,IAAIgP,SAAWnM,EAAGI,IAAIjD,IAAIiP,SAClFnP,QAAW+C,EAAGI,IAAIjD,IAAIF,SAEvBwF,SAAU,SAASK,EAAGgkB,GAClBhkB,EAAEO,UACJrD,EAAGI,IAAIjD,IAAI4pB,SAAWjkB,EAAEO,QACxBf,cAAc,YACdzH,OAAOiL,GAAGC,KAAKqC,QAAQpI,EAAGI,IAAIjD,IAAIY,QAAS,YAC3CiC,EAAGgnB,wBAKNnsB,OAAOiL,GAAGC,KAAKqC,QAAQpI,EAAGI,IAAIjD,IAAIY,QAAS,cAK9CgpB,SAAU,WAGT,GAAI9mB,KAAKG,IAAIjD,IAAI4pB,WAAa9mB,KAAKG,IAAIkR,yBAA2BrR,KAAKG,IAAIjD,IAAIgjB,SAC1ElgB,KAAKG,IAAIjD,IAAIikB,wBACfnhB,KAAKG,IAAIjD,IAAIkkB,kBAAoBphB,KAAKG,IAAIjD,IAAIkkB,iBAAiBziB,QAAS,CACzE,IAAIqoB,EAAW,GACXC,EAAW,GACXC,EAAgB,oBAEhBlnB,KAAKG,IAAIjD,IAAIikB,yBAEhB+F,GADAF,EAAW,oCAIPhnB,KAAKG,IAAIjD,IAAIkkB,kBAAoB,IAAIziB,SACzCsoB,EAAW,yBACa,IAApBD,EAASroB,SAAcsoB,EAAW,QAAUA,GAChDC,GAAgCD,GAEjCrsB,OAAO6P,SAASyc,KAKnBnW,UAAW,WACV/Q,KAAKiR,gBAGN8V,kBAAmB,WAClBtpB,IAAMP,EAAM8C,KAAKG,IAAIjD,IACrB,GAAIA,EAAIikB,uBACPnhB,KAAKmhB,8BACC,GAAIjkB,EAAIkkB,iBAAkB,CAChC3jB,IAAMsC,EAAKC,KACX9C,EAAIkkB,iBAAiB3gB,QACpB,SAAS0mB,GACJA,EAAKC,aACRrnB,EAAGqnB,aAAalqB,EAAKiqB,EAAKrpB,QAASqpB,EAAKjsB,MAExCN,OAAOsI,MAAMtE,UACZuoB,EAAKrpB,QAASqpB,EAAKjsB,KAAM,WACzBgC,EAAI+T,cAAgB/T,EAAIgU,sBAQ9BoI,qBAAsB,WACrB,OAAOxc,QAAQC,aAAaiD,KAAKG,IAAIjD,IAAIF,UAG1CiS,eAAgB,WACfnS,QAAQsD,MAAMuS,oBAAoB3S,KAAKG,MAGxC5C,SAAU,WAET,IAAI2T,EAAmBlR,KAAKG,IAAIjD,IAAIgU,kBAAoBlR,KAAKG,IAAIjD,IAAI+T,aAEjElR,EAAKC,KACTA,KAAK6gB,qBACL,IAAIxH,EAAmBrZ,KAAKsZ,uBAEzBtZ,KAAKG,IAAIjD,IAAIK,UAAYyC,KAAKG,IAAIjD,IAAIK,WAAa8b,IAChDrZ,KAAKG,IAAIjD,IAAIwnB,oBAElB1kB,KAAKqnB,kBAAkBnW,EAAkBlR,KAAKG,IAAIjD,IAAIK,SAAU8b,EAC/D,SAASiO,GACLA,GAAiBvnB,EAAGI,IAAIjD,IAAIgZ,kBAC9BnW,EAAGwnB,oCAAoCD,GACvCvnB,EAAGynB,qCAAqCF,GACxCvnB,EAAGI,IAAIvB,UAAU,kBAAmB0oB,MAIvCtnB,KAAKkW,mBAIPA,gBAAiB,WACLlW,KAAKG,IACbH,KAAKG,IAAIjD,IAAIK,WAAayC,KAAKsZ,wBACjCtZ,KAAKG,IAAIvB,UAAU,kBAAmB,GAEpCoB,KAAKG,IAAIjD,IAAIK,WAAayC,KAAKG,IAAIjD,IAAIonB,qBACzCtkB,KAAKG,IAAIjD,IAAIqnB,sBAAwBvkB,KAAKG,IAAIjD,IAAIgZ,iBAClDlW,KAAKG,IAAIvB,UAAU,sBAAuBoB,KAAKG,IAAIjD,IAAIgZ,iBAGrD5L,IAAItK,KAAKG,IAAIjD,IAAIgZ,iBAAiB,IACjClW,KAAKG,IAAIjD,IAAIwnB,oBACf1kB,KAAKgY,6BACMhY,KAAKynB,qBAChBznB,KAAK0nB,oBAKP1nB,KAAKG,IAAIyL,gBAAgB,kBAAmB,YAAa9O,QAAQkC,qBAAuB,EAAI,IAG7F2oB,cAAe,sBACV5nB,EAAKC,KACT,GAAGA,KAAKG,IAAIjD,IAAIyqB,cACf,OAAO3nB,KAAKG,IAAIsC,KAAK,CACpBvF,IAAK8C,KAAKG,IAAIjD,IACdwF,OAAQ,sBACRF,SAAU,SAASK,GACdA,EAAEgI,KACL9K,EAAGiY,gCAGH4P,uBAAW5nB,EAAKG,IAAIvB,UAAU,gBAAiB,MAGlDmB,EAAGiY,8BAILuP,oCAAqC,SAASD,GACzCtY,QAAQ,CAAC,YAAa,cAAe,gBAAiB,kBAAmBhP,KAAKG,IAAIjD,IAAIY,SAEzFhD,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAIwM,OAAS,GAAI,SAAStH,EAAGvE,GACxB,UAAjBA,EAAE6Z,aACJ9c,OAAOsI,MAAMtE,UAAUf,EAAEC,QAASD,EAAE3C,KAAM,wBACzCoP,IAAIzM,EAAE+Z,uBAAyBtN,IAAIgd,OAMxCE,qCAAsC,SAASF,GAE9CxsB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAIkgB,OAAS,GAAI,SAAShb,EAAGvE,GACxB,UAAjBA,EAAEuc,aACJxf,OAAOsI,MAAMtE,UAAUf,EAAEC,QAASD,EAAE3C,KAAM,aACzCoP,IAAIzM,EAAEqe,YAAc5R,IAAIgd,OAK5BD,kBAAmB,SAASnW,EAAkB2W,EAAeC,EAAatlB,GACzE,IAAIG,EAQJ,GAPI,CAAC,YAAa,cAAe,gBAAiB,iBAAiBsC,SAASjF,KAAKG,IAAIrC,SACpF6E,EAAO,cAEC,CAAC,iBAAkB,mBAAoB,oBAAoBsC,SAASjF,KAAKG,IAAIrC,WACrF6E,EAAO,cAGHuO,GAAqB2W,GAAkBC,EAC5C,OAAOltB,OAAO6H,KAAK,CAClBC,OAAQ,wCACRC,KAAM,CACLuO,iBAAkBA,EAClB2W,cAAeA,EACfC,YAAaA,EACbnlB,KAAMA,GAEPH,SAAU,SAASK,GAClBL,EAAS8H,IAAIzH,EAAEO,cAKlBkhB,oBAAqB,WACpB,IAAIvkB,EAAGC,KACPA,KAAK6gB,qBAEL,IAAIxH,EAAmBrZ,KAAKsZ,uBAEzBtZ,KAAKG,IAAIjD,IAAIonB,sBAAwBjL,GAAsBrZ,KAAKG,IAAIjD,IAAIwnB,oBAM1E1kB,KAAKukB,sBALLvkB,KAAKqnB,kBAAkBrnB,KAAKG,IAAIjD,IAAI+T,aAAcjR,KAAKG,IAAIjD,IAAIonB,oBAAqBjL,EACnF,SAASiO,GACRvnB,EAAGI,IAAIvB,UAAU,sBAAuB0oB,MAO5C/C,oBAAqB,WACjBvkB,KAAKG,IAAIjD,IAAIonB,sBAAwBtkB,KAAKsZ,uBAC5CtZ,KAAKG,IAAIvB,UAAU,sBAAuB,GACjCoB,KAAKG,IAAIjD,IAAIonB,sBAAwBtkB,KAAKG,IAAIjD,IAAIK,UACxDyC,KAAKG,IAAIjD,IAAIqnB,qBAAiE,GAA1CtlB,KAAKe,KAAKG,IAAIjD,IAAIqnB,sBACzDtlB,KAAKe,KAAKG,IAAIjD,IAAIqnB,sBAAwBtlB,KAAKe,KAAKG,IAAIjD,IAAIgZ,kBAC5DlW,KAAKG,IAAIvB,UAAU,kBAAmBoB,KAAKG,IAAIjD,IAAIqnB,qBAGhDvkB,KAAKynB,qBACRznB,KAAK0nB,iBAAiB,MAAM,IAI9B5C,IAAK,SAAS5nB,EAAK8Q,EAAKC,GACvB,IAAIlO,EAAKC,KACLoM,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,GAC/B,GAAG7B,EAAKzI,WAAayI,EAAK0Y,IACzB,OAAO9kB,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,uDACR2hB,MAAOjY,EACPzJ,KAAM,CACLgB,UAAWyI,EAAKzI,UAChBmhB,IAAK1Y,EAAK0Y,KAEXtiB,SAAU,SAASK,GACdA,EAAEgI,KACL9K,EAAG6kB,kBAAkB7kB,EAAGI,IAAIjD,IAAK8Q,EAAKC,OAO3C2W,kBAAmB,SAAS1nB,EAAK8Q,EAAKC,EAAK8Z,GAC1C,GAAkB,oBAAf7qB,EAAIY,SAAiClD,OAAOgP,KAAKC,aAAamE,EAAK,YAAaC,GAAM,CACxF,IAAI7B,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,GAC/BrT,OAAOsI,MAAMsW,gBAAgBpN,EAAM,CAAC,MAAO,sBAC3CA,EAAK0N,UAAYxP,IAAI8B,EAAKpE,IAAMoE,EAAKwY,kBAAmBzO,UAAU,YAAa/J,IAC/EA,EAAKwN,aAAetP,IAAI8B,EAAK0N,UAAY1N,EAAKyN,iBAC9CxX,cAAc,YAAa+J,EAAKlR,KAAMkR,EAAKwB,aAC3CvL,cAAc,eAAgB+J,EAAKlR,KAAMkR,EAAKwB,aAC9C5N,KAAKqlB,yBAAyBjZ,GAC9BpM,KAAKqhB,wBACA0G,GACJntB,OAAOgP,KAAK8W,UAAUxjB,EAAIY,QAAS,wBACnCkC,KAAK0nB,iBAAiBtb,GAAM,KAK/BiZ,yBAA0B,SAASjZ,GAE/BpM,KAAKG,IAAI8gB,UAAU,SAASpY,KAAKmf,WAAWpD,mBAC9C5kB,KAAKG,IAAIjC,YAAYwL,MAAMb,KAAKof,cAAc,oBAC3C7b,EAAK0Y,KAAO1Y,EAAK4Y,YAAepqB,OAAOgP,KAAKC,aAAa5M,QAAQiB,YAAYwL,MAAMb,KAAK/K,QAAS,qBAAqBkJ,YAK3HgB,IAAK,SAAS9K,EAAK8Q,EAAKC,GACvB/J,IAAIkI,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,GAC/BjO,KAAK4kB,kBAAkB1nB,EAAK8Q,EAAKC,GAAK,GACtCjO,KAAK0mB,mBAAmBta,GAAM,IAG/B8b,kBAAmB,SAAS/nB,EAAK6N,EAAKC,GACrC,IAAIoW,EAAQ3lB,OAAOsP,GAAKC,GAExB,GAAGoW,EAAM6D,kBAAmB,CAC3BhkB,IAAIikB,EAAaC,KAAKtL,MAAMuH,EAAMgE,oBAC9BC,EAAWF,KAAKtL,MAAMuH,EAAMkE,kBAC5BC,EAAYJ,KAAKtL,MAAMuH,EAAM6D,mBAE9BM,EAAYL,GACdvtB,OAAOsI,MAAMtE,UAAUoP,EAAKC,EAAK,oBAAqB,IACtDrT,OAAO4R,MAAMlR,GAAG,2DACNktB,EAAYF,IACtB1tB,OAAOsI,MAAMtE,UAAUoP,EAAKC,EAAK,oBAAqB,IACtDrT,OAAO4R,MAAMlR,GAAG,0DAKnB+sB,mBAAoB,SAASloB,EAAK6N,EAAKC,GACtC,IAAIoW,EAAQ3lB,OAAOsP,GAAKC,GAErBoW,EAAMgE,oBACRztB,OAAO6H,KAAK,CACXC,OAAU,4DACVC,KAAM,CAACA,KAAQ0hB,GACf7hB,SAAU,SAASK,GAClBjI,OAAOsI,MAAMtE,UAAUoP,EAAKC,EAAK,mBAAoBpL,EAAEO,QAAQmlB,sBAMnElH,qBAAsB,WAErB,IAAIthB,EAAKC,KACTA,KAAKG,IAAIjD,IAAIurB,iBAAkB,EAE/B3tB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAGgK,GAC/CrM,EAAGI,IAAIjD,IAAIurB,kBAAoBne,IAAI8B,EAAKwN,gBAEzCvX,cAAc,oBACdrC,KAAK2nB,iBAGN9G,mBAAoB,WAEnB7gB,KAAKG,IAAIuoB,YAAY,yBACjB1oB,KAAKG,IAAIjD,IAAIyrB,kBAAmB3oB,KAAKG,IAAIjD,IAAIonB,sBAEjD,IAAIjL,EAAmBrZ,KAAKsZ,uBAC5BtZ,KAAK4oB,mBAAmBvP,GACxBrZ,KAAK6oB,mBAAmBxP,GACxBrZ,KAAKG,IAAIqY,kBAGVoQ,mBAAoB,SAASvP,GAG5BrZ,KAAKG,IAAI2oB,oBAAoB,CAAC,aAAc,iBAAkB,+BAC7D,uBAAwB,mBAAoB,qBAAsB,gBAClE,+BAAgC,kCAAmC,sBACnE,mBAAoB,wBAAyB,qBAAsB,sBACnE,yBAA0B,kBAAmB,2BAC7C,4BAA6BzP,GAE9BrZ,KAAKG,IAAI2oB,oBAAoB,CAAC,QAAS,YAAa,0BAA2B,kBAC9E,cAAe,0BAA2B,6BAC1C,gBAAiB,WAAY,cAAe,mBAAoB,iBAChE,sBAAuB,sBAAuB,oBAC9C,cAAe9oB,KAAKG,IAAIjD,IAAIK,UAE7ByC,KAAKG,IAAI2oB,oBAAoB,CAAC,qBAAsB,iBACnD9oB,KAAKG,IAAIjD,IAAIuiB,wBAEdxiB,QAAQ2O,gBAAgB,kBAAmB,cAAe,KAAO5L,KAAKG,IAAIjD,IAAIK,SAC3E,UAAY8b,GAEZrZ,KAAKG,IAAIjD,IAAIonB,qBAAuBtkB,KAAKG,IAAIjD,IAAIonB,qBAAqBjL,GACxEpc,QAAQ2O,gBAAgB,sBAAuB,cAAe,KAC3D5L,KAAKG,IAAIjD,IAAIonB,oBAAsB,UAAYjL,GAInDrZ,KAAKG,IAAI/B,eAAe,CAAC,kBAAmB,aAAc,iBACzD,+BAAgC,+BAAgC,kCAChE,mBAAoB,qBAAsB,gBAAiB,uBAC3D,mBAAoB,wBAAyB,sBAAuB,yBACpE,kBAAmB,2BAA4B,4BAChD4B,KAAKG,IAAIjD,IAAIK,UAAY8b,GAEzBrZ,KAAKG,IAAI/B,eAAe,CAAC,sBAAuB,uBAC/C4B,KAAKG,IAAIjD,IAAIonB,qBAAuBjL,GAErC,IAAItQ,EAAO9J,KAAKhC,QAAQC,IAAI6a,mBACxB9a,QAAQC,IAAIkgB,OAAS,IAAIxf,OAAO,SAASC,GAAI,OAAkC,IAA3BA,EAAE6c,yBAAmC,OAE1F9f,OAAOgP,KAAKC,aAAa5M,QAAQa,QAAS,cAC5Cb,QAAQmB,eAAe,YAAa2K,GAElCnO,OAAOgP,KAAKC,aAAa5M,QAAQa,QAAS,mBAC5Cb,QAAQmB,eAAe,iBAAmB2K,GA5ClC/I,KA4C8CG,IAAIjD,IAAIK,UAAY8b,IAI5EwP,mBAAoB,SAASxP,GAC5B,IAAItZ,EAAKC,KAQT,GANAA,KAAKG,IAAI2oB,oBAAoB,CAAC,YAAa,gBAAiB,uBAAwB,cAAe,mBAClGzP,EAAkB,SAEnBrZ,KAAKG,IAAI2oB,oBAAoB,CAAC,OAAQ,WAAY,kBAAmB,SAAU,cAC9E9oB,KAAKG,IAAIjD,IAAIK,SAAU,SAErByC,KAAKG,IAAIjC,YAAwB,WAAG,CACtC8B,KAAKG,IAAI2oB,oBAAoB,CAAC,iBAAkB,aAAc9oB,KAAKG,IAAIjD,IAAIK,SAAU,cACrFyC,KAAKG,IAAI2oB,oBAAoB,CAAC,sBAAuB,kBAAmBzP,EAAkB,cAE1F,IAAI0P,EAAY/oB,KAAKG,IAAIjC,YAAwB,WAAE2K,KACnD/N,EAAEqP,KAAK,CAAC,sBAAuB,kBAAmB,SAAS/H,EAAG4mB,GAC1DpuB,OAAOgP,KAAKC,aAAakf,EAAUjrB,QAASkrB,IAC9CD,EAAUE,gBAAgBD,EAAOjpB,EAAGI,IAAIjD,IAAIK,UAAY8b,KAI3D,GAAGrZ,KAAKG,IAAIjC,YAAyB,YAAG,CACvC8B,KAAKG,IAAI2oB,oBAAoB,CAAC,OAAQ,UAAW9oB,KAAKG,IAAIjD,IAAIK,SAAU,eACxEyC,KAAKG,IAAI2oB,oBAAoB,CAAC,YAAa,eAAgBzP,EAAkB,eAEzE0P,EAAY/oB,KAAKG,IAAIjC,YAAyB,YAAE2K,KACpD/N,EAAEqP,KAAK,CAAC,YAAa,eAAgB,SAAS/H,EAAG4mB,GAC7CpuB,OAAOgP,KAAKC,aAAakf,EAAUjrB,QAASkrB,IAC9CD,EAAUE,gBAAgBD,EAAOjpB,EAAGI,IAAIjD,IAAIK,UAAY8b,KAIxDrZ,KAAKG,IAAIjC,YAAmB,QAC9B8B,KAAKG,IAAI2oB,oBAAoB,CAAC,aAAc,QAAS,6BAA8B9oB,KAAKG,IAAIjD,IAAIK,SAAU,SAE1GyC,KAAKG,IAAI2oB,oBAAoB,CAAC,kBAAmB,aAAc,kCAAmCzP,EAAkB,UAGlHrZ,KAAKG,IAAIjC,YAAsB,UACjC8B,KAAKG,IAAI2oB,oBAAoB,CAAC,iBAAkB,oBAC/C9oB,KAAKG,IAAIjD,IAAIuiB,uBAAwB,YAInCsJ,EAAY/oB,KAAKG,IAAIjC,YAAmB,MAAE2K,KAC9C/N,EAAEqP,KAAK,CAAC,YAAa,uBAAwB,eAAgB,SAAS/H,EAAG4mB,GACrEpuB,OAAOgP,KAAKC,aAAakf,EAAUjrB,QAASkrB,IAC9CD,EAAUE,gBAAgBD,EAAOjpB,EAAGI,IAAIjD,IAAIK,UAAY8b,KAG1D,IAAItQ,EAAQ9J,KAAKhC,QAAQC,IAAI6a,mBAC1B9a,QAAQC,IAAIkgB,OAAS,IAAIxf,OAAO,SAASC,GAAI,OAAkC,IAA3BA,EAAE6c,yBAAmC,OAE5F5f,EAAEqP,KAAK,CAAC,WAAY,cAAe,SAAS/H,EAAG4mB,GAC3CpuB,OAAOgP,KAAKC,aAAakf,EAAUjrB,QAASkrB,IAC9CD,EAAUE,gBAAgBD,EAAOjgB,KAGnCjO,EAAEqP,KAAK,CAAC,gBAAiB,mBAAoB,SAAS/H,EAAG4mB,GACrDpuB,OAAOgP,KAAKC,aAAakf,EAAUjrB,QAASkrB,IAC9CD,EAAUE,gBAAgBD,EAAQjgB,GAAShJ,EAAGI,IAAIjD,IAAIK,UAAY8b,KAIrDve,EAAEkF,KAAKG,IAAI+oB,UAG3BC,YAAa,WACZnpB,KAAKgY,8BAGNoR,mBAAoB,WACnBppB,KAAKgY,8BAGNqR,kBAAmB,WAClBrpB,KAAKgY,8BAGN0M,oBAAqB,WACpB,GAAG1kB,KAAKG,IAAIjD,IAAIwnB,oBAAqB,CACpC,IAAI3kB,EAAKC,KACLspB,EAAY,GAchB,OAZAxuB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAGvE,GAC3CA,EAAE8F,YAAc9F,EAAE0rB,cACrBD,EAAU1gB,KAAK,CACd9K,QAAWD,EAAEC,QACb5C,KAAQ2C,EAAE3C,KACVyI,UAAa9F,EAAE8F,UACf6lB,cAAiB3rB,EAAE2rB,cACnBhS,WAAc3Z,EAAE2Z,WAChBiS,OAAU5rB,EAAE4rB,WAIRzpB,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,0EACRC,KAAM,CAAE2mB,UAAWA,GACnB9mB,SAAU,SAASK,IACbA,EAAEgI,KAAOhI,EAAEO,UACfP,EAAEO,QAAQ3C,iBAAQipB,GACjB3pB,EAAGwlB,sBAAsBmE,KAE1B3pB,EAAG4pB,0BAA0B9mB,EAAEO,SAC/BrD,EAAGiY,6BACAjY,EAAGI,IAAIjD,IAAImd,mBAAmBta,EAAGI,IAAIgI,QAAQ,yBAKnDnI,KAAK0mB,sBAIPA,mBAAoB,SAASta,EAAM4L,GAClC,IAAIjY,EAAKC,KACL2C,EAAO3C,KAAK4pB,UAAUxd,GAC1B,GAAMzJ,EAAK+G,OAAS/G,EAAK+G,MAAM/K,OAK/B,OAAOqB,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,wEACRC,KAAM,CAAEA,KAAMA,EAAMzF,IAAK6C,EAAGI,IAAIjD,KAChCsF,SAAU,SAASK,IACbA,EAAEgI,KAAOhI,EAAEO,UACfrD,EAAG4pB,0BAA0B9mB,EAAEO,SAC5BgJ,GAAMrM,EAAG4gB,iBAAiBvU,GAC1BrM,EAAGI,IAAIjD,IAAImd,mBAAmBta,EAAGI,IAAIgI,QAAQ,yBAX/C6P,GAA4BjY,EAAGiY,8BAiBpC4R,UAAW,SAASxd,GACnB,IAAIrM,EAAKC,KACT,MAAO,CACN0J,MAAS1J,KAAK6pB,eAAezd,GAC7BF,SAAYnM,EAAGI,IAAIjD,IAAIgP,UAAYnM,EAAGI,IAAIjD,IAAIgS,WAC9CyB,aAAgB5Q,EAAGI,IAAIjD,IAAIyT,aAC3B6B,eAAkBzS,EAAGI,IAAIjD,IAAIsV,eAC7BsX,UAAa/pB,EAAGI,IAAIjD,IAAI4sB,UACxB3d,SAAYpM,EAAGI,IAAIjD,IAAIiP,SACvBsG,eAAkB1S,EAAGI,IAAIjD,IAAIuV,eAC7BlV,SAAYwC,EAAGI,IAAIjD,IAAIK,SACvB2Y,gBAAmBnW,EAAGI,IAAIjD,IAAIgZ,gBAC9BrF,WAAc9Q,EAAGI,IAAIjD,IAAI4T,oBAAsB/Q,EAAGI,IAAIjD,IAAI8T,kBAC1DsT,oBAAuBvkB,EAAGI,IAAIjD,IAAIonB,oBAClCC,oBAAuBxkB,EAAGI,IAAIjD,IAAIqnB,oBAClCvnB,QAAW+C,EAAGI,IAAIjD,IAAIF,QACtBkU,iBAAoBnR,EAAGI,IAAIjD,IAAIgU,kBAAoBnR,EAAGI,IAAIjD,IAAI+T,aAC9D8Y,SAAYhqB,EAAGI,IAAIjD,IAAI6sB,SACvBC,cAAiBjqB,EAAGI,IAAIjD,IAAI8sB,cAC5BtF,oBAAuB3kB,EAAGI,IAAIjD,IAAIwnB,oBAClC5mB,QAAWiC,EAAGI,IAAIjD,IAAIY,QACtB5C,KAAQ6E,EAAGI,IAAIjD,IAAIhC,KACnBkd,UAAanZ,KAAKc,EAAGI,IAAIjD,IAAIkb,WAC7B8L,aAAgBlV,QAAQ,CAAC,gBAAiB,oBAAqBjP,EAAGI,IAAIjD,IAAIY,SAAWmB,KAAKc,EAAGI,IAAIjD,IAAIgnB,cAAgB,EACrHU,kBAAqB7kB,EAAGI,IAAIjD,IAAI0nB,kBAChCK,YAAqC,iBAAtBllB,EAAGI,IAAIjD,IAAIY,QAA6BiC,EAAGI,IAAIjD,IAAI+nB,YAAc,KAIlF4E,eAAgB,SAASzd,GACxB,IAAIkd,EAAY,GACZW,EAAc,SAASpsB,GACtBA,EAAE8F,YACL2lB,EAAU1gB,KAAK,CACd9K,QAAWD,EAAEC,QACb5C,KAAQ2C,EAAE3C,KACVoN,cAAiBzK,EAAE3C,KACnByI,UAAa9F,EAAE8F,UACfumB,WAAcrsB,EAAEqsB,WAChBC,MAAStsB,EAAEssB,MACXniB,IAAOnK,EAAEmK,IACT8R,UAAajc,EAAEic,UACfgL,IAAOjnB,EAAEinB,IACTE,UAAannB,EAAEmnB,UACfxN,WAAc3Z,EAAE2Z,WAChBiS,OAAU5rB,EAAE4rB,OACZD,cAAiB3rB,EAAE2rB,cACnBpiB,UAAavJ,EAAEuJ,UACf7H,UAAa1B,EAAE0B,UACfgY,gBAAmB1Z,EAAE0Z,gBACrBqN,kBAAqB/mB,EAAE+mB,mBAAqB,IAIzC5V,QAAQ,CAAC,iBAAkB,mBAAoB,qBAAsB,uBAAwBnR,EAAEC,UAClGwrB,EAAU,GAAgB,YAAIzrB,EAAE6Z,YAChC4R,EAAU,GAA0B,sBAAIzrB,EAAE+Z,yBAY7C,OAPIxL,EACH6d,EAAY7d,GAEZtR,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAW,OAAK,GAAI,SAASkF,EAAGvE,GAC/CosB,EAAYpsB,KAGPyrB,GAGRK,0BAA2B,SAASS,GAGnC,IAFA,IACIC,GAA0B,EACtBjoB,EAAE,EAAGkoB,EAAEF,EAASzrB,OAAQyD,EAAEkoB,EAAGloB,IAAK,CACzC,IAAIvE,EAAIusB,EAAShoB,GACbmoB,EAAwB3vB,OAAOsI,MAAMiE,UAAUtJ,EAAEC,QAASD,EAAE3C,KAAM,iBACtE,IAAI,IAAIoqB,KAAKznB,EAAG,CACf,IAAIwS,EAAIxS,EAAEynB,IAC4B,IAAlC,CAAC,UAAW,QAAQxgB,QAAQwgB,KACzB,mBAAHA,GACChb,IAAI+F,IAAM/F,IAAIzM,EAAE0Z,mBAAkB8S,GAA0B,GAEhEzvB,OAAOsI,MAAMtE,UAAUf,EAAEC,QAASD,EAAE3C,KAAMoqB,EAAGjV,IAXvCrQ,KAgBDG,IAAIjD,IAAIwnB,sBAAuB6F,GAA0B1sB,EAAE2rB,cAhB1DxpB,KAmBJulB,sBAAsB3qB,OAAOuC,QAAQU,EAAEC,QAASD,EAAE3C,OAnB9C8E,KAiBJ0nB,iBAAiB9sB,OAAOuC,QAAQU,EAAEC,QAASD,EAAE3C,OAM9CmvB,GAvBKrqB,KAuBuBgY,8BAGjC0P,iBAAkB,SAAStb,EAAMoe,GAG3BA,GACJxqB,KAAKG,IAAIvB,UAAU,sBAAuB,IAG3C,IAAImB,EAAKC,KACL2C,EAAO3C,KAAK4pB,UAAUxd,GAC1B,IAAOzJ,EAAK+G,OAAS/G,EAAK+G,MAAM/K,QAAWgE,EAAKkO,aAIlB,GAA1B9Q,EAAG0nB,oBAGP,OADA1nB,EAAG0nB,qBAAsB,EAClBznB,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,kDACRC,KAAM,CAAEA,KAAMA,GACdH,SAAU,SAASK,GACbA,EAAEgI,IAaN9K,EAAG0nB,qBAAsB,EAZzB7sB,OAAO0W,aAAa,mBACbvR,EAAGI,IAAIvB,UAAU,sBAAuBiE,EAAEO,QAAQqmB,OAAOnF,wCACzDvkB,EAAGI,IAAIvB,UAAU,sBAAuBiE,EAAEO,QAAQqmB,OAAOlF,iCAE3D5hB,EAAK+G,MAAM/K,QACboB,EAAG4pB,0BAA0B9mB,EAAEO,QAAQgnB,sBAGjCrqB,EAAG0nB,qBAAsB,QAOlCgD,kBACF1qB,EAAG0nB,qBAAsB,KAI3BlC,sBAAuB,SAASnZ,GAC/BlI,IAAInE,EAAKC,KACHwG,EAAS,CAAC,sBAAuB,kBAAmB,iBAE1D,GAAI4F,EAAKod,cACR5uB,OAAO6H,KAAK,CACXC,OAAQ,uFACRC,KAAM,CACLzF,IAAK6C,EAAGI,IAAIjD,KAEbsF,SAAU,SAASK,GACdA,EAAEO,UACLP,EAAEO,QAAQsG,MAAMjJ,iBAAQ5C,GACvBkC,EAAGI,IAAIjD,IAAIwM,MAAMjJ,iBAAQqH,GACrBjK,EAAE3C,MAAQ4M,EAAI5M,MAChBsL,EAAO/F,iBAAQuZ,GACdlS,EAAIkS,GAAKnc,EAAEmc,SAMfja,EAAG2qB,mCAIA,GAAGte,EAAKue,iBAAkB,CAChC,IAAIjhB,EAAQ,GAEZ3J,EAAGI,IAAIjD,IAAIwM,MAAMjJ,iBAAQ5C,GACrBA,EAAE8F,WAAayI,EAAKue,kBAAqB9sB,EAAE0rB,cAC7C7f,EAAMd,KAAK/K,KAIbkC,EAAGI,IAAIjD,IAAIwM,MAAQA,EACnBrH,cAAc,cACR,GAAG+J,EAAKwe,kBAAoBxe,EAAKye,SAAU,CACjDptB,IAAMmtB,EAAmBxe,EAAKwe,iBAAiB3I,MAAM,KACrDliB,EAAGI,IAAIjD,IAAIwM,MAAMjJ,iBAAQqH,GACrB8iB,EAAiB3lB,SAAS6C,EAAIsE,EAAKye,YACrCrkB,EAAO/F,iBAAQuZ,GACdlS,EAAIkS,GAAK,MAKZja,EAAG2qB,4BAILA,wBAAyB,WACxB,IAAI3qB,EAAMC,KAEVA,KAAKG,IAAIjD,IAAIwM,MAAMjJ,iBAAQqqB,GAC1B/qB,EAAGI,IAAI+H,eAAeC,QAAQ,kBAC7B2iB,EAAUhtB,QAASgtB,EAAU5vB,SAIhCkpB,2BAA4B,WAC3B,IAAIrkB,EAAKC,KACL+qB,GAAQ,EAYZ,OAVAjwB,EAAEqP,KAAK,CAAC,UAAW,YAAa,SAAS/H,EAAGF,GACxCtH,OAAOgP,KAAK8W,UAAU3gB,EAAGI,IAAIjD,IAAIY,QAASoE,IAAoC,kBAAtBnC,EAAGI,IAAIjD,IAAIY,UAChEiC,EAAGI,IAAIjD,IAAIgF,KACftH,OAAO6P,SAASnP,GAAG,kBAAoB,KACtCV,OAAOgP,KAAK6C,UAAU1M,EAAGI,IAAIjD,IAAIY,QAASoE,EAAWnC,EAAGI,IAAIjD,IAAIhC,MAChE,KAAOI,GAAG,wCACXyvB,GAAQ,MAIJA,GAGRzoB,UAAW,WACV,IAAIvC,EAAKC,KAETlD,QAAQsD,MAAMkC,UAAUtC,KAAKG,IAAIjD,IAAIqF,QAASvC,KAAKG,IAAIjD,IAAK,SAAS2F,GAChEA,EAAEgI,KACL9K,EAAGI,IAAIvB,UAAU,QAASiE,EAAEO,YAK/BsgB,kBAAmB,WAClB,IAAI3jB,EAAKC,KACT,GAAGA,KAAKG,IAAIjD,IAAIwmB,kBACf,OAAO1jB,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,gEACRC,KAAM,CACLghB,eAAkB/oB,OAAOgP,KAAKC,aAAa7J,KAAKG,IAAIjD,IAAIY,QAAS,oBAChEkC,KAAKG,IAAIjD,IAAIhC,MAAM8J,QACpBgmB,YAAehrB,KAAKG,IAAIjD,IAAIwmB,mBAE7BlhB,SAAU,SAASK,GAClB,IAAIA,EAAEgI,IACL,GAAG9K,EAAGI,IAAIjD,IAAIyqB,eAAiB5nB,EAAGI,IAAIjD,IAAIkgB,MAAO,CAChD,IAAK,UAAWva,EAAEO,wBAAS,CAAtBc,IAAI+V,OACRla,EAAGI,IAAIwR,UAAU,QAASsI,GAG3B5X,cAAc,cAEdtC,EAAGI,IAAIvB,UAAU,QAASiE,EAAEO,SAC5BrD,EAAGiY,iCAQT5F,aAAc,sBACJpS,KACHG,IAAIkR,wBAEVzW,OAAO0W,aAAa,mBACbtR,EAAKymB,yCACL3pB,QAAQsD,MAAMmS,UAAUvS,EAAKG,IAAK,oBAI1CglB,kBAAmB,SAASjoB,EAAK8Q,EAAKC,GACrC,IAAIlO,EAAKC,KACT,IAAGD,EAAGI,IAAIkR,uBAAV,CAEA,IAAIjF,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,GAE/B,GAAG7B,EAAK+Y,kBACP,OAAOnlB,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,kDACRC,KAAM,CACL3F,QAAS+C,EAAGI,IAAIjD,IAAIF,QACpBmoB,kBAAmB/Y,EAAK+Y,kBACxB8F,SAAS,GAEVzoB,SAAU,SAASK,GACdA,EAAEgI,MACLuB,EAAK0O,cAAgBjY,EAAEO,QACvBrD,EAAGqlB,iCAAiChZ,EAAK0O,eACzC/a,EAAGiY,iCAKN5L,EAAK0O,cAAgB,KACrB/a,EAAGiY,+BAILyO,oBAAqB,WACpB,IAAI1mB,EAAKC,KACLkrB,EAAa,GAOjB,GANApwB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAIwM,OAAS,GAAI,SAAStH,EAAGgK,GACzCA,EAAKzI,WACPunB,EAAWtiB,KAAKwD,EAAKzI,aAIpBunB,EAAWvsB,OACb,OAAOqB,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,mDACRC,KAAM,CACL3F,QAAS+C,EAAGI,IAAIjD,IAAIF,QACpBoV,aAAc5E,KAAKzN,EAAGI,IAAIjD,IAAIkV,cAC9B8Y,WAAYA,GAEb1oB,SAAU,SAASK,GACdA,EAAEgI,MACL/P,EAAEqP,KAAKpK,EAAGI,IAAIjD,IAAIwM,OAAS,GAAI,SAAStH,EAAGgK,GACvCA,EAAKzI,WAAad,EAAEO,QAAQ+nB,eAAe/e,EAAKzI,YAClDyI,EAAK+Y,kBAAoBtiB,EAAEO,QAAQgJ,EAAKzI,WAAWwhB,kBACnD/Y,EAAK0O,cAAgBjY,EAAEO,QAAQgJ,EAAKzI,WAAWmX,cAC/C/a,EAAGqlB,iCAAiChZ,EAAK0O,iBAEzC1O,EAAK+Y,kBAAoB,GACzB/Y,EAAK0O,cAAgB,QAGvB/a,EAAGiY,kCAORoT,aAAc,WAEb,GAAGprB,KAAKG,IAAIjD,IAAIkuB,cAAgBprB,KAAKG,IAAIjD,IAAImB,UAG5C,OAFAzD,OAAO6P,SAASnP,GAAG,2CACnB0E,KAAKG,IAAIvB,UAAU,eAAgB,GAIpC,GAAGoB,KAAKG,IAAIjD,IAAIkuB,aAAc,CACzBprB,KAAKG,IAAIjD,IAAImuB,cAChBrrB,KAAKG,IAAIvB,UAAU,eAAgBoB,KAAKG,IAAIjD,IAAIhC,MAGjD,IAAIowB,EAAkC,iBAApBtrB,KAAKG,IAAIjD,IAAIquB,MAC5B3wB,OAAO4wB,UAAU,iBAAiBC,MAClCzrB,KAAKG,IAAIjD,IAAIquB,MAEhBvrB,KAAKG,IAAIjD,IAAIwuB,2BAA6B5wB,EAAEiD,IAAI,CAACyP,KAAK8d,GACrD9d,KAAKxN,KAAKG,IAAIjD,IAAIolB,gBAAiB,SAASjS,GAAK,OAAOA,GAAK,OAAS0V,KAAK,MAC5E/lB,KAAKG,IAAIjD,IAAIyuB,uBAAyB/wB,OAAO8Q,SAASkgB,WAAW5rB,KAAKG,IAAIjD,IAAI+T,cAAc4a,UAG7FC,aAAa,CAAC,6BAA8B,4BAG7CjY,UAAW,WAEV,GAAG7T,KAAKG,IAAIjD,IAAI2W,UAAW,CAC1B,IAGIkY,EAHqB,CAACC,QAAW,EAAGC,UAAa,EAAGC,cAAe,EACtEC,OAAU,IAEqBnsB,KAAKG,IAAIjD,IAAIkvB,gBAC7C,GAAGL,EAAQ,CACV,IAAIjY,EAAUlZ,OAAO8Q,SAAS2gB,WAAWrsB,KAAKG,IAAIjD,IAAI2W,UACrDkY,GACD/rB,KAAKG,IAAIjD,IAAI4W,QAAUlZ,OAAO8Q,SAAS4gB,SAASxY,GAAU,GAC1DzR,cAAc,cAKjBse,iBAAkB,SAASvU,GAC1B,GAA4B,eAAxBpM,KAAKG,IAAIjD,IAAIY,SAA4BsO,EAAKmgB,eAAgB,CACjE,IAAIjjB,EAAOgB,IAAI8B,EAAK9C,MAAQgB,IAAItK,KAAKG,IAAIjD,IAAIgZ,iBAAmB,GAChE9J,EAAKogB,aAAeliB,KAAMhB,EAAO8C,EAAKmgB,gBAAkBngB,EAAK0N,UAAY3D,UAAU,SAAU/J,MAI/FuW,oBAAqB,aASrB8J,aAAc,WACb,IAAIzsB,KAAKG,IAAIiY,UACZ,OAAOpY,KAAKG,IAAIsC,KAAK,CACpBC,OAAQ,eACRxF,IAAK8C,KAAKG,IAAIjD,IACdsF,SAAU,SAASK,EAAGgkB,GACrBxkB,cAAc,gBAMlBqqB,mBAAoB,WACnB,OAAO9xB,OAAO6H,KAAK,CAClBC,OAAQzF,QAAQqd,QAAQqS,yBACxBhqB,KAAM,CACLZ,GAAM9E,QAAQC,IAAIY,QAClBkE,GAAM/E,QAAQC,IAAIhC,MAEnBsH,SAAU,SAASK,GAClB,IAAII,EAAUrI,OAAOsI,MAAMC,KAAKN,EAAEO,SAClCxI,OAAOyI,UAAU,OAAQJ,EAAQ,GAAGnF,QAASmF,EAAQ,GAAG/H,UAM3DyxB,uBAAwB,WACvB,IAAIjqB,EAAS,yEASb,OARGzF,QAAQC,IAAIoD,UAAYrD,QAAQC,IAAIoD,SAASssB,iCAE9ClqB,EADEsM,QAAQ,CAAC,gBAAiB,oBAAsB/R,QAAQC,IAAIY,SACrD,yFAED,wFAIH4E,GAGRwe,oBAAqB,SAAShkB,EAAK8Q,EAAKC,GAGvC,IACI7B,EAAOxR,OAAOuC,QAAQ6Q,EAAKC,GAE/B,GAAI7B,EAAKzI,UAEF,CAAA,GAAmB,oBAAfzG,EAAIY,SACE,oBAAfZ,EAAIY,SAAiCZ,EAAIgnB,aAE1C,MAAO,CACNxc,QAAS,CAAC0E,KAAQA,EAAKzI,YAGxBO,IAAIwD,EAAU,CACb/D,UAAayI,EAAKzI,UAClBsN,aAdOjR,KAcYG,IAAIjD,IAAI+T,cAAgBrW,OAAO8Q,SAAS4H,WAI5D,OAFIlH,EAAKhF,YAAWM,EAAmB,UAAI0E,EAAKhF,WAEzC,CACNK,MAAQ,2CACRC,QAASA,GAhBV9M,OAAO4R,MAAMlR,GAAG,4CAqBlB6lB,uBAAwB,WACvB,IAAIphB,EAAKC,KACH9C,EAAM8C,KAAKG,IAAIjD,IACrB,GAAGA,EAAIikB,wBAA0C,kBAAhBjkB,EAAIY,QAA6B,CACjE,IAAImT,EAAe/T,EAAI+T,cAAgB/T,EAAIgU,iBAC3CtW,OAAO6H,KAAK,CACXC,OAAQ,4DACRC,KAAM,CACLkqB,eAAgB3vB,EAAIikB,uBACpBlQ,aAAcA,EACd0L,YAAazf,EAAIihB,eAAiBjhB,EAAIyf,YACtC5L,UAAW7T,EAAI6T,WAEhBvO,SAAU,SAASK,GACfA,EAAEO,UAAYP,EAAEgI,KAClB9K,EAAGI,IAAIvB,UAAU,mBAAoBiE,EAAEO,cAO5CgkB,aAAc,SAASlqB,EAAK8Q,EAAKC,GAChC,IAAInG,EAAMpJ,OAAOsP,GAAKC,GACnBnG,EAAIsf,cACNxsB,OAAO6H,KAAK,CACXC,OAAQ,mEACRC,KAAM,CACLwkB,KAAMrf,EAAIsf,aACVrW,UAAW/Q,KAAKG,IAAIjD,IAAI6T,UACxBE,aAAcjR,KAAKG,IAAIjD,IAAI+T,cAAgBjR,KAAKG,IAAIjD,IAAIgU,iBACxDyL,YAAa3c,KAAKG,IAAIjD,IAAIihB,eAAiBne,KAAKG,IAAIjD,IAAIyf,aAEzDna,SAAU,SAASK,GAClB,GAAGA,EAAEO,UAAYP,EAAEgI,IAClB,IAAK,IAAIhN,KAAKgF,EAAEO,QACfxI,OAAOsI,MAAMtE,UAAUoP,EAAKC,EAAKpQ,EAAGgF,EAAEO,QAAQvF,QAQpDivB,cAAe,SAAS5vB,EAAK8Q,EAAKC,GACjC,IAAIlO,EAAKC,KACLoM,EAAO1N,OAAOsP,GAAKC,IACnB7B,EAAK0gB,eAAmC,eAAjB1gB,EAAKoL,YAA8C,kBAAjBpL,EAAKoL,YACjE5c,OAAO6H,KAAK,CACXC,OAAQ,2DACRC,KAAM,CACLA,KAAK,CACJgB,UAAWyI,EAAKzI,UAChBuI,SAAUhP,EAAIgP,SACdC,SAAUjP,EAAIiP,SACdnP,QAASE,EAAIF,QACbkU,iBAAkBhU,EAAIgU,iBACtB4b,cAAe1gB,EAAK0gB,gBAGtBtqB,SAAU,SAASK,GACbA,EAAEO,QAGNxI,OAAO0W,aAAa,mBACb1W,OAAOsI,MAAMtE,UAAUoP,EAAKC,EAAK,qBAAsBpL,EAAEO,QAAQqU,uCACjE1X,EAAGI,IAAI+H,eAAeC,QAAQ,kBAAmB6F,EAAKC,MAJ7DrT,OAAO4R,MAAMlR,GAAG,iEAYrB0lB,cAAe,WACd,IAAIjhB,EAAKC,KACNA,KAAKG,IAAIjD,IAAI8jB,eACflmB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAIwM,OAAS,GAAI,SAAStH,EAAGgK,GAC5CxR,OAAOsI,MAAMtE,UAAUmB,EAAGI,IAAIrC,QAAU,QAASsO,EAAKlR,KAAM,YAAa6E,EAAGI,IAAIjD,IAAI8jB,oBAMxFlkB,QAAQoD,2BAA6B,SAASC,EAAKtC,EAAG2E,EAAUuqB,EAAUpd,GACzE/U,OAAOoyB,QAAQ,sDAAuD,WACrE,IAAIlwB,QAAQmwB,sBAAsB,CACjC9sB,IAAKA,EACLiM,KAAMvO,EACNqvB,kBAAmB,CAClBxiB,KAAM,YACNxP,KAAM2C,EAAEuJ,WAET5E,SAAUA,EACVuqB,SAAUA,GACRpd,u9dCxsDL7S,QAAQqwB,aAAeC,MAAM5xB,OAAO,CACnC6xB,KAAM,SAASpnB,GACdnL,EAAEU,OAAOwE,KAAMiG,GAEVjG,KAAKmG,aACTnG,KAAKmG,WAAa,aAGdnG,KAAKstB,aACTttB,KAAKstB,WAAaxwB,QAAQiP,QAAQK,OAAO3E,OAG1CzH,KAAK6I,KAAO7I,KAAKG,IAAI8gB,UAAU,SAASpY,KACxC7I,KAAKmO,SAGNA,MAAO,WACN,IAAIpO,EAAKC,KACLA,KAAK6I,KAAK0kB,mBACbvtB,KAAK6I,KAAK0kB,iBAAmBvtB,KAAK6I,KAAK6K,kBAAkBpY,GAAG,aAAc,WACrEyE,EAAGsG,QACNtG,EAAG8P,cAEJ9P,EAAGsG,OAAO0C,OACVhJ,EAAGytB,eACHC,WAAW,WAAa1tB,EAAGsG,OAAO6J,MAAMwd,SAAY,SAKvD7d,YAAa,WACZ7P,KAAKqG,OAAS,IAAIzL,OAAOiL,GAAGS,OAAO,CAClCC,MAAOjL,GAAG,eAEX,IAAI8Y,EAAOtZ,EAAEkF,KAAKqG,OAAO+N,MACzBA,EAAKW,KAAK,mGAGV/U,KAAKqG,OAAO6J,MAAQkE,EAAKI,KAAK,iBAC9BxU,KAAKqG,OAAOsnB,QAAUvZ,EAAKI,KAAK,YAEhC,IAAIzU,EAAKC,KACTA,KAAKqG,OAAOsnB,QAAQ1tB,GAAG,QAAS,mBAAoB,WACnDF,EAAGwR,SAASzW,EAAEkF,MAAM5E,KAAK,gBAG1B4E,KAAKqG,OAAO6J,MAAMjQ,GAAG,QAAS,WAC1BF,EAAG6tB,YACLC,aAAa9tB,EAAG6tB,YAEjB7tB,EAAG6tB,WAAaH,WAAW,WAC1B1tB,EAAGytB,eACHztB,EAAG6tB,gBAAa1iB,GACd,QAILqG,SAAU,SAAS5N,cAEdmqB,GAAQ,EAYZ,GATAhzB,EAAEqP,KAAKnK,KAAKG,IAAIjD,IAAIwM,OAAS,YAAKtH,EAAGvE,GACpC,GAAGA,EAAEmC,EAAKmG,cAAcxC,EAIvB,OAHA/I,OAAOsI,MAAMtE,UAAUf,EAAEC,QAASD,EAAE3C,KAAM,MAAO2C,EAAEmK,IAAM,GACzDpN,OAAOmzB,WAAW,CAAC3qB,QAAS9H,GAAG,kBAAmB,CAACqI,EAAW9F,EAAEmK,MAAOzG,UAAW,UAClFusB,GAAQ,GACD,KAILA,EAAO,CACV,IAAIjwB,EAAI,KACRjD,OAAO0W,aAAa,YACXzT,EAAImC,EAAK6I,KAAKmlB,iCAChBpzB,OAAOsI,MAAMtE,UAAUf,EAAEC,QAASD,EAAE3C,KAAM8E,EAAKmG,WAAYxC,sBAC3D/I,OAAOqzB,QAAQ,gBAEpBrzB,OAAOsI,MAAMtE,UAAUf,EAAEC,QAASD,EAAE3C,KAAM,MAAO,GACjDN,OAAOmzB,WAAW,CAAC3qB,QAAS9H,GAAG,kBAAmB,CAACqI,EAAW,IAAKpC,UAAW,eAOlFisB,aAAc,WACbtpB,IAAIvB,EAAO,CACV8E,MAAOzH,KAAKstB,WACZ5lB,QAAS,IAEV/E,EAAKurB,IAAMluB,KAAKqG,OAAO6J,MAAM+F,MAC7BtT,EAAKwrB,QAAU,EAEXnuB,KAAKouB,aACRtzB,EAAEU,OAAOmH,EAAK+E,QAAS1H,KAAKouB,eAAiB,IAG9C,IAAIruB,EAAKC,KACTpF,OAAOyzB,YAAY,OAAQ1rB,EAAM,SAASE,GACzC/H,EAAEqP,KAAKtH,EAAEyI,OAAQ,SAASlJ,EAAGvE,GACxBA,EAAEywB,QACLzwB,EAAE0wB,KAAO3zB,OAAO4zB,SAAS3wB,EAAE2N,WAC3B3N,EAAEyD,MAAQ1G,OAAO6zB,YAAY5wB,EAAE2N,cAGjCzL,EAAGsG,OAAOsnB,QAAQ5Y,KAAKna,OAAOoa,gBAAgB,gBAAiB,CAAC5O,KAAOvD,EAAEyI,eC1G5E1Q,OAAOC,QAAQ,0BAEf4C,IAAMixB,EAAU,4BAEhB9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,+CAKxC9zB,OAAO+zB,KAAKC,WAAW,aAAe,CACrC,CAAEloB,MAAO,WAAYmoB,IAAKH,EAAU,gEACpC,CAAEhoB,MAAO,cAAemoB,IAAKH,EAAU,mDAGxC9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,2BAA4BmoB,IAAKH,EAAU,0EACpD,CAAEhoB,MAAO,6CAA8CmoB,IAAKH,EAAU,0DACtE,CAAEhoB,MAAO,mBAAoBmoB,IAAKH,EAAU,oEAC5C,CAAEhoB,MAAO,UAAWmoB,IAAKH,EAAU,2DACnC,CAAEhoB,MAAO,WAAYmoB,IAAKH,EAAU,uDAGrC9zB,OAAO+zB,KAAKC,WAAW,wBAA0B,CAChD,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,uDAG1C9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,+BAAgCmoB,IAAKH,EAAU,mDACxD,CAAEhoB,MAAO,yCAA0CmoB,IAAKH,EAAU,8EAGnE9zB,OAAO+zB,KAAKC,WAAyB,aAAI,CACxC,CAAEloB,MAAO,2BAA4BmoB,IAAKH,EAAU,2EAGrD9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,oDACzC,CAAEhoB,MAAO,8CAA+CmoB,IAAKH,EAAU,mEAGxE9zB,OAAO+zB,KAAKC,WAAW,wBAA0B,CAChD,CAAEloB,MAAO,kBAAmBmoB,IAAKH,EAAU,uDAG5C9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,iDAGzC9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,mDAG1C9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,gDAGxC9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,qDAG7C9zB,OAAO+zB,KAAKC,WAAW,6BAA+B,CACrD,CAAEloB,MAAO,uBAAwBmoB,IAAKH,EAAU,yDAGjD9zB,OAAO+zB,KAAKC,WAAW,8BAAgC,CACtD,CAAEloB,MAAO,wBAAyBmoB,IAAKH,EAAU,0DAGlD9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,kDAG1C9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,kDAGzC9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,kDAGzC9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,iDAGzC9zB,OAAO+zB,KAAKC,WAAW,0BAA4B,CAClD,CAAEloB,MAAO,qBAAsBmoB,IAAKH,EAAU,kDAG/C9zB,OAAO+zB,KAAKC,WAAW,uBAAyB,CAC/C,CAAEloB,MAAO,iBAAkBmoB,IAAKH,EAAU,mDAG3C9zB,OAAO+zB,KAAKC,WAAW,wBAA0B,CAChD,CAAEloB,MAAO,uBAAwBmoB,IAAKH,EAAU,mDAGjD9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,mDAK1C9zB,OAAO+zB,KAAKC,WAAW,wBAA0B,CAChD,CAAEloB,MAAO,kBAAmBmoB,IAAKH,EAAU,8DAG5C9zB,OAAO+zB,KAAKC,WAAW,0BAA4B,CAClD,CAAEloB,MAAO,oBAAqBmoB,IAAKH,EAAU,gEAG9C9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,0DAG7C9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,4DAG1C9zB,OAAO+zB,KAAKC,WAAW,wBAA0B,CAChD,CAAEloB,MAAO,kBAAmBmoB,IAAKH,EAAU,8DAK5C9zB,OAAO+zB,KAAKC,WAAW,kBAAoB,CAC1C,CAAEloB,MAAO,YAAamoB,IAAKH,EAAU,oCACrC,CAAEhoB,MAAO,oBAAqBmoB,IAAKH,EAAU,qDAC7C,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,2EACxC,CAAEhoB,MAAO,kBAAmBmoB,IAAKH,EAAU,kDAG5C9zB,OAAO+zB,KAAKC,WAAW,iBAAmB,CACzC,CAAEloB,MAAO,WAAYmoB,IAAKH,EAAU,+BACpC,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,yCAGzC9zB,OAAO+zB,KAAKC,WAAW,iBAAmB,CACzC,CAAEloB,MAAO,WAAYmoB,IAAKH,EAAU,+BACpC,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,yCAGzC9zB,OAAO+zB,KAAKC,WAAW,yCAA2C,CACjE,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,+CAG7C9zB,OAAO+zB,KAAKC,WAAW,yCAA2C,CACjE,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,+CAG7C9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,sCACvC,CAAEhoB,MAAO,wBAAyBmoB,IAAKH,EAAU,yDACjD,CAAEhoB,MAAO,oBAAqBmoB,IAAKH,EAAU,sDAG9C9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,sCACvC,CAAEhoB,MAAO,wBAAyBmoB,IAAKH,EAAU,yDACjD,CAAEhoB,MAAO,oBAAqBmoB,IAAKH,EAAU,qDAC7C,CAAEhoB,MAAO,gBAAiBmoB,IAAKH,EAAU,iDACzC,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,2EACxC,CAAEhoB,MAAO,oBAAqBmoB,IAAKH,EAAU,qDAC7C,CAAEhoB,MAAO,kBAAmBmoB,IAAKH,EAAU,kDAG5C9zB,OAAO+zB,KAAKC,WAAW,uBAAyB,CAC/C,CAAEloB,MAAO,iBAAkBmoB,IAAKH,EAAU,gDAG3C9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,kDAK7C9zB,OAAO+zB,KAAKC,WAAW,iBAAmB,CACzC,CAAEloB,MAAO,WAAYmoB,IAAKH,EAAU,mCAGrC9zB,OAAO+zB,KAAKC,WAAW,iBAAmB,CACzC,CAAEloB,MAAO,WAAYmoB,IAAKH,EAAU,mCAGrC9zB,OAAO+zB,KAAKC,WAAW,8BAAgC,CACtD,CAAEloB,MAAO,wBAAyBmoB,IAAKH,EAAU,+CACjD,CAAEhoB,MAAO,YAAamoB,IAAKH,EAAU,iDAGtC9zB,OAAO+zB,KAAKC,WAAW,2BAA6B,CACnD,CAAEloB,MAAO,qBAAsBmoB,IAAKH,EAAU,6CAG/C9zB,OAAO+zB,KAAKC,WAAW,wBAA0B,CAChD,CAAEloB,MAAO,kBAAmBmoB,IAAKH,EAAU,gDAG5C9zB,OAAO+zB,KAAKC,WAAW,uBAAyB,CAC/C,CAAEloB,MAAO,iBAAkBmoB,IAAKH,EAAU,wCAC1C,CAAEhoB,MAAO,2BAA4BmoB,IAAKH,EAAU,0DAGrD9zB,OAAO+zB,KAAKC,WAAW,uBAAyB,CAC/C,CAAEloB,MAAO,iBAAkBmoB,IAAKH,EAAU,wCAC1C,CAAEhoB,MAAO,WAAYmoB,IAAKH,EAAU,+DACpC,CAAEhoB,MAAO,qBAAsBmoB,IAAKH,EAAU,wEAC9C,CAAEhoB,MAAO,2BAA4BmoB,IAAKH,EAAU,yDACpD,CAAEhoB,MAAO,iBAAkBmoB,IAAKH,EAAU,gDAG3C9zB,OAAO+zB,KAAKC,WAAW,4CAA8C,CACpE,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,+CAG7C9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,0CAGxC9zB,OAAO+zB,KAAKC,WAAW,mBAAqB,CAC3C,CAAEloB,MAAO,aAAcmoB,IAAKH,EAAU,0CAGvC9zB,OAAO+zB,KAAKC,WAAW,2BAA6B,CACnD,CAAEloB,MAAO,qBAAsBmoB,IAAKH,EAAU,iDAG/C9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,0CAGzC9zB,OAAO+zB,KAAKC,WAAW,6BAA+B,CACrD,CAAEloB,MAAO,uBAAwBmoB,IAAKH,EAAU,2EAGjD9zB,OAAO+zB,KAAKC,WAAW,kBAAoB,CAC1C,CAAEloB,MAAO,YAAamoB,IAAKH,EAAU,wCAGtC9zB,OAAO+zB,KAAKC,WAAW,uBAAyB,CAC/C,CAAEloB,MAAO,iBAAkBmoB,IAAKH,EAAU,iDAC1C,CAAEhoB,MAAO,4BAA6BmoB,IAAKH,EAAU,kEAGtD9zB,OAAO+zB,KAAKC,WAAW,iBAAmB,CACzC,CAAEloB,MAAO,WAAYmoB,IAAKH,EAAU,wCAGrC9zB,OAAO+zB,KAAKC,WAAW,gBAAkB,CACxC,CAAEloB,MAAO,UAAWmoB,IAAKH,EAAU,2CACnC,CAAEhoB,MAAO,8BAA+BmoB,IAAKH,EAAU,kEACvD,CAAEhoB,MAAO,gDAAiDmoB,IAAKH,EAAU,qFAK1E9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,2BAA4BmoB,IAAKH,EAAU,4BACpD,CAAEhoB,MAAO,oBAAqBmoB,IAAKH,EAAU,kDAC7C,CAAEhoB,MAAO,4BAA6BmoB,IAAKH,EAAU,sDAGtD9zB,OAAO+zB,KAAKC,WAAW,gBAAkB,CACxC,CAAEloB,MAAO,oBAAqBmoB,IAAKH,EAAU,6CAC7C,CAAEhoB,MAAO,uBAAwBmoB,IAAKH,EAAU,uEAGjD9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,yCACzC,CAAEhoB,MAAO,2BAA4BmoB,IAAKH,EAAU,4CACpD,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,qCACxC,CAAEhoB,MAAO,0BAA2BmoB,IAAKH,EAAU,0DAGpD9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,yCACzC,CAAEhoB,MAAO,2BAA4BmoB,IAAKH,EAAU,4CACpD,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,qCACxC,CAAEhoB,MAAO,0BAA2BmoB,IAAKH,EAAU,0DAGpD9zB,OAAO+zB,KAAKC,WAAgB,IAAI,CAC/B,CAAEloB,MAAO,wBAAyBmoB,IAAKH,EAAU,sDAGlD9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,wBAAyBmoB,IAAKH,EAAU,0CAGlD9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,4CAC5C,CAAEhoB,MAAO,2BAA4BmoB,IAAKH,EAAU,4CACpD,CAAEhoB,MAAO,6BAA8BmoB,IAAKH,EAAU,0DAGvD9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,yCACzC,CAAEhoB,MAAO,wBAAyBmoB,IAAKH,EAAU,iDACjD,CAAEhoB,MAAO,2BAA4BmoB,IAAKH,EAAU,6CAGrD9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,0CAG1C9zB,OAAO+zB,KAAKC,WAAW,wBAA0B,CAChD,CAAEloB,MAAO,kBAAmBmoB,IAAKH,EAAU,4CAG5C9zB,OAAO+zB,KAAKC,WAAW,cAAgB,CACtC,CAAEloB,MAAO,wBAAyBmoB,IAAKH,EAAU,kDAGlD9zB,OAAO+zB,KAAKC,WAAW,uBAAyB,CAC/C,CAAEloB,MAAO,iBAAkBmoB,IAAKH,EAAU,kDAG3C9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,YAAamoB,IAAKH,EAAU,sCAGtC9zB,OAAO+zB,KAAKC,WAAW,aAAe,CACrC,CAAEloB,MAAO,OAAQmoB,IAAKH,EAAU,6BAChC,CAAEhoB,MAAO,aAAcmoB,IAAKH,EAAU,wCACtC,CAAEhoB,MAAO,UAAWmoB,IAAKH,EAAU,2DACnC,CAAEhoB,MAAO,qBAAsBmoB,IAAKH,EAAU,8CAC9C,CAAEhoB,MAAO,wBAAyBmoB,IAAKH,EAAU,iDACjD,CAAEhoB,MAAO,oBAAqBmoB,IAAKH,EAAU,+CAC7C,CAAEhoB,MAAO,gBAAiBmoB,IAAKH,EAAU,2CACzC,CAAEhoB,MAAO,iBAAkBmoB,IAAKH,EAAU,qEAG3C9zB,OAAO+zB,KAAKC,WAAW,aAAe,CACrC,CAAEloB,MAAO,OAAQmoB,IAAKH,EAAU,6BAChC,CAAEhoB,MAAO,aAAcmoB,IAAKH,EAAU,wCACtC,CAAEhoB,MAAO,UAAWmoB,IAAKH,EAAU,2DACnC,CAAEhoB,MAAO,qBAAsBmoB,IAAKH,EAAU,8CAC9C,CAAEhoB,MAAO,wBAAyBmoB,IAAKH,EAAU,iDACjD,CAAEhoB,MAAO,oBAAqBmoB,IAAKH,EAAU,+CAC7C,CAAEhoB,MAAO,gBAAiBmoB,IAAKH,EAAU,2CACzC,CAAEhoB,MAAO,iBAAkBmoB,IAAKH,EAAU,qEAG3C9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,yCAC5C,CAAEhoB,MAAO,UAAWmoB,IAAKH,EAAU,4DAGpC9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,sCACzC,CAAEhoB,MAAO,UAAWmoB,IAAKH,EAAU,2DACnC,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,sCAGzC9zB,OAAO+zB,KAAKC,WAAW,sBAAwB,CAC9C,CAAEloB,MAAO,gBAAiBmoB,IAAKH,EAAU,sCACzC,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,qCACxC,CAAEhoB,MAAO,UAAWmoB,IAAKH,EAAU,2DACnC,CAAEhoB,MAAO,iBAAkBmoB,IAAKH,EAAU,gDAG3C9zB,OAAO+zB,KAAKC,WAAW,0BAA4B,CAClD,CAAEloB,MAAO,oBAAqBmoB,IAAKH,EAAU,2CAI9C9zB,OAAO+zB,KAAKC,WAAiB,KAAI,CAChC,CAAEloB,MAAO,kCAAmCmoB,IAAKH,EAAU,uEAG5D9zB,OAAO+zB,KAAKC,WAAW,eAAiB,CACvC,CAAEloB,MAAO,YAAamoB,IAAKH,EAAU,sCAKtC9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,yCAC5C,CAAEhoB,MAAO,oCAAqCmoB,IAAKH,EAAU,oEAG9D9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,yCAC5C,CAAEhoB,MAAO,oCAAqCmoB,IAAKH,EAAU,oEAG9D9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,oCACvC,CAAEhoB,MAAO,oBAAqBmoB,IAAKH,EAAU,qDAC7C,CAAEhoB,MAAO,eAAgBmoB,IAAKH,EAAU,8CACxC,CAAEhoB,MAAO,gBAAiBmoB,IAAKH,EAAU,sCACzC,CAAEhoB,MAAO,iBAAkBmoB,IAAKH,EAAU,gDAG3C9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,qCAGxC9zB,OAAO+zB,KAAKC,WAAW,kBAAoB,CAC1C,CAAEloB,MAAO,YAAamoB,IAAKH,EAAU,mCAGtC9zB,OAAO+zB,KAAKC,WAAW,kBAAoB,CAC1C,CAAEloB,MAAO,YAAamoB,IAAKH,EAAU,mCAGtC9zB,OAAO+zB,KAAKC,WAAW,kBAAoB,CAC1C,CAAEloB,MAAO,YAAamoB,IAAKH,EAAU,mCAGtC9zB,OAAO+zB,KAAKC,WAAW,cAAgB,CACtC,CAAEloB,MAAO,QAASmoB,IAAKH,EAAU,+BAGlC9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,4CAGzC9zB,OAAO+zB,KAAKC,WAAW,2BAA6B,CACnD,CAAEloB,MAAO,qBAAsBmoB,IAAKH,EAAU,kDAG/C9zB,OAAO+zB,KAAKC,WAAW,4BAA8B,CACpD,CAAEloB,MAAO,sBAAuBmoB,IAAKH,EAAU,mDAGhD9zB,OAAO+zB,KAAKC,WAAW,mBAAqB,CAC3C,CAAEloB,MAAO,aAAcmoB,IAAKH,EAAU,0CAGvC9zB,OAAO+zB,KAAKC,WAAW,uBAAyB,CAC/C,CAAEloB,MAAO,iBAAkBmoB,IAAKH,EAAU,8CAG3C9zB,OAAO+zB,KAAKC,WAAW,YAAc,CACpC,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,4DAG7C9zB,OAAO+zB,KAAKC,WAAW,6BAA+B,CACrD,CAAEloB,MAAO,sBAAuBmoB,IAAKH,EAAU,uCAKhD9zB,OAAO+zB,KAAKC,WAAW,aAAe,CACrC,CAAEloB,MAAO,OAAQmoB,IAAKH,EAAU,4BAGjC9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,mCAGxC9zB,OAAO+zB,KAAKC,WAAW,gBAAkB,CACxC,CAAEloB,MAAO,UAAWmoB,IAAKH,EAAU,+BAGpC9zB,OAAO+zB,KAAKC,WAAW,gBAAkB,CACxC,CAAEloB,MAAO,UAAWmoB,IAAKH,EAAU,+BAGpC9zB,OAAO+zB,KAAKC,WAAW,mBAAqB,CAC3C,CAAEloB,MAAO,aAAcmoB,IAAKH,EAAU,kCAGvC9zB,OAAO+zB,KAAKC,WAAW,iBAAmB,CACzC,CAAEloB,MAAO,WAAYmoB,IAAKH,EAAU,sCAGrC9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,0CAGzC9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,sBAAuBmoB,IAAKH,EAAU,gEAKhD9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,2DAG7C9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,uDAG7C9zB,OAAO+zB,KAAKC,WAAW,yBAA2B,CACjD,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,uDAK7C9zB,OAAO+zB,KAAKC,WAAW,YAAc,CACpC,CAAEloB,MAAO,mBAAoBmoB,IAAKH,EAAU,kDAC5C,CAAEhoB,MAAO,uBAAwBmoB,IAAKH,EAAU,+DAGjD9zB,OAAO+zB,KAAKC,WAAW,mBAAqB,CAC3C,CAAEloB,MAAO,aAAcmoB,IAAKH,EAAU,4CAGvC9zB,OAAO+zB,KAAKC,WAAW,oBAAsB,CAC5C,CAAEloB,MAAO,cAAemoB,IAAKH,EAAU,6CAGxC9zB,OAAO+zB,KAAKC,WAAW,kBAAoB,CAC1C,CAAEloB,MAAO,YAAamoB,IAAKH,EAAU,2CAGtC9zB,OAAO+zB,KAAKC,WAAW,wBAA0B,CAChD,CAAEloB,MAAO,kBAAmBmoB,IAAKH,EAAU,uDAK5C9zB,OAAO+zB,KAAKC,WAAW,uBAAyB,CAC/C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,iDACxC,CAAEhoB,MAAO,kBAAmBmoB,IAAKH,EAAU,oDAG5C9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,kDAGzC9zB,OAAO+zB,KAAKC,WAAW,qBAAuB,CAC7C,CAAEloB,MAAO,eAAgBmoB,IAAKH,EAAU,kDC5gBzC9zB,OAAOC,QAAQ,eAEfi0B,YAAYC,YAAc,MACzBC,YAAY/oB,cACXzH,OAAOywB,OAAOjvB,KAAMiG,GAEpBrL,OAAOoyB,QAAQ,kDACdhtB,EAAKkvB,WACLlvB,EAAKmvB,YACLnvB,EAAKovB,cACLpvB,EAAKqvB,YACLrvB,EAAKsvB,oBACLtvB,EAAKuvB,cACLvvB,EAAKwvB,cAIPR,WACChvB,KAAKyvB,KAAO30B,EAAE,kCACdA,EAAEkF,KAAKypB,QAAQiG,OAAO1vB,KAAKyvB,MAG5BT,YACChvB,KAAK2vB,MAAQ,IAAIC,KAAK5vB,KAAKyvB,KAAKI,IAAI,IAGrCb,cACChvB,KAAK8vB,OAAS,CACbC,cAAe,IACfC,QAAS,GACTC,YAAa,EACbC,OAAQt1B,OAAOiL,GAAGvE,MAAMuuB,IAAI,UAE7B7vB,KAAK8vB,OAAOK,eAAiBnwB,KAAK8vB,OAAOC,cAAgB,IACzD,MAA0D/vB,KAAK8vB,wDAE/D9vB,KAAKowB,OAAS,CACbC,KAAM,CACLC,OAAQ,CACPC,EAAIC,EAAIZ,KAAKa,IAAI,IAAKF,EACtBA,EAAGA,EAAIC,EAAIZ,KAAKa,IAAI,IACpBF,EAAIC,EAAGD,EAAIC,EAAIZ,KAAKa,IAAI,KAEzBnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,UAE5Ba,WAAY,CACXJ,OAAQ,CACPC,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,KAEtCnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,SAE5Be,WAAY,CACXN,OAAQ,CACPC,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,KAAOE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACpEF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAI,IAAMA,EAAIf,KAAKa,IAAI,IAAKF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,IAAME,EAAIf,KAAKa,IAAI,IACvFF,EAAI,GAAaI,EAAI,IAAMA,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,IAAME,EAAIf,KAAKa,IAAI,KAEjGnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,OAAQ,UAEpCgB,KAAM,CACLP,OAAQ,CACPC,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAKF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,KAAOE,EAAIf,KAAKa,IAAI,IACzFF,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAM,KAAOE,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,KAAOE,EAAIf,KAAKa,IAAI,IACpGF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,KAAOE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACpEF,EAAI,GAAaI,EAAI,IAAMA,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,IAAME,EAAIf,KAAKa,IAAI,IAChGF,EAAI,GAAaI,EAAI,IAAMA,EAAIf,KAAKa,IAAI,IAAKF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,IAAME,EAAIf,KAAKa,IAAI,KAExFnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,UAE5BiB,UAAW,CACVR,OAAQ,CACPC,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,KAAOI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAKF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,KAAOE,EAAIf,KAAKa,IAAI,IACzFF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IACpEF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,KAAeI,EAAIf,KAAKa,IAAI,KAElEnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,QAAS,SAErCkB,KAAM,CACLT,OAAQ,CACPC,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,KAAeI,EAAIf,KAAKa,IAAI,IACjEF,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IACpEF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAIC,EAAGD,EAAIC,EAAIZ,KAAKa,IAAI,KAEzBnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,UAE5BmB,gBAAiB,CAChBV,OAAQ,CACPC,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IACrDF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,KAAOI,EAAIf,KAAKa,IAAI,IAClEF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,KAAOI,EAAIf,KAAKa,IAAI,KAE1DnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,OAAQ,SAEpCoB,WAAY,CACXX,OAAQ,CACPC,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IACrDF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,KAEtDnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,SAE5BqB,UAAW,CACVZ,OAAQ,CACPC,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,KAAOI,EAAIf,KAAKa,IAAI,IAClEF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,KAAOI,EAAIf,KAAKa,IAAI,KAEnEnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,QAAS,UAErCsB,gBAAiB,CAChBb,OAAQ,CACPC,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IAClEF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,KAAOE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACpEF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,KAAOI,EAAIf,KAAKa,IAAI,KAEnEnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,OAAQ,SAEpCuB,WAAY,CACXd,OAAQ,CACPC,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,KAEnEnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,QAE5BwB,KAAM,CACLf,OAAQ,CACPC,EAAIC,EAAIZ,KAAKa,IAAI,IAAKF,EACtBA,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,KAEtDnvB,MAAO1G,OAAOiL,GAAGvE,MAAMuuB,IAAI,YAK9Bb,WAAWsC,GACV,OAAOtxB,KAAKowB,OAAOkB,GAAWhB,OAG/BtB,UAAUsC,GACT,OAAOtxB,KAAKowB,OAAOkB,GAAWhwB,MAG/B0tB,YACC,IAAK9qB,IAAIotB,KAAatxB,KAAKowB,OAC1BpwB,KAAK2vB,MAAM4B,QAAQvxB,KAAKwxB,WAAWF,IAAYl2B,KAAK,CACnDq2B,KAAMzxB,KAAK0xB,UAAUJ,GACrBpB,OAAQlwB,KAAK8vB,OAAOI,OACpBD,YAAajwB,KAAK8vB,OAAOG,cAK5BjB,oBACC,MAA0DhvB,KAAK8vB,sDAEpD9vB,KAAK2vB,MAAMhZ,KAAK6Z,EAAIZ,KAAKa,IAAI,IAAM,EAAGF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,EAAGn1B,GAAG,SAASF,KAAK,CAC3Fq2B,KAAM72B,OAAOiL,GAAGvE,MAAMuuB,IAAI,WAEtB8B,UAAU,QAEJ3xB,KAAK2vB,MAAMhZ,KAAK6Z,EAAGD,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,EAAGn1B,GAAG,SAASF,KAAK,CACxEq2B,KAAM72B,OAAOiL,GAAGvE,MAAMuuB,IAAI,WAEtB8B,UAAU,OAEJ3xB,KAAK2vB,MAAMhZ,KAAK,GAAK6Z,EAAIZ,KAAKa,IAAI,IAAK,GAAKD,EAAIZ,KAAKa,IAAI,IAAKn1B,GAAG,SAASF,KAAK,CACzFq2B,KAAM72B,OAAOiL,GAAGvE,MAAMuuB,IAAI,WAEtB8B,UAAU,MAGhB3C,cAEC9qB,IAAIU,EAAQ,EACRgtB,EAAS,EACTC,GAAY,EAChB,IAAK3tB,IAAIotB,KAAatxB,KAAKowB,OAAQ,CAC9BxrB,EAAQ,GAAKitB,IAChBD,EAAS,IACThtB,EAAQ,EACRitB,GAAY,GAEF7xB,KAAK2vB,MAAMmC,KAAK,EAAEF,EAAQ,EAAQ,GAANhtB,EAAU,IAAK,GAAI,EAAG,GAAGxJ,KAAK,CACpEq2B,KAAMzxB,KAAK0xB,UAAUJ,GACrBpB,OAAQt1B,OAAOiL,GAAGvE,MAAMuuB,IAAI,WAElB7vB,KAAK2vB,MAAMhZ,KAAK,EAAEib,EAAQ,GAAS,GAANhtB,EAAU0sB,GAAWl2B,KAAK,CACjEq2B,KAAM72B,OAAOiL,GAAGvE,MAAMuuB,IAAI,SAC1BkC,YAAa,KAEdntB,KAIFoqB,UAAUrpB,kBAAqB3F,qCAC9B,GAAIqxB,EAAOhB,EAAOU,GAAQ,EAAE,CAC3B,MAA0D/wB,KAAK8vB,wDAE3DkC,EAASzB,EAAIc,EAAOV,EAAIf,KAAKa,IAAI,IAAMM,EAAOJ,EAC9CsB,EAAS1B,EAAIQ,EAAOJ,EAAIf,KAAKa,IAAI,IAAMJ,EAAOM,EAAIf,KAAKsC,IAAI,IAC/DlyB,KAAKmyB,KAAOnyB,KAAK2vB,MAAMyC,OAAOJ,EAAQC,EAAQ,GAAG72B,KAAK,CACrDq2B,KAAM72B,OAAOiL,GAAGvE,MAAMuuB,IAAI,UAC1BK,OAAQt1B,OAAOiL,GAAGvE,MAAMuuB,IAAI,UAC5BI,YAAa,KAKhBjB,mBAC0B,IAAdhvB,KAAKmyB,MACfnyB,KAAKmyB,KAAK1M,qLCrOb7qB,OAAOC,QAAQ,kBAEfD,OAAOiL,GAAGC,KAAKusB,mBAAqBz3B,OAAOiL,GAAGC,KAAKwsB,eAAe92B,OAAO,CACxE6xB,KAAM,SAASvvB,EAASy0B,GACvBvyB,KAAKsgB,OAAOxiB,EAASy0B,IAGtBC,cAAe,WACdxyB,KAAKyyB,UAAYzyB,KAAK0yB,qBAAqBC,OAAO3yB,KAAKyyB,WACvDzyB,KAAKyyB,UAAYzyB,KAAKyyB,UAAUE,OAAO3yB,KAAK4yB,yBAC5C5yB,KAAKsgB,SACLtgB,KAAK6yB,qCACL7yB,KAAK8yB,6BACL9yB,KAAKqG,OAAOvG,SAAS0U,KAAK,cAAcmC,KAAKrb,GAAG,8EAGjDu3B,mCAAoC,WACnC7yB,KAAKqG,OAAOnI,YAAY60B,eAAejzB,SAAS4vB,OAAO90B,OAAOoa,gBAAgB,qBAC9EhV,KAAKgzB,kCACLhzB,KAAKizB,iCAELjzB,KAAKkzB,6BACLlzB,KAAKqG,OAAO4a,UAAU,iBAAiBtY,GAAG7B,OAAS,EACnD9G,KAAKqG,OAAO4a,UAAU,iBAAiBnY,WAGxCqqB,wBAAyB,WACxB,IAAIpzB,EAAKC,KACTA,KAAKqG,OAAOsO,mBAAmBrZ,GAAG,QAAS,WAC1C,IAAIyE,EAAGsG,OAAO+sB,QAAd,CAEA,IAAIhtB,EAAOrG,EAAGsG,OAAOuB,aACjByrB,EAAiB,GAWrB,GATItzB,EAAGsG,OAAOnI,YAAYo1B,eAAeC,OAAOC,KAAK,aACpDH,EAAiBtzB,EAAG0zB,kBACfj1B,OAAOC,KAAK40B,GAAgB10B,SAChCyH,EAAO,MAERitB,EAAerO,UAAYjlB,EAAG2zB,aAAa1O,UAC3CqO,EAAenJ,WAAanqB,EAAG2zB,aAAaxJ,YAGzC9jB,EAAM,CACTrG,EAAGsG,OAAO+sB,SAAU,EACpB,IAAI9nB,EAASvL,EAAG4zB,aAE0B,gBAAtCN,EAAiC,mBACpC/nB,EAAyB,iBAAI,gBAE9BxQ,EAAEU,OAAO63B,EAAgB/nB,GACzBvL,EAAG6zB,OAAOP,QAKbO,OAAQ,SAASP,GAChBnvB,IAAInE,EAAKC,KACT,OAAO,IAAI6zB,iBAAQC,GAClBl5B,OAAO6H,KAAK,CACXC,OAAQ,uBACRC,KAAM,CACLzF,IAAKm2B,GAEN7wB,SAAU,SAASK,GAClB9C,EAAGsG,OAAOkC,OAEV3N,OAAOsI,MAAM6wB,UAAUh0B,EAAGsG,OAAOnJ,IAAIY,QAASiC,EAAGsG,OAAOnJ,IAAIhC,MAC5D6E,EAAGsG,OAAOnJ,IAAM2F,EAAEO,QACdxI,OAAOo5B,WACVp5B,OAAOiL,GAAGC,KAAKmuB,oBAAoBl0B,EAAGsG,OAAOnJ,KAEzC6C,EAAGwyB,aACNxyB,EAAGwyB,aAAaxyB,EAAGsG,OAAOnJ,KAE1B6C,EAAGm0B,yBAINC,MAAO,WACNp0B,EAAGq0B,YAEJ3J,OAAQ,WACP1qB,EAAGsG,OAAO+sB,SAAU,EACpBU,EAAQ/zB,EAAGsG,OAAOnJ,MAEnB8F,QAAQ,OAKXoxB,SAAU,WAGT,GAFAp0B,KAAKqG,OAAOkC,OACZvI,KAAK2zB,aACD3zB,KAAKqG,OAAOnI,YAAYo1B,eAAeC,OAAOC,KAAK,WAAY,CAClE,IAAIa,EAAWr0B,KAAKqG,OAAOnI,YAAYo2B,cAAcpkB,MAAMvL,MACvD0vB,GACHz5B,OAAOyI,UAAU,OAAQrD,KAAKlC,QAASu2B,QAExCz5B,OAAOyI,UAAU,OAAQrD,KAAKlC,QAASkC,KAAK9C,IAAIhC,OAIlDw3B,mBAAoB,WAqBnB,MApBqB,CAAC,CACrBxwB,UAAW,iBACXuE,UAAW,QACXC,MAAOpL,GAAG,mBAEX,CACC4G,UAAW,gBACXwE,MAAOpL,GAAG,iBACV0U,KAAM,EACNvJ,UAAW,OACXzB,QAAS,OACTuC,UAAW,WACV,MAAO,CACNG,QAAS,CACR6sB,aAAgB,QASrBC,yBAA0B,WAezB,OAdAx0B,KAAKy0B,oBAAsB,CAAC,CAC3BhuB,UAAW,OACXzB,QAAS,eACT0B,MAAO,eACPxE,UAAW,eACX4E,OAAQ,EACRkJ,KAAM,GACJ,CACFvJ,UAAW,OACXC,MAAO,2BACPxE,UAAW,uBACX4E,OAAQ,EACRkJ,KAAM,IAEAhQ,KAAKy0B,qBAGb7B,sBAAuB,WACtB,IAAI8B,EAAmB,CAAC,CACvBxyB,UAAW,iBACXuE,UAAW,SAIZ,OADAiuB,EAAmBA,EAAiB/B,OAAO3yB,KAAKw0B,6BAIjDxB,gCAAiC,WAChC,IAAIjzB,EAAKC,KAETA,KAAKqG,OAAOnI,YAAYo1B,eAAeC,OAAOtzB,GAAG,QAAS,WACzDF,EAAG+yB,6BACH/yB,EAAG40B,uCAAsC,EAAO,IAAI,MAItD7B,2BAA4B,sBACvB8B,EAAc50B,KAAKqG,OAAOc,UAAU,kBAGpC0tB,EAAiB70B,KAAKqG,OAAO4a,UAAU,iBAC3C4T,EAAelsB,GAAGqH,KAAO4kB,EACzBC,EAAej2B,UAAU,IACzBi2B,EAAelsB,GAAG7B,QAAU8tB,EAC5BC,EAAe/rB,UAGf,CAAC,YAAa,YAAa,aAAc,aAAarI,iBAAS5C,GAC9DqG,IAAI8V,EAAIha,EAAKqG,OAAO4a,UAAUpjB,GAC9Bmc,EAAErR,GAAG7B,OAAS8tB,EACd5a,EAAElR,YAGH9I,KAAKqG,OAAO4a,UAAU,kBAAkB6T,QAAO,GAG/C,CAAC,YAAa,YAAa,cAAcr0B,iBAAS5C,GACjDqG,IAAI8V,EAAIha,EAAKqG,OAAO4a,UAAUpjB,GAC9Bmc,EAAErR,GAAGqH,MAAQ4kB,EACb5a,EAAElR,aAKJmqB,+BAAgC,WAC/B,IAAIlzB,EAAKC,KAETD,EAAGsG,OAAOnI,YAA2B,cAAEyK,GAAGzB,oBACzC,IAAImtB,EAAWt0B,EAAGsG,OAAOnI,YAAYo2B,cAAcpkB,MAAMvL,MACzD5E,EAAG2zB,aAAe,KACdW,EACHz5B,OAAO6H,KAAK,CACXC,OAAQ,oBACRC,KAAM,CACL7E,QAAS,OACT5C,KAAMm5B,GAEP7xB,SAAU,SAASK,GAClB9C,EAAG2zB,aAAe7wB,EAAEO,QACpBrD,EAAGg1B,iBAAkB,EAEoB,iBAArCh1B,EAAG2zB,aAAasB,iBACnBj1B,EAAG40B,uCAAsC,EAAM,IAAI,IAGnD50B,EAAG40B,uCAAsC,EAAO50B,EAAG2zB,aAAauB,YAAY,GAC5El1B,EAAGm1B,kBAAkBn1B,EAAG2zB,aAAauB,iBAKxCl1B,EAAGsG,OAAO4a,UAAU,kBAAkB6T,QAAO,GAC7C/0B,EAAG40B,uCAAsC,EAAO,IAAI,MAKvDA,sCAAuC,SAASI,EAAiBE,EAAYE,GAC5En1B,KAAKi1B,WAAaA,EAClBj1B,KAAKo1B,iBAAmB,GACxBp1B,KAAKq1B,iBAAmBJ,EAAWt2B,OAEnCqB,KAAKqG,OAAOnI,YAAY60B,eAAejzB,SAAS0U,KAAK,eAAeM,QACpE9U,KAAK+0B,gBAAkBA,EACvB/0B,KAAKkzB,6BACLlzB,KAAKqG,OAAOnI,YAAY60B,eAAejzB,SAAS0U,KAAK,eAAe8gB,YAAY,eAAgBH,GAChGn1B,KAAKqG,OAAOnI,YAAY60B,eAAejzB,SAAS0U,KAAK,sBAAsB8gB,YAAY,eAAgBH,IAGxGjC,2BAA4B,WAC3B,IAAInzB,EAAKC,KACTlF,EAAEqP,KAAKnK,KAAKy0B,oBAAqB,SAASryB,EAAGmzB,GAC5Cx1B,EAAGsG,OAAO4a,UAAUsU,EAAarzB,WAAWyG,GAAG7B,QAAU/G,EAAGg1B,gBAC5Dh1B,EAAGsG,OAAO4a,UAAUsU,EAAarzB,WAAWyG,GAAGqH,KAAiC,gBAA1BulB,EAAarzB,WAA8BnC,EAAGg1B,gBACpGh1B,EAAGsG,OAAO4a,UAAUsU,EAAarzB,WAAW4G,aAI9C0sB,2BAA4B,WAC3Bx1B,KAAKqG,OAAOnI,YAAY60B,eAAejzB,SAAS0U,KAAK,eAAeM,QACpE9U,KAAKk1B,kBAAkBl1B,KAAKi1B,aAG7BC,kBAAmB,SAASD,GAC3B,IAAIl1B,EAAKC,KAETA,KAAKqG,OAAO4a,UAAU,kBAAkB6T,QAAO,GAE/Ch6B,EAAEqP,KAAK8qB,EAAY,SAASrwB,EAAOkD,GAClC,IAAI2tB,EAAO,GACPhvB,EAAY,OACZqB,EAAI4tB,iBACPjvB,EAAY,QACZgvB,EAAO,cAAgB3tB,EAAI6tB,WAAa,iBAAmB7tB,EAAI8tB,SAAW,uBAAyB9tB,EAAI+tB,WAGxG91B,EAAG+1B,kBAAkBrvB,EAAWqB,GAChC/H,EAAG+H,EAAIiuB,WAAWn3B,UAAUmB,EAAGq1B,iBAAiBttB,EAAIiuB,YAAc,IAClEh2B,EAAG+H,EAAIiuB,WAAWj2B,SAASw1B,YAAY,aAAav1B,EAAGq1B,iBAAiBttB,EAAIiuB,YAG5Ej7B,EAAEiF,EAAG+H,EAAIiuB,WAAWC,YAAYrf,KAAKrb,GAAGwM,EAAIiuB,YAExCN,GACH36B,EAAE+a,KAAK,8DAA+D,CACrE4f,KAAQA,KACLQ,YAAYl2B,EAAG+H,EAAIiuB,WAAWG,YAG9BpuB,EAAI4tB,eAGR31B,EAAG+H,EAAIiuB,WAAWxC,OAAOtzB,GAAG,SAAU,WACrCF,EAAGq1B,iBAAiBttB,EAAIiuB,WAAaj7B,EAAEkF,MAAMiW,MAC7Cnb,EAAEkF,MAAMm2B,QAAQ,mBAAmBb,YAAY,aAAax6B,EAAEkF,MAAMiW,SAJrElW,EAAGq2B,+BAA+BtuB,MAUrCguB,kBAAmB,SAASrvB,EAAWqB,GACtC9H,KAAK8H,EAAIiuB,WAAan7B,OAAOiL,GAAGC,KAAKuwB,aAAa,CACjD1tB,GAAI,CACHlC,UAAaA,EACbC,MAASoB,EAAIiuB,UACb7zB,UAAa4F,EAAIiuB,UACjB/wB,QAAW8C,EAAI9C,SAAW,IAE3BykB,OAAQ3uB,EAAEkF,KAAKqG,OAAOnI,YAAY60B,eAAe7J,SAAS1U,KAAK,eAC/D8hB,YAAY,IAEbt2B,KAAK8H,EAAIiuB,WAAWQ,cAGrBH,+BAAgC,SAAStuB,GACxC,IAAI/H,EAAKC,KAETA,KAAK8H,EAAIiuB,WAAW7lB,MAAMsmB,YAAc,IAAIC,YAAYz2B,KAAK8H,EAAIiuB,WAAW7lB,MAAO,CAClFwmB,SAAU,EACVC,SAAU,GACVC,WAAW,EACXC,KAAM,KAGP72B,KAAK8H,EAAIiuB,WAAWxC,OAAOtzB,GAAG,QAAS,SAASuH,GAC/C5M,OAAO6H,KAAK,CACXC,OAAQ,yBACRC,KAAM,CACL7E,QAAS,uBACT4J,QAAS,CACR,CAAC,SAAU,IAAK5M,EAAE0M,EAAEwD,QAAQ5P,KAAK,mBACjC,CAAC,kBAAmB,OAAQoM,EAAEwD,OAAOrG,MAAQ,MAE9C6B,OAAQ,CAAC,mBACTijB,OAAQ,kBAETjnB,SAAU,SAASK,GACdA,EAAEO,UACLoE,EAAEwD,OAAOwrB,YAAYK,KAAOh0B,EAAEO,QAAQrF,IAAI,SAASF,GAClD,OAAOA,EAAEi5B,wBAKX72B,GAAG,QAAS,SAASuH,GACvB1M,EAAE0M,EAAEwD,QAAQiL,IAAI,IAAI9N,QAAQ,WAC1BlI,GAAG,oBAAqB,SAAUuH,GACpCzH,EAAGq1B,iBAAiBt6B,EAAE0M,EAAEwD,QAAQ5P,KAAK,mBAAqBoM,EAAEwD,OAAOrG,MACnE7J,EAAE0M,EAAEwD,QAAQmrB,QAAQ,mBAAmBb,YAAY,aAAa9tB,EAAEwD,OAAOrG,UAI3E8uB,gBAAiB,WAChB,IAAI1zB,EAAKC,KACL+2B,EAAc,GACdhB,EAAY/1B,KAAKg3B,gCAgCrB,OA9BIx4B,OAAOC,KAAKs3B,GAAWp3B,QAC1B/D,OAAO6H,KAAK,CACXC,OAAQ,sEACRC,KAAM,CACL0xB,SAAYt0B,EAAGsG,OAAOnI,YAAYo2B,cAAcf,OAAOtd,MACvDtT,KAAMozB,GAEPkB,OAAO,EACPz0B,SAAU,SAASK,GAClB,GAAiD,mBAA7CrE,OAAO04B,UAAUC,SAAS10B,KAAKI,EAAEO,SACpC2zB,EAAcl0B,EAAEO,YACV,CACN,IAAIg0B,EAAkBx8B,OAAO6P,SAASnP,GAAG,uDAAwD,CAACua,KAAK,0FACrF,CAChBzJ,KAAMvJ,EAAEO,aAGVg0B,EAAgBt3B,SAAS0U,KAAK,kBAAkBvU,GAAG,QAAS,WAC3Dm3B,EAAgB7uB,OAChBxI,EAAGsG,OAAOkC,OACN3N,OAAOo5B,WACVp5B,OAAOo5B,WAAWp1B,UAAU9D,EAAEkF,MAAM5E,KAAK,mBAEzCR,OAAOyI,UAAU,OAAQ,OAAQvI,EAAEkF,MAAM5E,KAAK,yBAO7C27B,GAGRC,8BAA+B,WAC9B,IAAIj3B,EAAKC,KACL+1B,EAAY,GACZtD,EAAY,GAgBhB,OAdA33B,EAAEqP,KAAKnK,KAAKi1B,WAAY,SAASrwB,EAAOxJ,GACvC,IAAIuJ,EAAQ5E,EAAGq1B,iBAAiBh6B,EAAK26B,YAAc,GAC/CpxB,EACHoxB,EAAU36B,EAAK26B,WAAa36B,EAAKs6B,eAAiBprB,IAAI3F,GAASA,EAE/D8tB,EAAU7pB,KAAKxN,EAAK26B,aAIlB/1B,KAAK+0B,iBACRj6B,EAAEqP,KAAKnK,KAAKy0B,oBAAqB,SAAS7vB,EAAO4e,GAChDuS,EAAUvS,EAAMthB,WAAanC,EAAGsG,OAAOnI,YAAYslB,EAAMthB,WAAWgO,MAAMvL,QAGrEoxB,KC7YTn7B,OAAOC,QAAQ,kBAEfD,OAAOiL,GAAGC,KAAKuxB,uBAAyBz8B,OAAOiL,GAAGC,KAAKwsB,eAAe92B,OAAO,CAC5E6xB,KAAM,SAASvvB,EAASy0B,GACvBvyB,KAAKsgB,OAAOxiB,EAASy0B,IAGtBC,cAAe,WACdxyB,KAAKyyB,UAAYzyB,KAAKyyB,UAAUE,OAAO3yB,KAAK0yB,sBAC5C1yB,KAAKsgB,UAGNoS,mBAAoB,WAiEnB,MAhEqB,CAAC,CACrBjsB,UAAW,gBACXC,MAAOpL,GAAG,2BACVg8B,YAAa,GAEd,CACC5wB,MAAOpL,GAAG,YACV4G,UAAW,WACXuE,UAAW,QAEZ,CACCA,UAAW,gBAEZ,CACCC,MAAOpL,GAAG,iBACV4G,UAAW,YACXuE,UAAW,QAEZ,CACCA,UAAW,gBACXC,MAAOpL,GAAG,2BACVg8B,YAAa,GAEd,CACC5wB,MAAOpL,GAAG,kBACV4G,UAAW,gBACXuE,UAAW,QAEZ,CACCC,MAAOpL,GAAG,kBACV4G,UAAW,gBACXuE,UAAW,QAEZ,CACCC,MAAOpL,GAAG,YACV4G,UAAW,UACXuE,UAAW,QAEZ,CACCA,UAAW,gBAEZ,CACCC,MAAOpL,GAAG,QACV4G,UAAW,OACXuE,UAAW,QAEZ,CACCC,MAAOpL,GAAG,SACV4G,UAAW,QACXuE,UAAW,QAEZ,CACCC,MAAOpL,GAAG,WACV4G,UAAW,UACXuE,UAAW,OACXzB,QAAS,WAEV,CACC0B,MAAOpL,GAAG,mBACV4G,UAAW,kBACXuE,UAAW,OACXK,OAAQ,+vGC1EXlM,OAAOC,QAAQ,eAEfD,OAAO28B,MAAMC,mBAAqB,cAAiC58B,OAAO28B,MAAME,QAC/EzI,kBA+BOp0B,OAAO6H,KAAK,CAClBC,OAAQ,8FACN0F,cAAKvF,UAAKA,EAAEO,UA/BZgF,cAAKsvB,GACDA,EACH98B,OAAO+8B,eAAe,eAInB/8B,OAAOg9B,MAAMC,aAChBj9B,OAAOk9B,UAAUC,UAAU,eAC3Bj7B,QAAQk7B,IAAIH,YAAY/uB,WAExB9I,EAAKi4B,KAAK,iBAKdjJ,KAAKkJ,cAKJt9B,OAAOoyB,QAJQ,CACd,4CAIAlwB,QAAQk7B,IAAIH,YAAc,IAAI/6B,QAAQk7B,IAAIG,YAAY,CACrD1O,OAAQzpB,EAAKo4B,WAAU,EAAMF,SC3BjC,MAAMG,EACLrJ,YAAYsJ,GACXt4B,KAAKu4B,cAAgBD,EAASE,KAC9Bx4B,KAAKs4B,SAAWA,EAChBt4B,KAAKy4B,iBACLz4B,KAAKi4B,OAGNjJ,kBACChvB,KAAKqG,OAAS,IAAIzL,OAAOiL,GAAGS,OAAO,CAClCoyB,QAAU,EACVC,aAAe,EACfnyB,OAAU,CAAC,CACVtE,UAAa,cACbuE,UAAa,QACX,CACFmyB,SAAY,mBACZnyB,UAAa,gBACbC,MAASpL,GAAG,aACV,CACFmL,UAAa,aACbC,MAASpL,GAAG,sBACZ4G,UAAa,qBACb8E,WAAa,EACbC,iCAAoC3L,GAAG,kCACrC,CACFmL,UAAa,aACbC,MAASpL,GAAG,cACZ4G,UAAa,aACb8E,WAAa,EACbC,iCAAoC3L,GAAG,2CACrC,CACFmL,UAAa,gBACX,CACFA,UAAa,aACbC,MAASpL,GAAG,gBACZ4G,UAAa,gBACX,CACFuE,UAAa,SACbC,MAASpL,GAAG,QACZmZ,iBACChX,IAAMo7B,EAAe74B,EAAKqG,OAAOc,UAAU,gBACtC0xB,GACLj+B,OAAOk+B,MAAM,6CAA8C,CAC1D/1B,QAAW/C,EAAKs4B,SAASS,GACzBC,QAAWH,IACTzwB,gBACFpI,EAAKi5B,cACLr+B,OAAOmzB,WAAW,CACjB3qB,QAAY9H,GAAG,mFAAkF0E,EAAKs4B,mBAAkBh9B,GAAG,wBAC3HiG,UAAW,iBAMhBvB,KAAKk5B,kBACLl5B,KAAKm5B,2BACLn5B,KAAKqG,OAAO+yB,gBAAgBrwB,OAC5B/I,KAAKqG,OAAO8N,MAAM9S,SAAS,cAC3BrB,KAAKqG,OAAOgzB,qBAAqBr5B,KAAKi5B,YAAYj+B,KAAKgF,OACvDpF,OAAOwF,MAAMk5B,WAAW,iBACxBt5B,KAAKqG,OAAO0C,OAGbimB,sCACO9F,EAAUlpB,KAAKqG,OAAO4a,UAAU,eAAenhB,SACrDopB,EAAQwG,mCAAmCp0B,GAAG,yBAC9CV,OAAOk+B,MAAM,2DAA4D,CACxEppB,OAAU1P,KAAKu4B,gBACbnwB,cAAKmxB,GACPrQ,EAAQpU,SACQ9U,EAAKsP,QAAUiqB,IAI9Bv5B,EAAKw5B,mBAAmBtQ,GACxBlpB,EAAKk5B,kBACLl5B,EAAKy5B,iCAJLz5B,EAAK05B,qBAAqBxQ,KAS7B8F,qBAAqB9F,cACpBA,EAAQwG,wDAEDp0B,GAAG,2BAA0B0E,yJAIzB1E,GAAG,4HAIXkZ,KAAK,UAAUC,wBACX7Z,OAAOyI,4CAA4CrD,EAAkB,iBAI7EgvB,mBAAmB9F,GAClBzrB,IAAM6R,EAAUtP,KAAKsP,QACfG,EAAe7U,OAAOwF,MAAMu5B,cAAcrqB,EAAQxR,QAASwR,EAAQpU,MAAM,EAAM8E,KAAK45B,mBACpFC,EAAQvqB,EAAQuqB,MAAQvqB,EAAQuqB,MAAQ,GAE1CC,EAAgB,GAEpBD,EAAMp5B,iBAAQs5B,GACbD,GAAiB,QAAQC,oBAAsBn/B,OAAOwF,MAAMu5B,cAAcI,EAAKntB,aAAcmtB,EAAKltB,WAAW,cAE9Gqc,EAAQwG,0DAEJ90B,OAAOo/B,OAAO,KAAM,YAAa1qB,EAAQpU,KAAMoU,EAAQgf,OAAS,sCAE3D7e,4BACCH,EAAQH,WAAa,+BACrBG,EAAQ2qB,UAAY,yBACzBH,0CAMN9K,cAAc1tB,EAAO44B,mBAAM,GAC1Bh2B,IAAIi2B,EAAU,aAAa74B,OAAS44B,EAAQ,QAAS,IACrDl6B,KAAKqG,OAAO+zB,OAAO5lB,KAAK,cAAcpZ,KAAK,QAAS++B,GAGrDnL,gBAAgBqL,GACfn2B,IAAIqC,EAAQ,GACZ8zB,EAAcA,GAAer6B,KAAKs4B,SAASzU,OACvC,CAAC,WAAW5e,SAASo1B,KAAiBA,GACzC9zB,EAAQjL,GAAG,yBAA0B,CAAC0E,KAAK45B,oBAC3C55B,KAAKs6B,cAAc,QAAQ,IACD,gBAAhBD,GACV9zB,EAAQjL,GAAG,kBACX0E,KAAKs6B,cAAc,WACO,WAAhBD,GACVr6B,KAAKs6B,cAAc,OACnB/zB,EAAQjL,GAAG,gBACD,CAAC,YAAa,gBAAgB2J,SAASo1B,IACjDr6B,KAAKs6B,cAAc,OACnB/zB,EAAQjL,GAAG,uBAEX0E,KAAKs6B,cAAc,QACnB/zB,EAAQ8zB,GAETr6B,KAAKqG,OAAOk0B,UAAUh0B,GAGvByoB,gBAAgBsJ,GACft4B,KAAKs4B,SAAWA,EAChBt4B,KAAKk5B,kBAGNlK,cACChvB,KAAKqG,OAAOkC,cACLzL,QAAQ09B,WAGhBxL,kBAAkBsJ,cACjB19B,OAAOwF,MAAMk5B,WAAW,mBACxBt5B,KAAKy6B,gBAAgBnC,GACrB7K,sBACMztB,EAAKqG,OAAOc,UAAU,iBAC1BnH,EAAKi5B,eAEJ,KAGJjK,2CACCp0B,OAAOk+B,MAAM,iDAAkD,CAC9DppB,OAAU1P,KAAKu4B,cACfmC,cAAiB16B,KAAKsP,UACpBlH,cAAKhC,GACP3I,IAAMk9B,EAAa36B,EAAKqG,OAAO4a,UAAU,sBACzC,GAAI7a,EAAKw0B,mBAAoB,CAC5Bn9B,IAAMo9B,EAAOz0B,EAAKw0B,mBAClBD,EAAW/7B,UAAUi8B,EAAKC,SAG3B,GAAI10B,EAAK20B,WAAY,CACpBt9B,IAAMu9B,EAAQ50B,EAAK20B,WACbE,EAAcj7B,EAAKqG,OAAO4a,UAAU,cAC1Cga,EAAYr8B,UAAUo8B,EAAME,SAC5BD,EAAYn7B,SAAS4vB,4DAA4DsL,4BAC9E1/B,GAAG,2BAA4B,CAAC0/B,EAAM9uB,gCAK5C8iB,kBACC,OAAOhvB,KAAKsP,QAAUtP,KAAKsP,QAAQ6rB,WAAan7B,KAAKsP,QAAQpU,MAAQ,GAAK8E,KAAKu4B,cAEhFvJ,4BACCp0B,OAAOwgC,SAASn7B,WAAWD,KAAKs4B,qCAA4BA,GAC3Dt4B,EAAKq7B,kBAAkB/C,GAEvB19B,OAAOwgC,SAASE,YAAYt7B,EAAKs4B,gCAKpCx9B,EAAEC,UAAUkF,GAAG,YAAa,WAC3BrF,OAAOwgC,SAASn7B,GAAG,2BAAmBq4B,GAChCx7B,QAAQ09B,YAGZ19B,QAAQ09B,WAAWC,gBAAgBnC,GACnCx7B,QAAQ09B,WAAWn0B,OAAO0C,QAH1BjM,QAAQ09B,WAAa,IAAInC,EAAUC,OC7MtC19B,OAAOC,QAAQ,kBAEfiC,QAAQy+B,yBAA2B,CAAC,WAAY,gBAAiB,mBAAoB,gBAAiB,QACrG,gBAAiB,cAAe,SAAU,gBAAiB,gBAAiB,qBAAsB,wBAClG,sBAAuB,wBAAyB,wBAAyB,qBAAsB,wBAC/F,qBAAsB,0BAA2B,0BAA2B,6BAA8B,gBAC1G,mBAAoB,yBAA0B,kBAAmB,eAAgB,gBAAiB,uBAClG,iBAAkB,OAAQ,cAAe,gCAAiC,qCAAsC,eAChH,qBAED3gC,OAAO6H,KAAK,CACXC,OAAQ,2FACRF,SAAU,SAASK,GAClB/F,QAAQ0+B,kBAAoB34B,EAAEO,QAAQ,GACtCtG,QAAQ2+B,mBAAqB54B,EAAEO,QAAQ,MAIzCtG,QAAQy+B,yBAAyB96B,iBAAS3C,GACzClD,OAAOiL,GAAGC,KAAK7F,GAAGnC,EAAS,CAC1BoV,OAAQ,SAAS/S,GAChBrD,QAAQ0+B,kBAAkB/6B,iBAASi7B,GAClC9gC,OAAOsI,MAAMqC,aAAam2B,EAAyB,yBAC9C9gC,OAAOgP,KAAK8W,UAAUgb,EAAyB,cAAG,aACrDv7B,EAAIwN,UAAU+tB,EAAqB,UAAG,CACrCpuB,SAAY,IAGVnN,EAAIqR,UAAY5W,OAAOgP,KAAK8W,UAAU5iB,EAAS,YAAcqC,EAAIjD,IAAIF,SACxEmD,EAAIvB,UAAU88B,EAAqB,UAAG5+B,QAAQ2+B,mBAAmBt7B,EAAIjD,IAAIF,SAAS0+B,EAAyB,qBAM/G1+B,QAAS,SAASmD,GACdA,EAAIjD,IAAIF,SACVF,QAAQ0+B,kBAAkB/6B,iBAASi7B,GAClCv7B,EAAIvB,UAAU88B,EAAqB,UAAG5+B,QAAQ2+B,mBAAmBt7B,EAAIjD,IAAIF,SAAS0+B,EAAyB,mBAK9G3a,UAAW,SAAS5gB,EAAK6N,EAAKC,GAC7BnR,QAAQ0+B,kBAAkB/6B,iBAASi7B,GAClC,IAAI5zB,EAAMlN,OAAOuC,QAAQ6Q,EAAKC,GAC9B9N,EAAI+H,eAAeyzB,oBAAoB,QAAS7zB,EAAK,CAAC4zB,EAAqB,eAI7EE,aAAc,SAASz7B,EAAK6N,EAAKC,GAChCnR,QAAQ0+B,kBAAkB/6B,iBAASi7B,GAClC,IAAI5zB,EAAMlN,OAAOuC,QAAQ6Q,EAAKC,GAC9B9N,EAAI+H,eAAeyzB,oBAAoB,WAAY7zB,EAAK,CAAC4zB,EAAqB"}